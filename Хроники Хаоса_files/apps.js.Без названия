!function(e){function t(t){for(var o,s,r=t[0],c=t[1],l=t[2],d=0,u=[];d<r.length;d++)s=r[d],n[s]&&u.push(n[s][0]),n[s]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(e[o]=c[o]);for(p&&p(t);u.length;)u.shift()();return a.push.apply(a,l||[]),i()}function i(){for(var e,t=0;t<a.length;t++){for(var i=a[t],o=!0,r=1;r<i.length;r++){var c=i[r];0!==n[c]&&(o=!1)}o&&(a.splice(t--,1),e=s(s.s=i[0]))}return e}var o={},n={"web/apps":0},a=[];function s(t){if(o[t])return o[t].exports;var i=o[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=e,s.c=o,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)s.d(i,o,function(t){return e[t]}.bind(null,o));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var r=window.webpackJsonp=window.webpackJsonp||[],c=r.push.bind(r);r.push=t,r=r.slice();for(var l=0;l<r.length;l++)t(r[l]);var p=c;a.push([50,"common","63cc894c1323b715b7b33772086e4b56"]),i()}({"3f+a":function(e,t,i){"use strict";var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.link=t,this.onClick=this.onClick.bind(this)}return e.prototype.onClick=function(){var e=this;this.copyToClipboard(this.link),this.copy.classList.add("vk_app_copy_link__copy--hidden"),this.copied.classList.add("vk_app_copy_link__copied--visible"),setTimeout(function(){e.copy.classList.remove("vk_app_copy_link__copy--hidden"),e.copied.classList.remove("vk_app_copy_link__copied--visible")},2400)},e.prototype.copyToClipboard=function(e){var t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.position="absolute",t.style.left="-9999px",document.body.appendChild(t);var i=document.getSelection().rangeCount>0&&document.getSelection().getRangeAt(0);t.select(),document.execCommand("copy"),document.body.removeChild(t),i&&(document.getSelection().removeAllRanges(),document.getSelection().addRange(i))},e.prototype.renderCopied=function(){this.copied=document.createElement("span"),this.copied.classList.add("vk_app_copy_link__copied"),this.copied.innerHTML=getLang("vkapps_link_copied")},e.prototype.renderCopy=function(){this.copy=document.createElement("span"),this.copy.classList.add("vk_app_copy_link__copy"),this.copy.innerHTML=getLang("vkapps_link_copy"),this.copy.addEventListener("click",this.onClick)},e.prototype.render=function(){return this.linkEl=document.createElement("span"),this.linkEl.classList.add("vk_app_copy_link__container"),this.renderCopy(),this.renderCopied(),this.linkEl.appendChild(this.copy),this.linkEl.appendChild(this.copied),this.linkEl},e}();var n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.onHide=this.onHide.bind(this),this.show=this.show.bind(this),this.hide=this.hide.bind(this),this.toggle=this.toggle.bind(this),this.isVisible=!1}return e.prototype.init=function(){this.render(),cur.app.cont.appendChild(this.container)},e.prototype.toggle=function(){this.isVisible?this.hide():this.show()},e.prototype.show=function(){var e=this;setTimeout(function(){return e.container.classList.add("show")},300),this.container.addEventListener("click",this.onHide),this.isVisible=!0,this.container.setAttribute("aria-hidden",this.isVisible)},e.prototype.hide=function(){var e=this;setTimeout(function(){return e.container.classList.remove("show")},300),this.container.removeEventListener("click",this.onHide),this.closeBtn.removeEventListener("click",this.onHide),this.isVisible=!1,this.container.setAttribute("aria-hidden",this.isVisible)},e.prototype.onHide=function(e){(e.target===this.container||e.target===this.closeBtn||this.closeBtn.contains(e.target))&&(this.hide(),this.destroy())},e.prototype.destroy=function(){this.container.parentNode.removeChild(this.container),this.callback&&this.callback()},e.prototype._renderCloseBtn=function(){this.closeBtn=document.createElement("button"),this.closeBtn.setAttribute("type","button"),this.closeBtn.classList.add("vk_app_modal_close_btn"),this.closeBtn.innerHTML='<svg class="vk_app_modal_close_btn__icon" viewBox="0 0 24 24" id="cancel_24" width="24" height="24">\n        <g fill="none" fill-rule="evenodd">\n          <path d="M0 0h24v24H0z"></path>\n          <path\n              d="M18.3 5.7a.99.99 0 0 0-1.4 0L12 10.6 7.1 5.7a.99.99 0 0 0-1.4 1.4l4.9 4.9-4.9 4.9a.99.99 0 0 0 1.4 1.4l4.9-4.9 4.9 4.9a.99.99 0 0 0 1.4-1.4L13.4 12l4.9-4.9a.99.99 0 0 0 0-1.4z"\n              fill="currentColor"></path>\n        </g>\n      </svg>',this.closeBtn.addEventListener("click",this.onHide),this.container.childNodes[0].appendChild(this.closeBtn)},e.prototype._renderOuter=function(){this.container=document.createElement("div"),this.container.classList.add("vk_app_modal_outer")},e.prototype.renderModal=function(){var e=new o(window.location.href);this.modal=document.createElement("div"),this.modal.classList.add("vk_app_modal_container","vk_app_modal_container--qr","vk_app_modal_container--flex"),this.modal.innerHTML='<img src="https://chart.googleapis.com/chart?chs=164x164&cht=qr&chl='+encodeURIComponent(window.location.href)+'" alt="VK App QR Code">\n<h2>'+cur.backLang+"</h2>\n<p>"+getLang("vkapps_focus_camera_on_qr_code")+"</p>",this.modal.appendChild(e.render())},e.prototype.render=function(){this.container||this._renderOuter(),this.renderModal(),this.container.innerHTML="",this.container.appendChild(this.modal),this._renderCloseBtn(this.container)},e}();t.a=n},50:function(e,t,i){e.exports=i("G9Ol")},G9Ol:function(__webpack_module__,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _lib_utils_common__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("t7n3"),_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("Egk5"),_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("FWc3"),_lib_stats__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("XzvV"),_shared_apps_connect_libs_QRCodeModal__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("3f+a"),_shared_apps_connect_lib__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("lMzL"),_lib_browser__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("gdug"),_slicedToArray=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],o=!0,n=!1,a=void 0;try{for(var s,r=e[Symbol.iterator]();!(o=(s=r.next()).done)&&(i.push(s.value),!t||i.length!==t);o=!0);}catch(e){n=!0,a=e}finally{try{!o&&r.return&&r.return()}finally{if(n)throw a}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){if(!e.fastXDM){var t={},i=[],o={};e.fastXDM={_id:0,helperUrl:"https://vk.com/js/api/xdmHelper.js",Server:function(i,o,n){this.methods=i||{},this.filter=o,this.options=n||{},this.id=e.fastXDM._id++,this.key=function(){for(var e="",t=0;t<5;t++)e+=Math.ceil(15*Math.random()).toString(16);return e}(),this.frameName="fXD"+this.key,this.frameId="fXD",this.server=!0,this.methods["%init%"]=this.methods.__fxdm_i=function(){e.fastXDM.run(this.id),this.methods.onInit&&this.methods.onInit()},t[this.key]=[l,this]},Client:function(i,o){if(this.methods=i||{},this.options=o||{},this.id=e.fastXDM._id++,this.client=!0,e.fastXDM.run(this.id),0!==window.name.indexOf("fXD"))throw Error("Wrong window.name property.");this.key=window.name.substr(3),this.caller=window.parent,t[this.key]=[l,this],e.fastXDM.on("helper",function(){e.fastXDM.onClientStart(this)},this),r(function(e){e.send(this,e.json.stringify(["%init%"]));var t=this.methods;setTimeout(function(){t.onInit&&t.onInit()},0)},this)},onMessage:function(i){if(i.origin!==e.location.origin){var o=cur.app&&cur.app.options&&cur.app.options.src?cur.app.options.src:"";if(!o)return!1;i.origin!==o&&i.origin+"/"!==o.substring(0,i.origin.length+1)&&console.warn("Warning: message from "+i.origin+" will be disable in future")}var n=i.data;if(!n)return!1;if("string"!=typeof n&&!(n instanceof String))return!1;var a=n.substr(0,5);if(t[a]){var s=t[a][1];!s||s.filter&&!s.filter(i.origin)||t[a][0](n.substr(6),s)}},setJSON:function(e){o.json=e},getJSON:function(e){if(!e)return o.json;r(function(t){e(t.json)})},setEnv:function(e){for(var t in e)e.hasOwnProperty(t)&&(o[t]=e[t]);c()},_q:{},on:function(e,t,i){this._q[e]||(this._q[e]=[]),-1==this._q[e]?t.apply(i):this._q[e].push([t,i])},run:function(e){for(var t=(this._q[e]||[]).length,i=0;i<t;i++)this._q[e][i][0].apply(this._q[e][i][1]);this._q[e]=-1},waitFor:n},e.fastXDM.Server.prototype.start=function(t,i){if(t.contentWindow)this.caller=t.contentWindow,this.frame=t,e.fastXDM.on("helper",function(){e.fastXDM.onServerStart(this)},this);else{var o=this;(i=i||0)<50&&setTimeout(function(){o.start.apply(o,[t,i+1])},100)}},e.fastXDM.Server.prototype.destroy=function(){delete t[this.key]},e.fastXDM.Server.prototype.append=function(e,t,i){var o=document.createElement("DIV");o.innerHTML='<iframe name="'+this.frameName+'" id="'+this.frameId+'" '+(i||"")+"></iframe>";var n=o.firstChild,a=this,s=function(){n.frameBorder="0",t&&function e(t,i){for(var o in i)t[o]&&"object"===_typeof(t[o])?e(t[o],i[o]):t[o]=i[o]}(n,t),e.insertBefore(n,e.firstChild),a.start(n)};return~e.className.indexOf("app_container--vk-app")&&delete t.scrolling,a.options.layer?s():setTimeout(function(){s()},0),n},e.fastXDM.Client.prototype.callMethod=e.fastXDM.Server.prototype.callMethod=function(){for(var t=this,i=Array.prototype.slice.call(arguments),o=i.shift(),a=0,c=i.length;a<c;a++)"function"==typeof i[a]?function(){t.funcsCount=(t.funcsCount||0)+1;var e=i[a],o="_func"+t.funcsCount;t.methods[o]=function(){e.apply(this,arguments),delete this.methods[o]},i[a]={_func:t.funcsCount}}():this.options.safe&&(i[a]=s(i[a],!1));n(this,"caller",function(){e.fastXDM.on(this.id,function(){r(function(e){e.send(this,e.json.stringify([o,i]))},this)},this)},this)},e.JSON&&"object"===_typeof(e.JSON)&&e.JSON.parse&&e.JSON.stringify&&'{"a":[1,2,3]}'===e.JSON.stringify({a:[1,2,3]}).replace(/ /g,"")?o.json={parse:e.JSON.parse,stringify:e.JSON.stringify}:e.fastXDM._needJSON=!0,e.postMessage?(o.protocol="p",o.send=function(e,t){var i=e.frame?e.frame.contentWindow:e.caller;if(i)try{i.postMessage(e.key+":"+t,"*")}catch(o){window.postMessage.call(i,e.key+":"+t,"*")}},e.addEventListener?e.addEventListener("message",e.fastXDM.onMessage,!1):e.attachEvent("onmessage",e.fastXDM.onMessage),e.fastXDM._needJSON?(e.fastXDM._onlyJSON=!0,a()):c()):a()}function n(e,t,i,o,a){e[t]?i.apply(o):(a=a||0)<1e3&&setTimeout(function(){n(e,t,i,o,a+1)},0)}function a(t){setTimeout(function(){var i=document.createElement("script");i.type="text/javascript",i.src=t||e.fastXDM.helperUrl,n(document,"body",function(){document.getElementsByTagName("HEAD")[0].appendChild(i)})},0)}function s(e,t){var i=void 0;switch(void 0===e?"undefined":_typeof(e)){case"string":i=t?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):e.replace(/&#039;/g,"'").replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&");break;case"object":if("[object Array]"===Object.prototype.toString.apply(e)){i=[];for(var o=0,n=e.length;o<n;o++)i[o]=s(e[o],t)}else for(var a in i={},e)Object.hasOwnProperty.call(e,a)&&(i[a]=s(e[a],t));break;default:i=e}return i}function r(e,t){o.loaded?e.apply(t,[o]):i.push([t,e])}function c(){o.loaded=!0;for(var e=0,t=i.length;e<t;e++)i[e][1].apply(i[e][0],[o])}function l(e,t){r(function(i){var o=i.json.parse(e);if(o[0]){o[1]||(o[1]=[]);for(var n=0,a=o[1].length;n<a;n++)o[1][n]&&o[1][n]._func?function(){var e=o[1][n]._func;o[1][n]=function(){var i=Array.prototype.slice.call(arguments);i.unshift("_func"+e),t.callMethod.apply(t,i)}}():t.options.safe&&(o[1][n]=s(o[1][n],!0));setTimeout(function(){if(!t.methods[o[0]])throw Error("fastXDM: Method "+o[0]+" is undefined");t.methods[o[0]].apply(t,o[1])},0)}})}}(window),window._iconAdd||(window._iconAdd=window.devicePixelRatio>=2?"_2x":""),window.appCallback=function(e){var t=e.shift();return!cur.app||!cur.app.funcs||(cur.app.funcs[t]||setTimeout(function(){throw new Error("unsupported app method: "+t)},0),setTimeout(function(i){return i.app.funcs[t].apply(i.app,e)}.pbind(cur),0),!0)},window.detectUnityWebPlayer=function(e,t){var i=function(e,t){var i=0,o=0,n=ce("object",{type:"application/vnd.unity"},{visibility:"hidden"});bodyNode.appendChild(n),function(){if(void 0===n.GetPluginVersion)o++<10?setTimeout(arguments.callee,10):(bodyNode.removeChild(n),e(null));else{var a={};if(t)for(i=0;i<t.length;++i)a[t[i]]=n.GetUnityVersion(t[i]);a.plugin=n.GetPluginVersion(),bodyNode.removeChild(n),e(a)}}()},o=function(e){var t=0,i=void 0,o=void 0,n=void 0,a=void 0,s=void 0;if(e){var r=e.toLowerCase().match(/^(\d+)(?:\.(\d+)(?:\.(\d+)([dabfr])?(\d+)?)?)?$/);r&&r[1]&&(i=r[1],o=r[2]?r[2]:0,n=r[3]?r[3]:0,a=r[4]?r[4]:"r",s=r[5]?r[5]:0,t|=i/10%10<<28,t|=i%10<<24,t|=o%10<<20,t|=n%10<<16,t|={d:8192,a:16384,b:24576,f:32768,r:32768}[a],t|=s/100%10<<8,t|=s/10%10<<4,t|=s%10)}return t},n=!1,a=void 0;if(navigator.plugins.refresh(),void 0!==navigator.plugins&&navigator.plugins["Unity Player"]&&void 0!==navigator.mimeTypes&&navigator.mimeTypes["application/vnd.unity"]&&navigator.mimeTypes["application/vnd.unity"].enabledPlugin){if(n=!0,_lib_browser__WEBPACK_IMPORTED_MODULE_6__.a.safari&&/Mac OS X 10_6/.test(navigator.appVersion))return void i(function(t){t&&t.plugin||(n=!1),e(n,t)},t);if(_lib_browser__WEBPACK_IMPORTED_MODULE_6__.a.mac&&_lib_browser__WEBPACK_IMPORTED_MODULE_6__.a.chrome)return void i(function(t){t&&o(t.plugin)<=o("2.6.1f3")&&(n=!1),e(n,t)},t);if(t)return void i(function(t){e(n,t)},t)}else if(_lib_browser__WEBPACK_IMPORTED_MODULE_6__.a.msie){var s=!1;try{null!=ActiveXObject.prototype&&(s=!0)}catch(e){}if(s&&(!/win64/i.test(navigator.userAgent)||!/x64/i.test(navigator.userAgent)))try{var r=new ActiveXObject("UnityWebPlayer.UnityWebPlayer.1"),c=r.GetPluginVersion();if(t){a={};for(var l=0;l<t.length;++l)a[t[l]]=r.GetUnityVersion(t[l]);a.plugin=c}if(n=!0,"2.5.0f5"==c){var p=/Windows NT \d+\.\d+/.exec(navigator.userAgent);if(p&&p.length>0)parseFloat(p[0].split(" ")[2])>=6&&(n=!1)}}catch(e){}}e(n,a)},window.vkApp=function(e,t,i,o,n){if(i=i||{},t=t||{},window.parent&&window.parent!=window&&!t.checking&&!t.openapi&&!t.embed)return!1;var a=this;if(this.cont=ge(e),this.cont){if(i.hash=i.hash||"",-1!=i.hash.indexOf("#")){var s=i.hash.split("#").pop();(s||"").substr(0,1)==vk.navPrefix?i.hash="":i.hash=s}this.params=i,this.onReady=[],this.isOpenInLayer()&&this.onReady.push(this.checkExternalAppResponse.bind(this));var r="";if(1==t.type)if(t.vkApp)r=""+t.vk_app_url+location.hash;else{r=t.src;var c=[];for(var l in i)"hash"==l?c.push(l+"="+encodeURIComponent(i[l])):c.push(l+"="+i[l]);r+=(-1==r.indexOf("?")?"?":"&")+c.join("&")}t.inlineApp&&(a.inlineApp=!0),a.options=extend({heightMax:4500},t),this.funcs={onInit:function(){return t.heightSync&&a.RPC.callMethod("getHeight",function(e){a.setHeight(e)}),a.inited||(a.inited=!0,o&&o(),a.inlineApp||a.onAppReady()),!0},ApiCall:function(e,t){var i=e.shift();a.api(i,e[0],t)},_getAppInfo:function(e){e([a.params.api_id,window.location.hash])},api:function(e,t,i){a.api(t,i,function(t){a.apiCallback(e,t)})},setHeight:function(e){a.setHeight(e)},scrollWindow:function(e,t){if(!a.inlineApp){var i=Math.max(e,0);t=intval(t),a.options.layer?a.params.is_vkpay_service&&window.wkLayerWrap&&animate(window.wkLayerWrap,{scrollTop:i},t):t&&t>0?(animate(htmlNode,{scrollTop:i},t),animate(bodyNode,{scrollTop:i},t)):window.scroll(0,i)}},scrollTop:function(e){var t=window.innerHeight||document.documentElement.clientHeight||bodyNode.clientHeight;cur.appTopOffset||(cur.appTopOffset=getXY(cur.app.cont)[1]);var i=0;window.curNotifier&&curNotifier.idle_manager&&curNotifier.idle_manager.is_idle&&(i=1),cur.app.runCallback("onScrollTop",parseInt(scrollGetY()),parseInt(t),parseInt(cur.appTopOffset),i)},scrollSubscribe:function(e){var t=a.isOpenInLayer(),i=void 0;i=t&&ge("wk_layer_wrap")||(_lib_browser__WEBPACK_IMPORTED_MODULE_6__.a.msie6?pageNode:window);var o=function(){var e=window.innerHeight||document.documentElement.clientHeight||bodyNode.clientHeight,o=t?function(){return i.scrollTop}:scrollGetY;a.runCallback("onScroll",parseInt(o()),parseInt(e))},n=function(){addEvent(i,"scroll",o)};n(),e&&o(),cur._back?(cur._back.show.push(n),cur._back.hide.push(function(){removeEvent(i,"scroll",o)})):cur.destroy.push(function(){removeEvent(i,"scroll",o)})},showRequestBox:function(e,t,i){showBox("al_apps.php",{act:"show_request_box",aid:cur.aid,message:t,uid:e,request_key:i},{params:{width:430,dark:1},onFail:function(e){return cur.app.runCallback("onRequestFail",e),!0}})},showInstallPushBox:function(){showBox("al_apps.php",{act:"show_install_push_box",aid:cur.aid},{params:{width:430,dark:1},onFail:function(e){return cur.app.runCallback("onInstallPushFail",e),!0}})},showProfilePhotoBox:function(e){showBox("al_apps.php",{act:"show_profile_photo_box",hash:e,aid:cur.aid},{params:{dark:1}})},setTitle:function(e){if(!a.inlineApp){e=e.replace(/[<>]+/gi,"");var t=cur.backLang;t=t||getLang("global_vkontakte"),setDocumentTitle(t+(e?" | "+e:""))}},resizeWindow:function(e,t,i){a.setWidth(e,i),a.setHeight(t,i),e=a.frame.clientWidth,t=a.frame.clientHeight,a.runCallback("onWindowResized",e,t)},getLocationProtocol:function(e){e(location.protocol)},setLocation:function(e,t){e=e.toString(),cur.appLoc=e,t&&cur.app.runCallback("onLocationChanged",e),nav.setLoc(extend(nav.objLoc,{"#":e}))},setNavigation:function(){},checkFlashSupport:function(e){(e=positive(e))||(e=9),_lib_browser__WEBPACK_IMPORTED_MODULE_6__.a.flash>=e?cur.app.runCallback("onCheckFlashSupportSuccess"):(cur.app.showDummy("no_flash"),cur.app.runCallback("onCheckFlashSupportFail"))},checkUnitySupport:function(){window.detectUnityWebPlayer(function(e){e?cur.app.runCallback("onCheckUnitySupportSuccess"):(cur.app.showDummy("no_unity"),cur.app.runCallback("onCheckUnitySupportFail"))})},showInstallBox:function(){if(cur.appUser)Apps.onAppAdded();else{if(cur.installBoxShown)return;cur.installBoxShown=!0,showBox("apps",{act:"install_box",aid:t.aid},{params:{dark:1}}).setOptions({onHide:function(){setTimeout(function(){cur.installBoxShown=!1},3e3)}})}},showSettingsBox:function(e){if(!cur.settingsBoxShown){cur.onSettingsEventSended=!1,cur.canSendOnSettingsEventFromHide=!0,cur.onSettingsChange=function(e,t){cur.onSettingsEventSended||(cur.onSettingsEventSended=!0,"ok"===e?cur.app.runCallback("onSettingsChanged",t):cur.app.runCallback("onSettingsCancel"))},cur.settingsBoxShown=!0;var i={act:"settings_box",aid:t.aid,mask:e};t.gid&&(i.gid=t.gid),showBox("apps",i,{params:{dark:1,width:550}}).setOptions({onHide:function(){cur.canSendOnSettingsEventFromHide&&cur.onSettingsChange("cancel"),setTimeout(function(){cur.settingsBoxShown=!1},3e3)}})}},showGroupSettingsBox:function(e){cur.settingsBoxShown||(cur.settingsBoxShown=!0,t.gid&&(cur.onSettingsEventSended=!1,cur.canSendOnSettingsEventFromHide=!0,cur.onSettingsChange=function(e,t,i){cur.onSettingsEventSended||(cur.onSettingsEventSended=!0,"ok"===e?cur.app.runCallback("onGroupSettingsChanged",t,i):cur.app.runCallback("onGroupSettingsCancel"))},showBox("apps",{act:"group_settings_box",aid:t.aid,mask:e,gid:t.gid},{params:{dark:1,width:550}}).setOptions({onHide:function(){cur.canSendOnSettingsEventFromHide&&cur.onSettingsChange("cancel"),setTimeout(function(){cur.settingsBoxShown=!1},3e3)}})))},showAppWidgetPreviewBox:function(e,i){if(!cur.appWidgetPreviewBox&&t.gid){cur.appWidgetPreviewBox=!0,cur.onAppWidgetPreviewFail=function(e){n(),cur.app.runCallback("onAppWidgetPreviewFail",e)},cur.onAppWidgetPreviewCancel=function(){n(),cur.app.runCallback("onAppWidgetPreviewCancel")},cur.onAppWidgetPreviewSuccess=function(){n(),cur.app.runCallback("onAppWidgetPreviewSuccess")};var o=showBox("apps",{act:"app_widget_preview_box",aid:t.aid,gid:t.gid,type:e,code:i},{params:{width:600,containerClass:"apps_app_widget_preview_box"},onDone:function(){o.setOptions({onHide:function(){isFunction(cur.onAppWidgetPreviewCancel)&&cur.onAppWidgetPreviewCancel()}})},onFail:function(e){return~e.indexOf("413 Request Entity Too Large")&&(e="413 Request Entity Too Large"),isFunction(cur.onAppWidgetPreviewFail)&&cur.onAppWidgetPreviewFail(e),!0}})}function n(){delete cur.onAppWidgetPreviewFail,delete cur.onAppWidgetPreviewCancel,delete cur.onAppWidgetPreviewSuccess,setTimeout(function(){delete cur.appWidgetPreviewBox},3e3)}},showAllowMessagesFromCommunityBox:function(e){if(!cur.allowMessagesFromCommunityBox){cur.allowMessagesFromCommunityBox=!0,cur.allowMessagesFromCommunityStatus="",cur.onAllowMessagesFromCommunity=function(e){"ok"===e?cur.app.runCallback("onAllowMessagesFromCommunity"):cur.app.runCallback("onAllowMessagesFromCommunityCancel")};var i={act:"allow_messages_from_community_box",aid:t.aid};i.gid=e||t.gid,showBox("apps",i,{params:{dark:1,width:550}}).setOptions({onHide:function(){cur.onAllowMessagesFromCommunity(cur.allowMessagesFromCommunityStatus),setTimeout(function(){cur.allowMessagesFromCommunityBox=!1},3e3)}})}},showInviteBox:function(){Apps.showInviteBox(t.aid,t.hash)},showPaymentBox:function(e){showBox("al_apps.php",{act:"show_payment_box",votes:e,aid:t.aid},{params:{dark:1}})},showLeadsPaymentBox:function(e){showBox("al_apps.php",{act:"show_payment_box",aid:t.aid,offers:isArray(e)?e.join(","):intval(e)||1},{params:{dark:1}})},showOrderBox:function(e){if("object"!=(void 0===e?"undefined":_typeof(e))){var i=Array.prototype.slice.call(arguments);e={},each(i,function(){var t=this.split("=");2==t.length&&(e[t[0]]=t[1])})}var o={};for(var n in e)Object(_lib_utils_common__WEBPACK_IMPORTED_MODULE_0__.o)(n,["type","votes","offer_id","item","currency"])&&(o[n]=e[n]+"");"offers"==o.type&&isArray(o.offer_id)&&(o.offer_id=o.offer_id.join(",")),o.act="show_order_box",o.aid=t.aid,o.hash=t.hash,a.params.sales_ref&&(o.sales_ref=a.params.sales_ref),showBox("al_apps.php",o,{params:{dark:1},onFail:function(e){return!(void 0!==e||!t.embed)||(showFastBox({title:getLang("global_error")},e),!0)}}),cur.onAppOrderCancel=function(){cur.app.runCallback("onOrderCancel")},cur.onAppOrderSuccess=function(e){cur.app.runCallback("onOrderSuccess",e)},cur.onAppOrderFail=function(e){cur.app.runCallback("onOrderFail",e)}},showSubscriptionBox:function(e,i){if("object"!=(void 0===i?"undefined":_typeof(i))){var o=Array.prototype.slice.call(arguments);i={},each(o,function(){var e=this.split("=");2==e.length&&(i[e[0]]=e[1])})}var n={act:"show_subscription_box",aid:t.aid,action:e,hash:t.hash};"create"==n.action?n.item=i.item:"resume"!=n.action&&"cancel"!=n.action||(n.subscription_id=i.subscription_id),showBox("al_apps.php",n,{onFail:function(e){return showFastBox({title:getLang("global_error")},e),!0}}),cur.onSubscriptionCancel=function(){cur.app.runCallback("onSubscriptionCancel")},cur.onSubscriptionSuccess=function(e){cur.app.runCallback("onSubscriptionSuccess",e)},cur.onSubscriptionFail=function(e){cur.app.runCallback("onSubscriptionFail",e)}},showMerchantPaymentBox:function(e){return!1},showPortlet:function(e){return!1},addToMenu:function(){ajax.post("al_apps.php",{act:"add_left_menu",aid:cur.aid,hash:cur.app.options.hash},{onDone:function(e){Apps.updateLeftNav(e.left_nav),Apps.addToMenuErrorResolve(e),Apps.updateAddToMenuAction()}})},adsPublish:function(){AdsLight.handleEvent.apply(AdsLight,arguments)},callUser:function(e,t,i){showBox("al_apps.php",{act:"call_user",uid:e,key:t,aid:cur.aid,msg:i},{dark:1,onFail:function(e){return cur.app.runCallback("onCallFail",e),!0}})},debug:function(){debugLog(1==arguments.length?arguments[0]:arguments)},openExternalApp:function(e,i){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments[3],s=arguments[4];if(e){var r=["pay-to-user","transfer-to-user"],c=["pay-to-group","transfer-to-group"];if(i&&~["pay-to-user","pay-to-service","pay-to-group","transfer-to-user","transfer-to-group","open-service","add-card"].indexOf(i.action))if(!~r.indexOf(i.action)||i.user_id)if(!~c.indexOf(i.action)||i.group_id)if("open-service"!==i.action||a.params.is_vkpay){var l="open-service"!==i.action,p="",d=[];if(i&&(i.aid=t.aid,p=e+"?"+(d=a.getQueryParts(i)).join("&")),p){var u=void 0,h=!_lib_browser__WEBPACK_IMPORTED_MODULE_6__.a.mozilla&&!_lib_browser__WEBPACK_IMPORTED_MODULE_6__.a.msi&&!_lib_browser__WEBPACK_IMPORTED_MODULE_6__.a.msie_edge,_=!1;if("open-service"===i.action){var f=/^app(\d+)(?:_-(\d+))?$/.exec(e),g=a.options.vkpay_not_layer_services||[],v=positive(f[1]);f&&Object(_lib_utils_common__WEBPACK_IMPORTED_MODULE_0__.o)(v,g)&&(_=!0,h&&(u=window.open("","_blank"))),a.params.is_vkpay_service&&a.params.is_mobile&&(_=!0,h&&(u=window.open("","_blank")))}ajax.post("al_apps.php",{act:"open_external_app",url:e,q:d.join("&"),aid:t.aid},{onDone:function(e,t){if(t){if("open-service"===i.action&&_)return e=decodeURIComponent(e),u?void(u.location.href="/"+e):a.params.is_mobile?void(window.location.href="/"+e):void nav.go("/"+e);a.openAppInLayer(e,function(){cur.onExternalAppDone&&(cur.onExternalAppResults?a.checkExternalAppResponse():a.runCallback("onExternalAppClose"),cur.onExternalAppDone=null)},l),cur.onExternalAppDone=function(e,t){t=!!t,this.isOpenInLayer()||t?cur.onExternalAppResults={api_id:this.params.api_id,result:e}:(cur.onExternalAppResults=null,this.runCallback("onExternalAppDone",e)),t||(cur.onExternalAppDone=null,window.WkView&&WkView.hide(!1,!0))}.bind(a)}},onFail:function(e){try{e=JSON.parse(e)}catch(t){e={error:{error_msg:"Unknown error",error_code:1}}}return u&&u.close(),o?n(e.error):a.runCallback("onExternalAppFail",e.error),!0}})}}else o?s({error_msg:"Invalid action",error_code:100}):a.runCallback("onExternalAppFail",{error_msg:"Invalid action",error_code:100});else o?s({error_msg:"Missing required param group_id",error_code:100}):a.runCallback("onExternalAppFail",{error_msg:"Missing required param group_id",error_code:100});else o?s({error_msg:"Missing required param user_id",error_code:100}):a.runCallback("onExternalAppFail",{error_msg:"Missing required param user_id",error_code:100});else o?s({error_msg:"Invalid action",error_code:100}):a.runCallback("onExternalAppFail",{error_msg:"Invalid action",error_code:100})}},externalAppDone:function(e,t){if(cur.onExternalAppDone?cur.onExternalAppDone(e,t):t||window.WkView&&WkView.hide(!1,!0),a.params.is_mobile){if(window.opener){var i={method:"externalAppDone",params:e};window.opener.postMessage(i,"*")}a.close(!1)}},externalAppFail:function(e){if(!Object(_lib_utils_common__WEBPACK_IMPORTED_MODULE_0__.x)(e))try{e=JSON.parse(e)}catch(t){e={error:{error_msg:"Unknown error",error_code:1}}}var t=a.getOpenerApp();t&&t.isOpenInLayer()?cur.onExternalAppResults={api_id:t.params.api_id,error:e.error}:t&&t.runCallback("onExternalAppFail",e.error),cur.onExternalAppDone=null,window.WkView&&WkView.hide(!1,!0)},closeExternalApp:function(){Apps.closeExternalApp()},closeApp:function(){a.params.is_vkpay_service&&a.close(!0)},sendStats:function(e){(Object(_lib_utils_common__WEBPACK_IMPORTED_MODULE_0__.x)(e)||isArray(e))&&(e=JSON.stringify(e)),ajax.post("al_apps.php",{act:"save_stats",data:e,hash:cur.app.params.stats_hash,app_id:cur.aid},{onDone:function(){a.runCallback("onSendStatsDone")},onFail:function(){return a.runCallback("onSendStatsFail"),!0}})},showWallPostBox:function(e,t,i){if(e.message||e.attachments&&e.attachments.length)a.api("wall.post",e,function(e){e.error?i?i(e.error):this.runCallback("onShowWallPostBoxCancel",e.error):t?t({post_id:e.response.post_id}):this.runCallback("onShowWallPostBoxDone")}.bind(a));else{var o={error_code:100,error_msg:"One of the parameters specified was missing or invalid"};i?i(o):a.runCallback("onShowWallPostBoxCancel",o)}},enableBodyScroll:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){a.params.is_vkpay_service&&cur.bodyScrollDisabled&&(enableBodyScroll(),cur.bodyScrollDisabled=!1,a.runCallback("onBodyScrollDisabled"))}),disableBodyScroll:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){a.params.is_vkpay_service&&!cur.bodyScrollDisabled&&(cur.destroy.push(function(){cur.bodyScrollDisabled&&enableBodyScroll()}),disableBodyScroll(),cur.bodyScrollDisabled=!0,a.runCallback("onBodyScrollEnabled"))}),startHandleWheelEvent:function(){a.params.is_vkpay_service&&a.startHandleWheelEvent()},stopHandleWheelEvent:function(){a.params.is_vkpay_service&&a.stopHandleWheelEvent()},startHandleDeviceOrientation:function(){a.runCallback("onDeviceOrientationNotSupported")}},i.widget?(a.options.type=1,a.options.widget=!0):(1===this.options.type&&this.params.is_vkpay_service||renderFlash(ge("flash_api_external_cont"),{url:"/swf/api_external.swf",id:"flash_api_external",width:1,height:1,preventhide:1,version:9},{allowFullScreen:!0,allowscriptaccess:"always",allownetworking:"all",wmode:"opaque"},{debug:i.debug?1:0,lc_name:i.lc_name}),a.externalFrame=ge("flash_api_external"));var p=a.options.wmode||"opaque";if(a.options.no_init)return!1;var d=1,u=void 0;switch(a.options.type){case 1:a.options.layer?this.RPC=new fastXDM.Server(this.funcs,void 0,{layer:1}):this.RPC=new fastXDM.Server(this.funcs);var h={src:r,width:"100%",overflow:"hidden"};a.options.vkApp||(h.scrolling="no"),a.options.widget||(h.height=a.options.height+"px");this.frame=this.RPC.append(a.cont,h,'webkitallowfullscreen="true" mozallowfullscreen="true" allowfullscreen="true" allow="geolocation; microphone; camera; autoplay;"');break;case 2:debugLog("is wrapper"),u={url:t.src,id:"flash_app",width:a.options.width,height:a.options.height,version:10},"opaque"==p&&(u.preventhide=1),d=renderFlash(a.cont,u,{allowFullScreen:!0,allowscriptaccess:"never",allowFullScreenInteractive:"true",allownetworking:"all",bgcolor:"#F7F7F7",wmode:p},i),a.frame=ge("flash_app");break;case 3:u={url:t.src,id:"flash_app",width:a.options.width,height:a.options.height,version:9},"opaque"==p&&(u.preventhide=1),d=renderFlash(a.cont,u,{allowFullScreen:!0,allownetworking:"all",allowscriptaccess:"never",allowFullScreenInteractive:"true",wmode:p},i),a.frame=ge("flash_app")}d||a.showDummy("no_flash"),i.widget&&setTimeout(function(){a.inited||show("app_connect_error")},8e3),cur.destroy.push(function(){this.RPC&&this.RPC.destroy()}.bind(this))}},vkApp.prototype.boxApp=function(){},vkApp.prototype.onAppReady=function(){for(var e in this.onReady)this.onReady.hasOwnProperty(e)&&this.onReady[e]()},vkApp.prototype.checkExternalAppResponse=function(){cur.onExternalAppResults&&this.params.api_id===cur.onExternalAppResults.api_id&&(cur.onExternalAppResults.result&&this.runCallback("onExternalAppDone",cur.onExternalAppResults.result),cur.onExternalAppResults.error&&this.runCallback("onExternalAppFail",cur.onExternalAppResults.error)),cur.onExternalAppResults=null},vkApp.prototype.runCallback=function(){var e=Array.prototype.slice.call(arguments),t=e[0],i="customEvent",o=void 0;switch(-1!=["onLocationChanged","onMerchantPaymentSuccess","onBalanceChanged","onWindowResized","onSettingsChanged","onGroupSettingsChanged","onAppWidgetPreviewFail","onAppWidgetPreviewCancel","onAppWidgetPreviewSuccess","onCheckFlashSupportSuccess","onCheckFlashSupportFail","onCheckUnitySupportSuccess","onCheckUnitySupportFail"].indexOf(t)?(i=t,o=e.slice(1)):o=e.slice(),this.options.type){case 1:if(this.RPC.callMethod("runCallback",e),!this.options.widget&&!_lib_browser__WEBPACK_IMPORTED_MODULE_6__.a.iphone&&!_lib_browser__WEBPACK_IMPORTED_MODULE_6__.a.ipad)try{this.externalFrame[i](o)}catch(e){}break;case 2:case 3:try{this.externalFrame[i](o)}catch(e){}}},vkApp.prototype.apiCallback=function(e,t){try{this.externalFrame.apiCallback(e,t)}catch(e){}},vkApp.prototype.setHeight=function(e,t){if(e){this.inlineApp&&e>this.options.heightMax&&!this.params.is_vkpay_service&&(e=this.options.heightMax);var i=e+"px";this.frame.style.height=i,this.options.boxed||(this.cont.style.height=i),this.options.layer&&WkView.onResize(),this.options.onResize&&this.options.onResize()}},vkApp.prototype.isVkpayTransferLayer=function(){return!!this.params.is_vkpay_service&&(this.options.openapi?!!domCA(this.cont,".vkPayOpenApiBox_transfer"):!!domCA(this.cont,".vkpay_transfer"))},vkApp.prototype.setWidth=function(e,t){var i=this.options.vkApp?600:100,o=165;e&&!this.inlineApp&&cur.app&&(e=Math.min(Math.max(e,i),1e3),this.options.layout_width&&(o=this.options.layout_width-e),this.isVkpayTransferLayer()&&t&&(this.cont.style.maxWidth="none",this.cont.style.minWidth="none"),this.options.layer?WkView.onResize():window.handlePageView&&handlePageView({noleftmenu:vk.noleftmenu,nobottommenu:vk.nobottommenu,notopmenu:vk.notopmenu,body_class:vk.body_class,staticheader:vk.staticheader,no_ads:vk.no_ads,ad_preview:vk.ad_preview,top_home_link_class:vk.top_home_link_class,width:Math.max(e,625)+o}),this.frame.style.width=this.cont.style.width=e+"px")},vkApp.prototype.showProgress=function(){addClass(this.cont,"loading"),this.loaderEl=showProgress(this.cont,"","pr_big app_container_progress",!0)},vkApp.prototype.hideProgress=function(){removeClass(this.cont,"loading"),this.loaderEl&&re(this.loaderEl)},vkApp.prototype.showDummy=function(e){if(this.cont&&~["no_flash","no_unity"].indexOf(e)){var t={act:e};"no_flash"!==e||_lib_browser__WEBPACK_IMPORTED_MODULE_6__.a.iphone||_lib_browser__WEBPACK_IMPORTED_MODULE_6__.a.ipad?"no_unity"!==e||_lib_browser__WEBPACK_IMPORTED_MODULE_6__.a.mobile||(t.screen=_lib_browser__WEBPACK_IMPORTED_MODULE_6__.a.msie||_lib_browser__WEBPACK_IMPORTED_MODULE_6__.a.amigo||_lib_browser__WEBPACK_IMPORTED_MODULE_6__.a.mac&&_lib_browser__WEBPACK_IMPORTED_MODULE_6__.a.safari?"install":"browser"):t.screen="install",ajax.post("al_apps.php",t,{onDone:function(e){cur.app&&(addClass(cur.app.cont,"dummy"),val(cur.app.cont,e))},showProgress:this.showProgress.bind(this),hideProgress:this.hideProgress.bind(this)})}},vkApp.prototype.balanceUpdated=function(e){this.runCallback("onBalanceChanged",e)},vkApp.prototype.checkMethod=function(e,t,i){var o=e.toLowerCase();if("wall.post"==o||"activity.set"==o){var n=t["wall.post"==o?"message":"text"];n||(n=""),t.attachments=this.getValidPostAttachments(t.attachments||t.attachment),showBox("apps",{act:"wall_post_box",aid:this.options.aid,post_id:t.post_id,owner_id:t.owner_id,lat:t.lat,long:t.long,place_id:t.place_id,from_group:t.from_group,publish_date:t.publish_date,signed:t.signed,attachments:t.attachments,text:n,method:o},{params:{width:"430px",dark:1},onFail:function(e){e=e||"Unknown network error occurred",i&&i({error:{error_code:1,error_message:e}})}});var a=this;return cur.apiWallPost=function(o,n){n?i&&i({error:n}):a.api(e,extend(t,{method_access:o}),i)},!1}return!0},vkApp.prototype.checkMethodResult=function(e,t,i,o){switch(e){case"photos.saveProfilePhoto":if(!i.error)return cur.profilePhotoBoxCallback=function(e){o(e?{response:{photo_src:i.response.photo_src}}:{error:{error_code:10007,error_msg:"Operation denied by user"}}),window.profilePhotoBoxCallback=!1},cur.app.funcs.showProfilePhotoBox(i.response.photo_hash),!1}return!0},vkApp.prototype.initClientExternalApp=function(){this.clientRpc=new fastXDM.Client({},{safe:!0}),cur.onExternalAppDone=function(e,t){t=!!t,this.clientRpc.callMethod("externalAppDone",e,t)}.bind(this)},vkApp.prototype.onLocChanged=function(e){e||(e=""),cur.appLoc!=e&&(cur.appLoc=e,this.runCallback("onLocationChanged",e))},vkApp.prototype.api=function(method,inputParams,callback,captcha){var self=this;if(2==arguments.length&&(callback=params,inputParams={}),inputParams||(inputParams={}),captcha||inputParams.method_access||inputParams.method_force||this.checkMethod(method,inputParams,callback)){delete inputParams.callback,delete inputParams.access_token;var params={v:"3.0",api_id:this.params.api_id,method:method,format:"json",rnd:parseInt(1e4*Math.random())};if(inputParams)for(var i in inputParams)inputParams.hasOwnProperty(i)&&(i=trim(i),/^(rnd|format|api[\s.\[_]id|method|callback|access[\s.\[_]token)(\s*\[|$)/.test(i)||(params[i]=inputParams[i]));var lParams=[];for(var _i2 in params)params.hasOwnProperty(_i2)&&lParams.push([_i2,params[_i2]]);lParams.sort(sName);var sig=this.params.viewer_id;for(var _i3 in lParams)lParams.hasOwnProperty(_i3)&&(sig+=lParams[_i3][0]+"="+lParams[_i3][1]);sig+=this.params.secret,params.sid=this.params.sid,stManager.add("md5.js",function(){params.sig=window.MD5(sig);var done=function done(text){var response=eval("("+text+")");if(response.error&&14==response.error.error_code)cur.appCaptcha=showCaptchaBox(response.error.captcha_sid,0,!1,{onSubmit:function(e,t){inputParams.captcha_sid=e,inputParams.captcha_key=t,self.api(method,inputParams,callback,!0),cur.appCaptcha.setOptions({onHide:function(){}}).hide()},onHide:function(){callback(response)},imgSrc:response.error.captcha_img});else{if(captcha&&cur.appCaptcha.setOptions({onHide:function(){}}).hide(),!self.checkMethodResult(method,inputParams,response,callback))return;callback&&callback(response)}},fail=function(){callback&&callback({error:{error_code:1,error_message:"Unknown network error occurred"}}),debugLog("Ajax fail")};ajax.plainpost(self.params.api_script||"/api.php",params,done,fail)})}function sName(e,t){return e[0]>t[0]?1:e[0]<t[0]?-1:0}},vkApp.prototype.getValidPostAttachments=function(e){var t=/(^https?:\/\/)|(^(poll|album|photo|video|doc|audio|page|note)-?\d+_-?\d+)$/,i=[];return e=e||[],isString(e)&&(e=e.split(",")),each(e,function(){var e=this.trim();t.test(e)&&i.push(e)}),i.join(",")},vkApp.prototype.startHandleWheelEvent=function(){var e=this;this._wheelEventListener||stManager.add(["ui_common.js"],function(){e._wheelEventListener=function(e){var t=uiScroll.scrollEventDelta(e);cur.app.runCallback("onWheel",t,document.documentElement.clientHeight)},addEvent(window,browserFeatures.wheelEvent,e._wheelEventListener),cur.destroy.push(function(){e._wheelEventListener&&removeEvent(window,browserFeatures.wheelEvent,e._wheelEventListener)})})},vkApp.prototype.stopHandleWheelEvent=function(){this._wheelEventListener&&(removeEvent(window,"wheel",this._wheelEventListener),this._wheelEventListener=null)},vkApp.prototype.getQueryParts=function(e){var t=[];for(var i in e)if(e.hasOwnProperty(i)){var o="";void 0!==e[i]&&(o="object"===_typeof(e[i])?encodeURIComponent(JSON.stringify(e[i])):encodeURIComponent(e[i])),t.push(encodeURIComponent(i)+"="+o)}return t},vkApp.prototype.openAppInLayer=function(e,t,i,o){cur.openerAppsQueue=cur.openerAppsQueue||[],cur.openerAppsQueue.push(this),o=o||{},showWiki({w:e},null,null,extend(o,{queue:1,onHide:function(){cur.openerAppsQueue.length>0&&(cur.app=cur.openerAppsQueue.pop()),t&&t()},noClickHide:i}))},vkApp.prototype.getOpenerApp=function(){return cur.openerAppsQueue&&cur.openerAppsQueue[cur.openerAppsQueue.length-1]},vkApp.prototype.isOpenInLayer=function(){return"layer"===this.params.source},vkApp.prototype.close=function(e){if(this.params.is_vkpay_service&&Apps.closeExternalApp(),!window.WkView||this.params.is_mobile)if(window.opener){if(e){window.opener.postMessage({method:"closeApp"},"*")}window.close()}else e&&this.runCallback("onCloseApp"),window.nav.objLoc.back?window.location.href=nav.objLoc.back:window.nav.go("/feed");else WkView.hide(!1,!0)},vkApp.prototype.setVkPayMobileHeight=function(){if(this.params.is_vkpay_service&&this.params.is_mobile){var e=window.innerHeight||document.documentElement.clientHeight||bodyNode.clientHeight;(_lib_browser__WEBPACK_IMPORTED_MODULE_6__.a.safari||_lib_browser__WEBPACK_IMPORTED_MODULE_6__.a.safari_mobile)&&(e+=window.pageYOffset),e+="px",this.frame.style.minHeight=e,this.frame.style.height=e,this.cont.style.minHeight=e,this.cont.style.height=e}},window.AppsSlider=function(e){if(this.options=extend({inner:null,outer:null,next:null,prev:null,infinite:!0,slideshowDuration:4e3,animationDuration:500,isVkApp:!1},e||{}),this.required=null,this.current=null,this.slideNext=null,this.slidePrev=null,this.slideCurrent=null,this.hasVideoSlides=!1,this.videoPlayer=null,this._handlerInst=null,this._arrowNextHandler=null,this._arrowPrevtHandler=null,this.options.outer&&this.options.inner&&(this.outer=ge(this.options.outer),this.inner=ge(this.options.inner),this.outer&&this.inner)){if(this.slideshow=!1,this.animation={stop:function(){}},this.slideshowTimeout=null,this.interacted=!1,this.slides=domChildren(this.inner),this.options.infinite){if(!this.slides.length)return void re(this.outer);if(this.slides.length<3)for(var t=null,i=0;this.slides.length<4;)t=this.slides[i++].cloneNode(!0),this.slides.push(t),this.inner.appendChild(t)}(this.arrowNext=ge(this.options.next))&&(this._arrowNextHandler=this.next.bind(this),addEvent(this.arrowNext,"mousedown",this._arrowNextHandler)),(this.arrowPrev=ge(this.options.prev))&&(this._arrowPrevtHandler=this.prev.bind(this),addEvent(this.arrowPrev,"mousedown",this._arrowPrevtHandler)),this.inited=!1,this.init()}},AppsSlider.prototype={init:function(){if(void 0!==this.inited)return!!this.inited||(0!==this.outer.offsetWidth&&0!==this.slides[0].offsetWidth?(this.widthOuter=this.outer.offsetWidth,this.widthInner=this.inner.offsetWidth,this.widthSlide=this.widthInner/this.slides.length,this.offsetInner=this.inner.offsetLeft,this.widthSide=(this.widthOuter-this.widthSlide)/2,this.indexNext=this.slides.length-1,this.indexPrev=0,this.indexMargin=(this.slides.length-1)/2|0,this.indexRequired=this.indexCurrent=this.getIndex(),this.highlight(),this.rearrange(),this._initVideoSlides(),this.slideshow&&!this.slideshowTimeout&&this.slideshowStart(),this.inited=!0):void 0)},highlight:function(){this.slideHighlighted&&(removeClass(this.slideHighlighted,"selected"),this.slideHighlighted=null,this.indexHighlighted=null),this.indexHighlighted!==this.indexCurrent&&(this.indexHighlighted=this.indexCurrent,this.slideHighlighted=this.slides[this.getIndex(this.indexCurrent)],addClass(this.slideHighlighted,"selected"))},handler:function(e){var t=e.target&&(e.target===this.outer||this.outer.contains(e.target));this.interacted!=t&&(this.interacted=t,t?(this.slideshowInterrupted=this.slideshow,this.slideshowStop()):(this.slideshow=this.slideshowInterrupted,this.slideshow&&this.slideshowStart()))},slideshowStart:function(){this.slideshow=!0,this.interacted||this._videosIsPlay||(this.slideshowStop(),this.slideshow=!0,this.slideshowTimeout=setTimeout(function(){this.slideshowTimeout=null,vk.rtl?this.indexRequired--:this.indexRequired++,this.serve()}.bind(this),this.options.slideshowDuration))},slideshowStop:function(){this.slideshow=!1,this.slideshowTimeout&&(clearTimeout(this.slideshowTimeout),this.slideshowTimeout=null)},addHandler:function(){this.init()&&(this.removeHandler(),this._handlerInst=this.handler.bind(this),addEvent(document,"mousemove",this._handlerInst))},removeHandler:function(){this._handlerInst&&removeEvent(document,"mousemove",this._handlerInst)},removeAllHandlers:function(){this.removeHandler(),this._arrowNextHandler&&removeEvent(this.arrowNext,"mousemove",this._arrowNextHandler),this._arrowPrevtHandler&&removeEvent(this.arrowPrev,"mousemove",this._arrowPrevtHandler)},requireIndex:function(e){this.indexRequired=this.getIndex(e||0),this.serve()},next:function(){if(this.init()){if(!this.options.infinite&&this.indexRequired>=this.slides.length-1)return;this.indexRequired++,this.serve()}},last:function(){this.indexRequired=this.slides.length-1,this.serve()},prev:function(){if(this.init()){if(!this.options.infinite&&this.indexRequired<1)return;this.indexRequired--,this.serve()}},getIndex:function(e,t){return void 0!==e?(e=e%this.slides.length+(e<0?this.slides.length:0))===this.slides.length?0:e:(e=(this.offsetInner-this.widthSide)/-this.widthSlide,t?e:Math.round(e))},serve:function(){if(this.init()){var e=this.getIndex(this.indexRequired),t=this.required!=e,i=-(this.indexRequired*this.widthSlide-(this.widthOuter-this.widthSlide)/2);this.required=e,t&&isFunction(this.options.onRequired)&&this.options.onRequired(),this.options.infinite||(this.indexRequired=this.required),this.animation.stop(),this.animation=new Fx.Base({style:{}},{duration:this.options.animationDuration,transition:Fx.Transitions.easeOutCubic,onComplete:this.served.bind(this),onStep:function(e){this.offsetInner=e.left,setStyle(this.inner,"left",this.offsetInner);var t=this.indexCurrent;this.indexCurrent=this.getIndex(),t!==this.indexCurrent&&(this.indexCurrent===this.indexRequired&&this.highlight(),this.rearrange(),isFunction(this.options.onChange)&&this.options.onChange())}.bind(this)}),this.animation.start({left:this.offsetInner},{left:i})}},served:function(){var e=this.indexCurrent-this.getIndex(this.indexCurrent);e>30&&(this.indexPrev=0,this.indexNext=this.slides.length-1,this.indexCurrent-=e,this.indexRequired-=e,this.offsetInner=-(this.indexRequired*this.widthSlide-(this.widthOuter-this.widthSlide)/2),this.inner.style.left=this.offsetInner+"px",each(this.slides,function(e,t){t.style.left=0})),this.hasVideoSlides&&this._serveVideoSlide(),this.rearrange(),isFunction(this.options.onSlide)&&this.options.onSlide(),this.slideshow&&this.slideshowStart()},rearrange:function(){if(this.options.infinite){for(;this.indexCurrent>=this.indexNext-this.indexMargin;){var e=this.getIndex(this.indexNext);this.slides[e].style.left=(this.indexNext-e)*this.widthSlide+"px",this.indexNext++,this.indexPrev++}for(;this.indexCurrent<=this.indexPrev+this.indexMargin;){var t=this.getIndex(this.indexPrev);this.slides[t].style.left=(this.indexPrev-t)*this.widthSlide+"px",this.indexPrev--,this.indexNext--}}this.current=this.getIndex(this.indexCurrent),this.slideNext=this.slides[this.options.infinite?this.getIndex(this.indexCurrent+1):this.indexCurrent+1]||null,this.slidePrev=this.slides[this.options.infinite?this.getIndex(this.indexCurrent-1):this.indexCurrent-1]||null,this.slideCurrent=this.slides[this.current]},update:function(){this.inited=!1,this.slides=domChildren(this.inner),this.init()},destroy:function(){this.slideshowStop(),this.removeAllHandlers(),this.hasVideoSlides=!1},getCurrentSlide:function(){return this.slides[this.current]},_initVideoSlides:function(){var e=this;each(this.slides,function(){if(domData(this,"video"))return e.hasVideoSlides=!0,!1}),e.hasVideoSlides&&(this._preloadVideos(),this._serveVideoSlide())},_isPreloadedVideo:function(e){var t=!1;return each(ajaxCache,function(i,o){if(0==i.indexOf("/al_video.php?act=show_inline")&&i.indexOf("&video="+e)>0)return t=!0,!1}),t},_onVideoPreloaded:function(e,t){if(e){var i=t[3].player.params[0];VideoPlayer.preload(i)}},_preloadVideos:function(){var e=this;each(this.slides,function(){if(domData(this,"video")){var t=e._getVideoParams(this);e._isPreloadedVideo(t.video)||loadInlineVideo(t,e._onVideoPreloaded,!0)}})},_onVideoStop:function(){this._videosIsPlay=!1,this.interacted=!1,this.slideshowStart()},_onVideoStart:function(){this._videosIsPlay=!0,this.interacted=!0,this.slideshowStop()},_onVideoLoaded:function(e,t){this.videoPlayer=t,t.on("media.playing",function(){this.getCurrentSlide()===e?this._onVideoStart():(t.seekTo(0),t.pause())}.bind(this)),t.on("media.ended",function(){this._onVideoStop(),this.next()}.bind(this)),t.on("media.error",function(){this._onVideoStop(),this.next()}.bind(this)),t.on("media.pause",this._onVideoStop.bind(this)),t.on("_destroy",this._onVideoStop.bind(this))},_getVideoParams:function(e){return{video:domData(e,"video"),list:domData(e,"hash"),autoplay:1,from_autoplay:1,module:"apps_slider",addParams:{from_autoplay:1},no_progress:1,cache:1}},_serveVideoSlide:function(){var e=this.getCurrentSlide(),t=void 0,i=void 0,o=void 0,n=void 0;domData(e,"video")?(t=geByTag1("img",e),i=domData(t,"loading"),o=domData(t,"playing"),i||o?this._canUseVideo()&&this.videoPlayer&&this.videoPlayer.play():((n=this._getVideoParams(e)).onLoaded=this._onVideoLoaded.bind(this,e),this._canUseVideo()&&showInlineVideo(n.video,n.list,n,!1,t))):this._canUseVideo()&&this.videoPlayer&&this.videoPlayer.pause()},_canUseVideo:function(){var e=window.wkcur&&window.wkcur.shown&&window.wkLayerWrap&&isVisible(window.wkLayerWrap)||window.Videoview.isLayerShown();if(e)return!1;var t=cur.videoInlinePlayer?cur.videoInlinePlayer.getState():"unknown",i=~["paused","ended"].indexOf(t);return!cur.videoInlinePlayer||cur.videoInlinePlayer===this.videoPlayer||i&&!e}},window.Apps=window.Apps||{optionHiddenClass:"apps_hidden",optionLoadingClass:"loading",address:"apps",init:function init(obj,appTpl){var _this3=this;if(extend(cur,{module:"apps",preventFastBack:!1,aTabs:ge("apps_top_tabs"),aSubTabs:geByClass1("_apps_top_subtabs"),aSearch:ge("s_search"),aSearchWrap:ge("apps_search"),aWrap:ge("apps_wrap"),aSummary:ge("apps_summary"),aSummaryCounter:ge("apps_summary_counter"),lShowMoreButton:ge("apps_list_show_more"),lPreload:ge("apps_list_preload"),lContent:ge("apps_list_content"),fWrap:ge("apps_feed"),fShowMoreButton:ge("apps_feed_show_more"),rNotCounter:ge("apps_recent_notifications_counter"),rNotWrap:ge("apps_recent_notifications_wrap"),rNotNoContent:ge("apps_recent_notifications_no_content"),rNotBlackList:ge("apps_recent_notifications_black_list"),rNotShowMoreButton:ge("apps_recent_notifications_show_more"),rAppsWrap:ge("apps_recent_apps_wrap"),rAppsShowMoreButton:ge("apps_recent_more"),rAppsNoContent:ge("apps_recent_apps_no_content"),onSilentLoad:{},apps:{},deletedApps:{},appTpl:appTpl||function(){return""}}),extend(cur,obj),cur.defaultCount=cur.shownApps,"notifications"===nav.objLoc.act&&(delete nav.objLoc.act,nav.objLoc.tab="notifications",nav.setLoc(nav.objLoc)),this.setHistoryBackRules(),this.searchLoadFromAddressBar(),cur.aSearch&&(uiSearch["list"===cur.section?"setFixed":"setStatic"](cur.aSearch),uiSearch.startEvents(cur.aSearch)),setTimeout(function(){this.scrollCheckBinded=this.scrollCheck.bind(this),this.sliderInit(),this.feedInit(),this.notificationsInit(),cur.scrollToHeader&&(setTimeout(this.scrollToHeader.bind(this),100),delete cur.scrollToHeader),cur.scrollToTop&&(scrollToTop(),delete cur.scrollToTop),this.startEvents(),cur.destroy.push(function(e){setTimeout(function(){var t=void 0;e.fScrollbar&&cur.fScrollbar!=e.fScrollbar&&(t=!1,globalHistory.forEach(function(i){i.cur!=e&&i.cur.fScrollbar==e.fScrollbar&&(t=!0)}),t||e.fScrollbar.destroy()),e.rNotScrollbar&&cur.rNotScrollbar!=e.rNotScrollbar&&(t=!1,globalHistory.forEach(function(i){i.cur!=e&&i.cur.rNotScrollbar==e.rNotScrollbar&&(t=!0)}),t||e.rNotScrollbar.destroy())},0),cur.featuredSlider&&(cur.featuredSlider.destroy(),cur.featuredSlider=null)}.pbind(cur)),cur.destroy.push(this.stopEvents.bind(this)),cur.aSearch&&uiSearch.scrollResize(cur.aSearch)}.bind(this),0),cur.silent_mode){cur.silent=!0,cur.preload&&(cur.leavePreloadedHeader||delete cur.preload.header,cur.leavePreloadedBefore||delete cur.preload.before);var query={act:"load_apps_silent",gid:cur.gid,oid:cur.oid,header:cur.leavePreloadedHeader?0:1,before:cur.leavePreloadedBefore?0:1,section:cur.section,preload:1,preloaded:[]},prop=null;for(prop in cur.preload=cur.preload||{},cur.preload)cur.preload.hasOwnProperty(prop)&&query.preloaded.push(prop);ajax.post(this.address,query,{cache:1,local:1,onDone:this.withFastBackCheck(function(json,preload,preloadBefore,preloadHeader){cur.preload=extend(cur.preload||{},preload),cur.preload.before=preloadBefore,cur.preload.header=preloadHeader,json=eval("("+json+")"),cur.curList="all",cur.appsList=json&&json[cur.curList]?json:{all:[]},cur.sectionCount=cur.appsList[cur.curList].length,void 0===cur.searchOffset&&(cur.searchOffset=0),json?_this3.indexAll(function(){return _this3.onSilentLoad()}):_this3.onSilentLoad()})})}},onSilentLoad:function(){if(cur.silent=!1,cur.onSilentLoad)for(var e in cur.onSilentLoad)cur.onSilentLoad.hasOwnProperty(e)&&isFunction(cur.onSilentLoad[e])&&cur.onSilentLoad[e]()},withFastBackCheck:function(e){cur.preventFastBack=!0;var t=cur;return function(){cur===t&&(cur.preventFastBack=!1,e.apply(null,Array.prototype.slice.call(arguments)))}},startEvents:function(){addEvent(window,"scroll",this.scrollCheckBinded),addEvent(window,"resize",this.scrollCheckBinded),this.initUpdates(),this.scrollCheck(),this.sliderStart()},stopEvents:function(){removeEvent(window,"scroll",this.scrollCheckBinded),removeEvent(window,"resize",this.scrollCheckBinded),this.stopUpdates(),this.sliderStop()},isSection:function(){for(var e=arguments.length;e--;)if(arguments[e]===cur.section)return!0;return!1},isDelayedOnSilentLoad:function e(t,i){if(cur.silent)return e.count=e.count||0,e.count++,cur.onSilentLoad[t||"key_"+e.count]=i,!0},handlePageCount:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return handlePageCount("ap",e)}),incomingCall:function(e){var t=this;stManager.add(["notifier.js","notifier.css","apps.css","call.css"],function(){var i=se('<div><div class="call_apps_wrap clear_fix">'+e+"</div></div>"),o={movable:geByClass1("call_invitation_wrap",i,"div"),startLeft:parseInt((window.innerWidth-224)/2)+"px",startTop:parseInt((window.innerHeight-404)/2)+"px",startWidth:224,startHeight:404,resize:!1,onBeforeHide:function(){},onDragEnd:function(e,t){},onResize:function(e,t){}};t.appCall&&t.appCall.close(),t.appCall=new RBox(i,o)}),window.Notifier&&Notifier.setRecvClbk("apps_call_hide",function(){t.appCall&&(t.appCall.close(),t.appCall=!1)})},callApprove:function(e){window.Notifier&&Notifier.lcSend("apps_call_hide",(new Date).getTime()),this.appCall&&(this.appCall.close(),this.appCall=!1),nav.go(e)},callReject:function(){window.Notifier&&Notifier.lcSend("apps_call_hide",(new Date).getTime()),this.callOnReject()},callOnReject:function(){this.appCall&&(this.appCall.close(),this.appCall=!1),ajax.post("/al_apps.php",{act:"do_call_reject"},{onDone:function(){}})},editBlacklist:function(){return showBox(this.address,{act:"blacklist_box",height:lastWindowHeight},{stat:["privacy.css","indexer.js"]}),!1},blacklistInit:function(e,t,i){i=i||{};var o=geByClass1("apps_blacklist_wrap",e.bodyNode),n=geByClass1("apps_blacklist",e.bodyNode),a=geByClass1("olist_more",e.bodyNode,"a"),s={},r=new vkIndexer(t,function(e){return e[1]});e.setOptions({width:560,bodyStyle:"padding: 0px"}),e.removeButtons().addButton(getLang("global_close"),function(){e.hide(200)},"yes"),n.parentNode.style.height=i.boxHeight+"px";var c=ge("apps_blacklist_filter");i.nofocus||setTimeout(elfocus.pbind(c),100);var l=data(c,"opts");function p(){if(o.scrollTop>0?addClass(e.bodyNode.parentNode,"olist_topsh"):removeClass(e.bodyNode.parentNode,"olist_topsh"),o.scrollTop+(o.offsetHeight||o.clientHeight)<n.scrollHeight?addClass(e.bodyNode.parentNode,"olist_botsh"):removeClass(e.bodyNode.parentNode,"olist_botsh"),a&&a.offsetTop&&a.onclick){var t=a.offsetTop;n.scrollTop+(n.offsetHeight||n.clientHeight)+100>=t&&a.onclick()}}function d(o,s){var c,l=void 0,p=(s=s||0)?60:120;o&&(o=clean(o).replace(/\u2013|\u2014/g,"-")),l=o?r.search(o):t,c=i.tpl;var u=l.length;l=l.slice(s,s+p);var h=[],_=void 0;if(o){var f=escapeRE(o),g=parseLatin(o);null!=g&&(f=f+"|"+escapeRE(g)),_=new RegExp("(?![^&;]+;)(?!<[^<>]*)((\\(*)("+f+"))(?![^<>]*>)(?![^&;]+;)","gi")}each(l,function(){h.push(rs(c,function(e,t,i,o){var n=e[1];if(t){n=-1==t.indexOf(" ")?n.split(" "):[n];var a="";for(var s in n)n.hasOwnProperty(s)&&(a+=(s>0?" ":"")+n[s].replace(o,"$2<em>$3</em>"));n=a}return{id:e[0],name:n,photo:e[2],link:e[3]||(e[0]>0?"id"+e[0]:"app"+(1e9-e[0]))}}(this,o,0,_)))}),s||h.length||h.push('<div class="no_rows">'+(o?getLang("global_search_not_found").replace("{search}",clean(o)):i.lang.apps_blacklist_empty)+"</div>"),re(a),h=h.join(" "),s?n.appendChild(cf(h)):val(n,h),u>s+p&&(n.appendChild(a),a.onclick=function(e){return d(o,s+p),Object(_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.c)(e)}),e&&e.scroll&&e.scroll.update(!1,!0)}data(c,"opts",extend(l,{onChange:d})),a&&(isVisible(a)?a.onclick=function(e){return d("",60),Object(_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.c)(e)}:(re(a),show(a))),addEvent(n,"click",function(i){var o=i.originalTarget||i.target;hasClass(o,"olist_item_wrap")||(o=gpeByClass("olist_item_wrap",o));if(!o||o==bodyNode)return;if(hasClass(o,"olist_item_loading"))return Object(_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.c)(i);if(checkEvent(i))return!0;e.changed=!0;var a=o.id.match(/-?\d+/)[0],r=s[a],l=!1;each(t,function(){if(this[0]==a)return l=this[4],!1}),ajax.post("/al_apps.php",{act:"a_blacklist_delete",cancel:r?1:0,owner_id:a,hash:l},{onDone:function(){toggleClass(o,"olist_item_wrap_on",!r),s[a]=!r},showProgress:function(){addClass(o,"olist_item_loading")},hideProgress:function(){removeClass(o,"olist_item_loading")}}),n.scrollTop<50&&setTimeout(function(){elfocus(c),val(c).length&&c.select()},100);return Object(_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.c)(i)}),addEvent(o,"scroll",p),setTimeout(p,10)},initDescription:function(e){var t=geByClass1("apps_i_description_content");val(t,e);var i=parseInt(getStyle(t,"line-height"));Math.ceil(getSize(t)[1]/i)>7&&(setStyle(t,"height",5*i),val(t,e),removeClass(geByClass1("apps_i_description_show_more"),this.optionHiddenClass))},showFullDescription:function(){addClass(geByClass1("apps_i_description_show_more"),this.optionHiddenClass),setStyle(geByClass1("apps_i_description_content"),"height","")},appSsSliderNext:function(e){e?cur.appSsSlider&&cur.appSsSlider.next():cur.wkviewAppsSlider&&cur.wkviewAppsSlider.next()},initAppSsSlider:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t=t||"";var o=ge("apps_i_slider_next"+t),n=ge("apps_i_slider_prev"+t),a=ge("apps_i_slider_outer"+t),s=ge("apps_i_slider_thumbs"+t),r=s?domPN(s):null,c=s?s.children:[],l=null,p=null,d=void 0;function u(){if(s){var e=r.offsetWidth,t=s.scrollWidth;if(t<=e||!t||!e)return;null===l&&(l=0);var i=c[l],o=i.offsetLeft,n=(e-i.offsetWidth)/2-o;n=Math.max(-t+e,Math.min(0,n)),p&&p.stop(),p=animate(s,{left:n},{duration:d.options.animationDuration,transition:Fx.Transitions.easeOutCubic})}}function h(e){if(Array.from(c).forEach(function(e){removeClass(e,"in-view")}),0===e)for(var t=e;t<=2;t++)addClass(c[t],"in-view");else if(function(e){return e>=d.slides.length-2}(e))for(var i=d.slides.length-4,o=d.slides.length-1;o>i;)addClass(c[o],"in-view"),o--;else for(var n=e-1;n<=e+1;n++)addClass(c[n],"in-view")}function _(){var t;t=null!==d.required?d.required:d.current,s&&t!==l&&(null!==l&&removeClass(c[l],"selected"),l=t,e&&h(l),addClass(c[l],"selected"),u())}function f(){d.slideNext?addClass(o,"apps_i_slider_available"):removeClass(o,"apps_i_slider_available"),d.slidePrev?addClass(n,"apps_i_slider_available"):removeClass(n,"apps_i_slider_available"),hasClass(d.slideCurrent,"apps_promo_video_slide")?addClass(a,"apps_i_slider_video"):removeClass(a,"apps_i_slider_video"),d.slideNext?removeClass(a,"apps_i_slider_run"):addClass(a,"apps_i_slider_run")}if(d=new AppsSlider({inner:ge("apps_i_slider_inner"+t),outer:a,next:o,prev:n,onChange:f,onRequired:_,infinite:!1,isVkApp:e}),i?cur.appSsSlider=d:cur.wkviewAppsSlider=d,f(),_(),each(c,function(e,t){var i=new Image;i.onload=u,i.src=geByTag1("img",t).src,addEvent(t,"click",function(){d&&d.requireIndex(e)})}),cur.promoVideo){var g=ge("apps_promo_video_thumb"+t);g&&showInlineVideo(cur.promoVideo,"",{autoplay:1,module:"app_promo",addParams:{from_autoplay:1}},null,g)}},initSimilarAppsSlider:function(){var e=document.querySelector(".apps_similarApps");if(e){var t=e.querySelector(".apps_similarApps__listContent");t&&stManager.add(["ui_common.js"],function(){var e=function(e){window.tooltips&&tooltips.hideAll();var i=Math.abs(e.deltaX||e.wheelDeltaX||0);Math.abs(e.deltaY||e.wheelDeltaY||0)>i&&(Object(_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.c)(e),t.scrollLeft+=uiScroll.scrollEventDelta(e))};addEvent(t,browserFeatures.wheelEvent,e),cur.destroy.push(function(){removeEvent(t,browserFeatures.wheelEvent,e)})})}},showWinInstructions:function(e,t,i){setTimeout(function(){new MessageBox({width:800,title:cur.winInstrTitle,hideButtons:!0,containerClass:"apps_win_instr_wrap"}).content(rs(trim(cur.winInstrTpl),{download_link:t,help_link:i})).show()},500)},sendInstallRequest:function(e,t,i,o,n,a,s){var r=!!geByClass1("apps_install_header");if(e&&!isButtonLocked(e)&&!hasClass(e,"button_disabled")){lockButton(e);var c=getSize(e),l=window.isAppLanding?"apps":this.address;if(t){var p={act:"send_install_request",aid:i,ref:o,cid:n,hash:a},d=/^\/app(\d+)_?(-\d+)?(#(.*))?$/.exec(location.pathname);d&&d.length>2&&parseInt(d[2],10)<0&&(p.group_id=Math.abs(parseInt(d[2]))),ajax.post(l,p,{onDone:function(){window.isAppLanding&&(ge("apps-landing-modal-trigger").checked=!0,addClass(e,"button__disabled"))},onFail:function(){window.isAppLanding&&(ge("apps-landing-modal-trigger-fail").checked=!0)},hideProgress:function(){var t=getLang("apps_install_push_sent_msg");unlockButton(e),addClass(e,"button_disabled"),s||setStyle(e,"width",c[0]),!window.isAppLanding&&val(e,t);var i=ge("apps_i_run_box");addClass(i,"sent"),val(i,t)}})}else cur.ref=o,ajax.post(this.address,{act:"send_install_request_box",aid:i},{onDone:function(t,n,a){if(unlockButton(e),n){cur.lang||(cur.lang={}),extend(cur.lang,t);var s=new MessageBox({title:getLang("apps_get_push_w_install_link")});s.removeButtons(),s.content(n),s.addButton(getLang("apps_install_sms_send"),function(t){if(e=ge("apps_i_request_btn")||e,t&&e&&!isButtonLocked(t)){var n=getSize(e);lockButton(t),ajax.post(this.address,{act:"send_install_request",ref:o,aid:i,cid:-3,hash:a},{onFail:function(e){if(e){var i=ge("app_sms_tt_error");val(i,e),show(i),unlockButton(t)}},onDone:function(){this.ttDestroyAll(),s.hide();var i=getLang("apps_install_push_sent_msg");unlockButton(t),addClass(e,"button_disabled"),r||setStyle(e,"width",n[0]),val(e,i);var o=ge("apps_i_run_box");addClass(o,"sent"),val(o,i)}.bind(this)})}}.bind(this),"yes"),s.addButton(getLang("global_cancel"),s.hide,"no"),s.show()}else showBox("activation.php",{act:"change_phone_box",hash:a})}.bind(this)})}},deletingApp:!1,showInviteBox:function(e,t){e||(e=cur.app.options.aid,t=cur.app.options.hash),showTabbedBox("al_friends.php",{act:"select_friends_box",checked:"",invite:1,aid:e,from:"apps"},{stat:["privacy.js","ui_controls.js","ui_controls.css"],cache:1,params:{dark:1}}),cur.onFlistSave=function(i,o){ajax.post("apps",{act:"invite_friends",aid:e,friends:i.join(","),hash:t},{onDone:function(e,t){setTimeout(showFastBox({title:e},t).hide,2e3)},onFail:function(e){return setTimeout(showFastBox({title:getLang("global_error")},e).hide,2e3),!0}})}},showAppFriends:function(e,t,i){var o=showBox(this.address,{act:"show_app_friends_box",aid:e},{cache:1,dark:1,params:{width:"400px",bodyStyle:"padding: 0px"},onDone:function(){new uiScroll("apps_friendslist")}},t);return o.setControlsText('<a href="" onclick="Apps.showInviteBox('+e+", '"+i+"'); return false;\">"+getLang("apps_invite_friends")+"</a>"),o},recountAddVotes:function(e){var t=e.value.replace(/[^0-9]/g,"");val("add_votes",getLang("votes_flex",t)),t>0&&ge("app_pay_withdraw")&&(ge("app_pay_withdraw").value=0,this.recountWithdrawVotes(ge("app_pay_withdraw")))},recountWithdrawVotes:function(e){var t=e.value.replace(/[^0-9]/g,"");val("withdraw_votes",getLang("votes_flex",t)),t>0&&(ge("app_pay_add").value=0,this.recountAddVotes(ge("app_pay_add")))},initAppView:function(e,t){t.layer||cur.nav.push(function(e,i,o,n){if(void 0===e[0]&&!e.join&&!n.pass){if(e["#"])return cur.app.onLocChanged(e["#"]),n.back?3!=vk.al&&nav.setLoc(o):nav.setLoc(o),!1;if(!t.not_block_nav)return nav.setLoc(o),!1}});var i=void 0,o=void 0;cur.app.params.is_vkpay_service&&(i=function(){t.layer||cur.app.runCallback("onWindowBlur")},o=function(){var e=window.innerWidth||document.documentElement.clientWidth||bodyNode.clientWidth,t=window.innerHeight||document.documentElement.clientHeight||bodyNode.clientHeight;cur.app.runCallback("onTopWindowResized",e,t),cur.app.setVkPayMobileHeight()},cur.app.setVkPayMobileHeight());var n=function(e){cur.app._lastFocusState!==e.type&&("block"==e.type?cur.app.runCallback("onWindowBlur"):cur.app.runCallback("onWindowFocus")),cur.app._lastFocusState=e.type};cur.app.onReady.push(function(){cur.app&&(cur.app.onLocChanged(e.hash),addEvent(document,"block unblock",n,!0),i&&addEvent(window,"mousedown",i),o&&addEvent(window,"resize",o),cur.destroy.push(function(){removeEvent(document,"block unblock",n),i&&removeEvent(window,"mousedown",i),o&&removeEvent(window,"resize",o)}))}),t.icon&&(setFavIcon(t.icon),cur.destroy.push(function(){setFavIcon("/images/favicon"+(vk.intnat?"_vk":"new")+window._iconAdd+".ico")})),this.initSimilarAppsSlider()},initVkConnect:function(e,t,i,o,n){Object(_shared_apps_connect_lib__WEBPACK_IMPORTED_MODULE_5__.a)(e,t,i,o,n)},loadSettings:function(e){ajax.post(this.address,{act:"show_settings",aid:cur.aid},extend({cache:1},e))},showSettings:function(){this.ttHideAll(),cur.settShown?(scrollToTop(200),cur.settShown=!1,delete ajaxCache["/apps#act=show_settings&aid="+cur.aid]):showBox(this.address,{act:"show_settings",aid:cur.aid},{params:{dark:1}})},saveSettings:function(e,t,i,o){var n=this;if(!cur.savingSettings){i||(o&&o.btn&&lockButton(o.btn),show("apps_settings_progress"));var a=curBox(),s=ge("app_pay_add"),r=ge("app_pay_withdraw"),c={act:"save_settings",aid:e,hash:t,from:"appview",app_settings_1:isChecked("app_settings_1"),app_settings_256:isChecked("app_settings_256"),add:s?s.value:0,withdraw:r?r.value:0,only_checkboxes:i?1:0,cur_aid:cur.aid};isVisible("app_settings_2097152")&&(c.app_settings_2097152=isChecked("app_settings_2097152")),ajax.post("apps",c,extend({onDone:function(e){o&&o.btn&&unlockButton(o.btn),e.left_nav&&n.updateLeftNav(e.left_nav),!i&&cur.app&&cur.app.runCallback("onSettingsChanged",e.settings),cur.settingsOnLoad=!1,void 0!==e.coins&&cur.app&&cur.app.balanceUpdated(e.coins),void 0!==e.balance&&updateMoney(e.balance),a&&!i&&a.hide(),n.addToMenuErrorResolve(e,function(e){i&&checkbox("app_settings_256",256&e.settings)}),n.updateAddToMenuAction()},onFail:function(e){e&&val("apps_settings_error",e),show("apps_settings_error"),hide("apps_settings_progress"),scrollToTop(200)},showProgress:function(){cur.savingSettings=!0,a&&a.showProgress()},hideProgress:function(){cur.savingSettings=!1,a&&a.hideProgress()}},o||{}))}},updateAddToMenuAction:function(){var e=ge("app_add_to_menu_action");if(e&&cur.aid&&cur.app&&cur.app.options){var t=ge("l_app"+cur.aid),i={add:cur.app.options.vkApp?getLang("apps_vk_app_add_to_favourite"):getLang("apps_add_to_left_menu"),remove:cur.app.options.vkApp?getLang("apps_vk_app_remove_from_favourite"):getLang("apps_remove_from_left_menu")};actionsMenuItemLocked(e)&&unlockActionsMenuItem(e),e.setAttribute("onclick","return Apps.addToMenu("+cur.aid+", '"+cur.app.options.hash+"', "+intval(!t)+", this);"),val(e,t?i.remove:i.add)}},addToMenu:function(e,t,i,o){var n=this;actionsMenuItemLocked(o)||ajax.post("al_apps.php",{act:"a_left_menu",aid:e,hash:t,show:i},{onDone:function(e){n.updateLeftNav(e.left_nav),n.updateAddToMenuAction(),n.addToMenuErrorResolve(e)},showProgress:lockActionsMenuItem.pbind(o),hideProgress:unlockActionsMenuItem.pbind(o)})},vkAppNotifications:function(e,t,i,o){var n=this;actionsMenuItemLocked(o)||ajax.post("al_apps.php",{act:"vk_app_notifications",aid:e,hash:t,allow:i},{onDone:function(e){n.updateNotificationsAction(e)},showProgress:lockActionsMenuItem.pbind(o),hideProgress:unlockActionsMenuItem.pbind(o)})},updateNotificationsAction:function(e){var t=ge("app_notifications_action");if(t&&cur.aid&&cur.app&&cur.app.options){var i=e,o={add:getLang("apps_vk_app_notifications_action_enable"),remove:getLang("apps_vk_app_notifications_action_disable")};actionsMenuItemLocked(t)&&unlockActionsMenuItem(t),t.setAttribute("onclick","return Apps.vkAppNotifications("+cur.aid+", '"+cur.app.options.hash+"', "+intval(!i)+", this);"),val(t,i?o.remove:o.add)}},addToMenuErrorResolve:function(e,t){e.left_nav_error?window.menuSettings&&cur.app?(cur.settingsBoxSetLeftMenuAppCallback=function(i){delete cur.settingsBoxSetLeftMenuAppCallback,!i||256&e.settings||(e.settings+=256),isFunction(t)&&t(e)},showTabbedBox("al_settings.php",{act:"menu_box",type:2,aid:cur.aid})):(showFastBox({title:getLang("global_error")},e.left_nav_error),isFunction(t)&&t(e)):isFunction(t)&&t(e)},showAppSettings:function(e,t){this.ttHideAll(),t?showBox(this.address,{act:"settings_box_info",aid:e},{params:{dark:1}}):showBox(this.address,{act:"settings_box",aid:e,mask:0,main:1},{params:{dark:1}})},updateOnline:function(){ajax.post(this.address,{act:"update_online",aid:cur.aid,hash:cur.app.options.hash},{ads:1})},updateOffline:function(e){ajax.post(this.address,{act:"update_offline",aid:(e||cur).aid,hash:(e||cur).app.options.hash})},deleteApp:function(e,t,i,o){if(!this.deletingApp){this.deletingApp=!0;cur.app&&cur.app.options&&cur.app.options.vkApp&&this.deleteVkApp();var n=function(i,o,n,a){ajax.post(this.address,{act:"quit",id:e,hash:t||cur.app.options.hash,from:"app"},{onDone:this.withFastBackCheck(function(e){this.deletingApp=!1,window.appsListChanged=!0,this.notificationsSetCounters(e.count_all),e.left_nav&&this.updateLeftNav(e.left_nav),cur._back=!1,i.apply(null,[].slice.call(arguments))}.bind(this)),onFail:this.withFastBackCheck(function(){this.deletingApp=!1,o.apply(null,[].slice.call(arguments))}.bind(this)),showProgress:n,hideProgress:a})}.bind(this);switch(o){case"appactions":n(function(){nav.go("/apps?act=popular",!1)},function(e){e&&showFastBox({title:getLang("global_error")},e),unlockActionsMenuItem(i)},lockActionsMenuItem.pbind(i));break;default:var a=curBox();n(function(){nav.go("/apps?act=popular",!1)},function(e){if(e){var t=ge("apps_settings_error");val(t,e),show(t),scrollToTop()}a&&a.hideProgress()},function(){a&&a.showProgress()})}}},reportApp:function(e,t){showBox("al_reports.php",{act:"report_app_box",app_id:e,place_id:t},{params:{dark:1},stat:["ui_controls.js","ui_controls.css"]})},cancelInstall:function(){nav.go("/apps",!1)},deleteVkApp:function(){var e=cur.app.options.aid,t=cur.app.options.layer&&ge("app_"+e+"_container_layer")?"app_"+e+"_container_layer":"app_"+e+"_container";cur.vkAppQueue[t]&&cur.vkAppQueue[t].destroyView(),delete cur.vkAppQueue[t]},approveInstall:function(e,t,i){i&&actionsMenuItemLocked(i)||(i&&lockActionsMenuItem(i),window.appsListChanged=1,cur.app.options.vkApp&&this.deleteVkApp(),nav.go(extend(nav.objLoc,{join:1,hash:e,sett:t,notify:isChecked("apps_notifications_checkbox")&&isVisible("apps_notifications_checkbox")?1:void 0}),!1,{pass:!0}))},installApp:function(e,t,i){var o=this;ajax.post(this.address,{act:"do_install",aid:e,hash:t},{onDone:function(e){e==cur&&(o.onAppAdded(),i&&i())}})},onAppAdded:function(){window.appsListChanged=!0,cur.preload&&delete cur.preload.before,cur.app&&(cur.app.runCallback("onApplicationAdded"),cur.appUser=!0,hide("apps_install_btn"),show("apps_show_settings"))},rateOver:function(e){var t=!!geByClass1("apps_install_header");cur.rated||hasClass(e,"not_installed")||addClass(e,"over");var i="",o=[],n=0,a=[cur.installPage?-70:-66,0,-36],s="left",r=15,c=0,l=cur.appUser?cur.userRate?getLang("apps_you_voted"):getLang("apps_you_not_voted"):getLang("apps_rating_title"),p=rs(cur.rateStatsLabelTpl,{label:l});for(var d in cur.rateStats=cur.rateStats||{},cur.rateStats)cur.rateStats.hasOwnProperty(d)&&(n+=intval(cur.rateStats[d]));val("app_rate_label",l);for(var u=1;u<=5;u++){i+='<span class="app_rate stats fl_r"></span>';var h=intval(cur.rateStats[u]),_=n?intval(100*h/n):0,f=langNumeric(h,"%s",!0),g=cur.userRate!=10*u&&cur.userRate?"":"my";o.push(rs(cur.rateStatsRowTpl,{id:"apps_rate_row"+u,stars:i,count:f,percent:_,classname:g}));var v=ge("apps_rate_row"+u);v&&(setStyle(geByClass1("app_rate_bg",v),{width:_+"%"}),val(geByClass1("app_rate_percent",v),_+"%"),val(geByClass1("app_rate_cnt",v),f),geByClass1("app_rate_stars",v).className="app_rate_stars fl_l "+g)}p+=o.reverse().join(""),t&&(s="top",a=[210,0,10],r=0,c=15),showTooltip(e,{text:p,slideX:r,slide:c,className:"app_rate_tt",shift:a,forcetodown:!0,dir:s,hasover:1})},rateOut:function(e){this.showRate(),removeClass(e,"over")},rateApp:function(e){var t=this;if(cur.rated)return!1;var i=ge("apps_ratings");cur.appRate=cur.userRate=e,this.rateOut(i),cur.rated=!0,ajax.post("/al_apps.php",{act:"rate_app",aid:cur.aid,rate:e,hash:cur.rate_hash},{onDone:function(e){cur.rateStats=e,t.rateOver(i)}})},showRate:function(e){if(cur.rated)return!1;var t=intval(cur.appRate||0),i=geByClass("app_rate",ge("apps_ratings")),o=Math.floor((t+2)/10),n=Math.floor((t+2)/5)-o;for(var a in i)if(i.hasOwnProperty(a)){var s="app_rate fl_l "+(a<o?"full":a<n?"half":"empty");i[a].className=s}if(e){var r=Math.floor(e/10);for(var c in i)if(i.hasOwnProperty(c)){if(c>=r)break;i[c].className+=" over"}}},recentTabsUpdate:function recentTabsUpdate(needApps,needNotifications){if(cur.rAppsWrap&&cur.rNotWrap){if(needApps=window.appsListChanged||needApps,needNotifications=window.notificationsListChanged||needNotifications,delete window.appsListChanged,delete window.notificationsListChanged,!needApps&&!needNotifications)return;ajax.post(this.address,{act:"update_recent",notifications:needNotifications,apps:needApps,hash:cur.recentUpdateHash},{onDone:this.withFastBackCheck(function(apps,notifications){if(apps&&(each(geByClass("apps_recent_row",cur.rAppsWrap),function(e,t){re(t)}),apps[0]?(show(cur.rAppsShowMoreButton),hide(cur.rAppsNoContent),domInsertBefore(cf(apps[0]),cur.rAppsShowMoreButton)):(hide(cur.rAppsShowMoreButton),show(cur.rAppsNoContent)),cur.recentOffset=apps[1],apps[2]))for(var i in apps[2]=eval("("+apps[2]+")"),apps[2])apps[2].hasOwnProperty(i)&&(cur.apps[apps[2][i][0]]=apps[2][i]);if(notifications){each(geByClass("apps_notification_row",cur.rNotWrap),function(e,t){re(t)});var tab=ge("apps-recent-notifications-tab");notifications[0]?((notifications[2]?hide:show)(cur.rNotShowMoreButton),show(tab),hide(cur.rNotNoContent),domInsertBefore(cf(notifications[0]),cur.rNotShowMoreButton)):(hide(cur.rNotShowMoreButton),show(cur.rNotNoContent),"notifications"!=nav.objLoc.tab&&hide(tab)),cur.notificationsOffset=notifications[1],cur.notificationsNewest=notifications[4],this.notificationsSetCounters(notifications[3]),this.notificationsInit()}this.ttDestroyAll()}.bind(this)),showProgress:function(){needApps&&addClass(cur.rAppsWrap,this.optionLoadingClass),needNotifications&&addClass(domPN(cur.rNotWrap),this.optionLoadingClass)},hideProgress:this.withFastBackCheck(function(){needApps&&removeClass(cur.rAppsWrap,this.optionLoadingClass),needNotifications&&removeClass(domPN(cur.rNotWrap),this.optionLoadingClass)}.bind(this))})}},optionNotificationsReadTimeout:1e3,notificationsReadTimeout:null,notificationsRemovedCount:0,notificationTabSelect:function(){nav.objLoc.tab="notifications",nav.setLoc(nav.objLoc),removeClass(cur.rNotBlackList,this.optionHiddenClass),cur.rNotScrollbar&&cur.rNotScrollbar.update(),this.notificationsReadContent()},notificationsInit:function(){cur.rNotWrap&&cur.notificationsOffset&&!cur.rNotScrollbar?(this.notificationsRemovedCount=0,cur.rNotScrollbar=new uiScroll(cur.rNotWrap,{autoresize:!1,global:!0,onmore:this.notificationsLoadContent.bind(this),onscroll:this.notificationsReadContent.bind(this)}),this.notificationsReadContent()):cur.rNotWrap&&cur.rNotScrollbar&&(cur.rNotScrollbar.update(),this.notificationsReadContent())},notificationsMarkReaded:function(e){e.removeAttribute("data-read"),removeClass(e,"apps_notification_row_new")},notificationsReadContent:function(){"notifications"===nav.objLoc.tab&&(this.notificationsReadTimeout&&clearTimeout(this.notificationsReadTimeout),this.notificationsReadTimeout=setTimeout(function(){var e=[],t=[];each(cur.rNotWrap.querySelectorAll('div[data-read="1"]'),function(i,o){o.offsetTop+o.offsetHeight/2<=cur.rNotScrollbar.data.scrollTop+cur.rNotScrollbar.data.viewportHeight&&(e.push(o.getAttribute("data-id")),t.push(o))}),e.length&&ajax.post(this.address,{act:"a_mark",newest:cur.notificationsNewest,notif_ids:e.join(","),hash:cur.notificationsHash},{onDone:this.withFastBackCheck(function(e){this.notificationsSetCounters(e),each(t,function(e,t){this.notificationsMarkReaded(t)}.bind(this))}.bind(this))})}.bind(this),this.optionNotificationsReadTimeout))},notificationsLoadContent:function(){isVisible(cur.rNotShowMoreButton)&&!isButtonLocked(cur.rNotShowMoreButton)&&(lockButton(cur.rNotShowMoreButton),ajax.post(this.address,{act:"more_notifications",offset:cur.notificationsOffset,hash:cur.notificationsHash},{onDone:this.withFastBackCheck(function(e,t,i){unlockButton(cur.rNotShowMoreButton),cur.notificationsOffset=t,e&&cur.rNotShowMoreButton&&cur.rNotShowMoreButton.parentNode.insertBefore(cf(e),cur.rNotShowMoreButton),i&&hide(cur.rNotShowMoreButton),cur.rNotScrollbar.update()}),onFail:this.withFastBackCheck(function(){hide(cur.rNotShowMoreButton)})}))},notificationsRemoveAll:function(e,t,i,o,n){if(!linkLocked(e)&&!checkEvent(n)){var a=showFastBox({title:t},i,getLang("global_delete"),function(t){ajax.post(this.address,{act:"remove_all_notifications_and_requests",newest:cur.notificationsNewest,hash:o},{onDone:this.withFastBackCheck(function(){each(geByClass("apps_notification_row",cur.rNotWrap),function(e,t){re(t)}),hide(cur.rNotShowMoreButton),show(cur.rNotNoContent),this.notificationsSetCounters(0),cur.rNotScrollbar&&cur.rNotScrollbar.update()}.bind(this)),showProgress:function(){lockButton(t),lockLink(e)},hideProgress:this.withFastBackCheck(function(){unlockButton(t),unlockLink(e),a.hide()})})}.bind(this),getLang("global_cancel"));return!1}},notificationsSetCounters:function(e){if(void 0!==e&&(cur.notificationsNew=e,this.handlePageCount(e),cur.rNotCounter)){var t=e<1e3?e+"":".."+(e+"").substr(-3);e&&removeClass(cur.rNotCounter,this.optionHiddenClass),e?removeClass(cur.rNotCounter,"ui_tab_count_hidden"):addClass(cur.rNotCounter,"ui_tab_count_hidden"),animateCount(cur.rNotCounter,t,{str:t,onDone:e?void 0:addClass.pbind(cur.rNotCounter,this.optionHiddenClass)})}},rejectRequest:function(e,t,i,o){if(!buttonLocked(e)){var n=ge("apps_notification_"+t);this.notificationsMarkReaded(n),data(n,"html",n.innerHTML),setStyle(n,{minHeight:getSize(n)[1]}),ajax.post(this.address,{act:"reject_"+o,newest:cur.notificationsNewest,rid:t,hash:i},{onDone:this.withFastBackCheck(function(e,t,i){t=cf(trim(t)),this.notificationsRemovedCount++>1&&domFC(t).appendChild(cf(cur.notificationsRemoveAllTpl||"")),val(e,""),e.appendChild(t),addClass(e,"apps_notification_service"),this.notificationsSetCounters(i),cur.rNotScrollbar.update()}.bind(this,n)),showProgress:lockButton.pbind(e),hideProgress:this.withFastBackCheck(unlockButton.pbind(e))}),cur.rNotScrollbar.update(),cur.preload&&delete cur.preload.before}},requestsRestore:function(e,t,i){if(!linkLocked(e)){var o=ge("apps_notification_"+t);ajax.post(this.address,{act:"request_restore",newest:cur.notificationsNewest,rid:t,hash:i},{onDone:this.withFastBackCheck(function(e,t){this.notificationsRemovedCount--,val(e,data(e,"html")),removeClass(e,"apps_notification_service"),setStyle(e,{minHeight:""}),this.notificationsSetCounters(t),cur.rNotScrollbar.update()}.bind(this,o)),showProgress:lockLink.pbind(e),hideProgress:this.withFastBackCheck(unlockLink.pbind(e))}),cur.rNotScrollbar.update(),cur.preload&&delete cur.preload.before}},deleteNotification:function(e,t,i,o){if(!buttonLocked(e)){var n=ge("apps_notification_"+t);setStyle(n,{minHeight:getSize(n)[1]}),ajax.post(this.address,{act:"delete_notification",newest:cur.notificationsNewest,nid:t,aid:i,hash:o},{onDone:this.withFastBackCheck(function(e,t,i){t=cf(trim(t)),this.notificationsRemovedCount++>1&&domFC(t).appendChild(cf(cur.notificationsRemoveAllTpl||"")),val(e,""),e.appendChild(t),addClass(e,"apps_notification_service"),this.notificationsSetCounters(i)}.bind(this,n)),showProgress:lockButton.pbind(e),hideProgress:this.withFastBackCheck(unlockButton.pbind(e))})}},denyNotifications:function(e,t,i,o){if(!linkLocked(e)){var n=ge("apps_notification_"+t);setStyle(n,{minHeight:getSize(n)[1]}),ajax.post(this.address,{act:"deny_notifications",aid:i,hash:o},{onDone:this.withFastBackCheck(function(e,t){addClass(e,"apps_notification_service"),t&&val(e,t)}.pbind(n)),showProgress:lockLink.pbind(e),hideProgress:this.withFastBackCheck(unlockLink.pbind(e))})}},requestsBanUser:function(e,t,i,o){if(!linkLocked(e)){var n=ge("apps_notification_"+t);setStyle(n,{minHeight:getSize(n)[1]}),ajax.post(this.address,{act:"request_ban_user",mid:i,hash:o},{onDone:this.withFastBackCheck(function(e,t){addClass(e,"apps_notification_service"),t&&val(e,t)}.pbind(n)),showProgress:lockLink.pbind(e),hideProgress:this.withFastBackCheck(unlockLink.pbind(e))})}},removingApp:!1,restoringApp:!1,appsTabSelect:function(e){delete nav.objLoc.tab,nav.setLoc(nav.objLoc),addClass(cur.rNotBlackList,this.optionHiddenClass)},updateLeftNav:function(e){e&&val(geByTag1("ol",ge("side_bar")),e)},restoreApp:function(e,t,i){if(this.restoringApp)return!1;var o=ge("app"+e);return cur.deletedApps[e]&&"al_apps"==cur.deletedApps[e].from&&val(geByClass1("app_deleted_layer",o,"div"),cur.progressTpl),ajax.post(this.address,{act:"join",gid:cur.gid,gidhash:i,id:e,hash:t,restore:1,from:"al_apps",section:cur.section},{onDone:this.withFastBackCheck(function(t){cur.deletedApps[e]&&(val(o,cur.deletedApps[e].html),t.left_nav&&this.updateLeftNav(t.left_nav),delete cur.deletedApps[e]),cur.apps[e]&&(delete cur.apps[e].deleted,cur.appsIndex&&cur.appsIndex.add(cur.apps[e])),removeClass(o,"deleted")}.bind(this)),showProgress:function(){this.restoringApp=!0,addClass(o,this.optionLoadingClass)}.bind(this),hideProgress:this.withFastBackCheck(function(){this.restoringApp=!1,removeClass(o,this.optionLoadingClass)}.bind(this))}),!1},removeApp:function(e,t,i,o,n){if(o&&Object(_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.c)(o),this.removingApp)return!1;if(this.isDelayedOnSilentLoad("removeApp"+e,this.removeApp.bind(this,e,t,i)))return!1;this.ttDestroyAll();var a=i?ge("recent"+e):ge("app"+e),s=a&&cur.lContent&&cur.lContent.contains(a)&&this.isSection("settings")?"settings":i?"recent":"al_apps",r=function(){var i=void 0,o=void 0;"al_apps"==s?(i=a&&geByClass1("app_deleted_layer",a,"div"),val(i,cur.progressTpl)):"recent"==s&&(o=cur.rAppsWrap&&geByClass1("apps_recent_row_hidden",cur.rAppsWrap)),ajax.post(this.address,{act:"quit",gid:cur.gid,id:e,hash:t,offset:cur.recentOffset,from:s},{onDone:this.withFastBackCheck(function(t){"apps"==cur.module&&(delete cur.preload,"notifications"!=nav.objLoc.tab&&cur.rNotWrap&&this.isSection("catalog","list")?this.recentTabsUpdate(!1,!0):(window.notificationsListChanged=!0,t.count_all&&this.notificationsSetCounters(t.count_all)),window.appsListChanged=!0,cur.apps[e]&&(cur.appsIndex&&cur.appsIndex.remove(cur.apps[e]),cur.apps[e].deleted=!0),t.left_nav&&this.updateLeftNav(t.left_nav),"settings"==s?(cur.deletedApps[e]={from:s,html:a.innerHTML},a&&a.appendChild(cf(t.html))):"recent"==s?(o&&removeClass(o,"apps_recent_row_hidden"),hide(a),t.html&&domInsertBefore(cf(t.html),cur.rAppsShowMoreButton),geByClass1("apps_recent_row",cur.rAppsWrap)?cur.recentOffset+=t.offset:(hide(cur.rAppsShowMoreButton),show(cur.rAppsNoContent),cur.recentOffset=0)):(cur.deletedApps[e]={from:s,html:a.innerHTML},t.html&&val(i,t.html)),addClass(a,"deleted"))}.bind(this)),showProgress:function(){addClass(a,this.optionLoadingClass),this.removingApp=!0}.bind(this),hideProgress:this.withFastBackCheck(function(){removeClass(a,this.optionLoadingClass),this.removingApp=!1}.bind(this))})}.bind(this);if("recent"==s)var c=showFastBox({title:getLang("apps_quit_app_box_title")},getLang(n?"apps_game_quit_confirm":"apps_quit_confirm"),getLang("apps_remove"),function(){r(),c.hide()},getLang("global_cancel"));else if(cur.adminApps&&cur.adminApps[e])var l=showFastBox({title:getLang("apps_deletingapp")},getLang("apps_admin_quit"),getLang("global_delete"),function(){r(),l.hide()},getLang("global_cancel"));else r()},initSearchTags:function(e,t,i,o){cur.searchTags={},t&&t.forEach(function(e){Object(_lib_utils_common__WEBPACK_IMPORTED_MODULE_0__.x)(e)&&e.id&&(uiSearch.toggleFilter(i,e.id,e.name,!0),cur.searchTags[e.id]=!0)}),stManager.add("indexer.js",function(){e=isArray(e)?e:[],cur.searchTagsIndexer=new vkIndexer(e,function(e){return e[1]}),o.suggester&&o.suggester.instance.setOptions({onlyShowSuggestions:!0,onAcceptSuggestion:Apps.onSearchTagAccepted.bind(Apps),fetchSuggestionsFn:Apps.fetchSearchTagsSuggestions.bind(Apps),onSelectSuggestion:Apps.onSelectSearchSuggestion.bind(Apps)},!0)})},fetchSearchTagsSuggestions:function(e){return cur.searchTagsIndexer?cur.searchTagsIndexer.search(e).filter(function(e){return!cur.searchTags[positive(e[0])]}):[]},onSearchTagRemoved:function(e){var t=ge("s_search"),i=t&&t.value||"";e=positive(e),delete cur.searchTags[e],this.searchUpdate(i)},onSelectSearchSuggestion:function(e){e=positive(e);var t=Object.keys(cur.searchTags);t.push(e),cur.previewTagsStr=t.join(","),cur.searchStr="",this.searchUpdate(""),cur.previewTagsStr=""},onSearchTagAccepted:function(e,t){var i=ge("s_search");e=positive(e),cur.searchTags[e]=!0,uiSearch.toggleFilter(i,e,t,!0),val(i,""),this.searchUpdate("")},runApp:function(e,t,i,o,n,a,s,r){if(!vk.id)return showDoneBox(cur.pleaseSignInLang),!1;lockButton(e);var c=clone(nav.objLoc);delete c.w,nav.setLoc(c),window.appsListChanged=1;var l="/"+t+"?join=1&hash="+i+"&sett="+o;if(s&&(l="/"+t+"?act=embed&join=1&join_hash="+i+"&sett="+o+"&hash="+r),cur.fromInstallBox&&(l+="&from_install="+(1==cur.fromInstallBox?1:2)),n)if(Object(_lib_utils_common__WEBPACK_IMPORTED_MODULE_0__.x)(n))for(var p in n)"w"!=p&&(l+="&"+p+"="+n[p]);else""!=n&&(l+="&ref="+n);a&&(l+="&mid="+a),nav.objLoc["#"]&&(l+="#"+nav.objLoc["#"]),s&&(location.href=l),nav.go(l)},updatesInterval:null,stopUpdates:function(){this.updatesInterval&&clearInterval(this.updatesInterval)},initUpdates:function(e){e&&e.key&&(cur.updatesKey=e.key);var t=function(){window.Notifier&&cur.updatesKey&&Notifier.addKey(cur.updatesKey,function(e,t){if(cur.updatesKey){if(t.events)for(var i in t.events)t.events.hasOwnProperty(i)&&this.parseEvent(t.events[i]);t.ts&&(cur.updatesKey.ts=t.ts)}}.bind(this))}.bind(this);t(),this.updatesInterval=setInterval(t,1e4),cur.destroy.push(this.stopUpdates.bind(this))},parseEvent:function(e){var t=(e=e.split("<!>"))[0];if(cur.updatesVersion&&t==cur.updatesVersion){var i=_lib_browser__WEBPACK_IMPORTED_MODULE_6__.a.opera&&intval(_lib_browser__WEBPACK_IMPORTED_MODULE_6__.a.version)<=12,o=e[3],n=new Date,a=n.getHours(),s=n.getMinutes();a<10&&(a="0"+a),s<10&&(s="0"+s),o=o.replace("{date}",a+":"+s);var r=domFC(cf(o));if(cur.fWrap){var c=function e(){cur.fScrollbar&&cur.fScrollbar.update(),i?r.removeEventListener("oTransitionEnd",e):removeEvent(r,"webkitTransitionEnd transitionend msTransitionEnd oTransitionEnd",e)},l=cur.fWrap.__uiScroll__?cur.fWrap.__uiScroll__.content:cur.fWrap;addClass(r,"apps_feed_row_just_added"),l.insertBefore(r,domFC(l)),i?r.addEventListener("oTransitionEnd",c):addEvent(r,"webkitTransitionEnd transitionend msTransitionEnd oTransitionEnd",c),removeClassDelayed(r,"apps_feed_row_just_added"),this.ttHideAll()}}},feedInit:function(){cur.fWrap&&cur.feedOffset&&!cur.fScrollbar&&(cur.fScrollbar=new uiScroll(cur.fWrap,{autoresize:!1,global:!0,onmore:this.feedLoadContent.bind(this)}))},feedLoadContent:function(){!isButtonLocked(cur.fShowMoreButton)&&isVisible(cur.fShowMoreButton)&&ajax.post(this.address,{act:"more_feed",offset:cur.feedOffset,hash:cur.feedHash},{onDone:this.withFastBackCheck(function(e,t,i){cur.feedOffset=t,e&&cur.fShowMoreButton&&cur.fShowMoreButton.parentNode.insertBefore(cf(e),cur.fShowMoreButton),i&&hide(cur.fShowMoreButton),cur.fScrollbar&&cur.fScrollbar.update()}),showProgress:lockButton.pbind(cur.fShowMoreButton),hideProgress:this.withFastBackCheck(unlockButton.pbind(cur.fShowMoreButton))})},myAppOver:function(e,t,i){if(hasClass(t,"deleted")||!vk.id)return!1;showTooltip(t,{url:this.address,params:{act:"show_app_friends_tt",aid:e,no_size:i?1:0},typeClass:"tt_black",slide:15,center:1,shift:[0,8,8],ajaxdt:200,showdt:300,hidedt:200,dir:"auto"})},ttScore:function(e,t,i){var o=void 0;return cur.ttScoreShown&&window.tooltips&&(tooltips.hideAll(),o=0),showTooltip(e,{center:1,black:1,shift:[0,8,8],showsp:o,text:'<div class="apps_score_tt_cont"><b>'.concat(t,"</b>",i?'<div class="apps_score_tt">'+i+"</div>":"","</div>")})},ttCommon:function(e,t,i){return 0===(i=extend({parent:void 0,center:void 0,event:0,appendEl:void 0,shift:void 0},i)).event&&(i.event=window.event),i.event&&Object(_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.c)(i.event),i.appendEl&&(i.appendEl=ge(i.appendEl)),i.center?showTooltip(e,{center:i.center,shift:i.shift||[0,8,8],black:1,appendEl:i.appendEl,text:t}):showTitle(e,t,i.shift,i)},ttHideAll:function(){window.tooltips&&tooltips.hideAll()},ttDestroyAll:function(){window.tooltips&&tooltips.destroyAll()},scrollToHeader:function(){var e=ge("apps_header_block"),t=scrollNode.scrollTop,i=getSize("page_header_cont")[1];if(e){var o=Math.max(0,getXY(e)[1]-parseInt(getStyle(e,"marginTop"),10));t+(vk.staticheader?Math.max(0,i-t):i)>o&&scrollToY(o,200)}},scrollToSearch:function(){var e=scrollNode.scrollTop,t=getSize("page_header_cont")[1];if(cur.aSearchWrap){var i=getXY(domPN(cur.aSearchWrap))[1];e+(vk.staticheader?Math.max(0,t-e):t)>i&&scrollToY(i,200)}},scrollCheck:function(){this.isDelayedOnSilentLoad("scrollCheck",this.scrollCheck.bind(this))||!_lib_browser__WEBPACK_IMPORTED_MODULE_6__.a.mobile&&!cur.isAppsLoading&&!cur.disableAutoMore&&isVisible(cur.lShowMoreButton)&&(window.innerHeight||document.documentElement.clientHeight||bodyNode.clientHeight)+scrollGetY()+400>=cur.lShowMoreButton.offsetTop&&this.searchLoadContent()},searchFocusedClass:"apps_search_focused",backupListContent:function(e){if(cur.backupList||e){if(cur.backupList&&!cur.backupList.contentCopied&&e){for(cur.backupList.content=document.createDocumentFragment();cur.lContent.firstChild;)cur.backupList.content.appendChild(cur.lContent.firstChild);for(cur.backupList.preload=document.createDocumentFragment();cur.lPreload.firstChild;)cur.backupList.content.appendChild(cur.lPreload.firstChild);cur.backupList.contentCopied=!0}}else cur.backupList={cur:{loadMore:cur.loadMore,shownApps:cur.shownApps,sectionCount:cur.sectionCount,searchOffset:cur.searchOffset},content:null,preload:null,contentCopied:!1}},restoreListContent:function(){return cur.backupList?(this.searchProgress(!1),val(cur.lContent,""),val(cur.lPreload,""),extend(cur,cur.backupList.cur),cur.lContent.appendChild(cur.backupList.content),cur.lPreload.appendChild(cur.backupList.preload),delete cur.backupList,!0):(delete cur.backupList,!1)},indexAll:function(e){cur.appsIndex=new vkIndexer(cur.appsList.all,function(e){try{return cur.apps[parseInt(e[0])]=e,e[3]}catch(e){return""}},e)},searchUpdate:function(e){if(!this.isDelayedOnSilentLoad("searchUpdate",this.searchUpdate.bind(this,e))){((e=e||"").length<2||cur.previewTagsStr)&&(e="");var t=cur.previewTagsStr||Object.keys(cur.searchTags||{}).join(",");if(cur.ignoreEqual||cur.searchStr!==e||t!==cur.searchTagsStr){this.isSection("list")&&e&&this.backupListContent(),cur.searchStr=e||"",cur.searchTagsStr=t;var i=this.isSection("apps","settings","manage","admin_requests","reports","ads")?"all":"search";if(e&&this.isSection("apps","settings","manage","admin_requests","reports","ads")){var o=cur.appsIndex.search(clean(e));cur.curList=i+"_search_"+e+"_"+cur.searchTagsStr,cur.appsList[cur.curList]=o,e+=" "+(parseLatin(e)||""),e=trim(escapeRE(e).split("&").join("&amp;")),cur.selection={re:new RegExp("("+e.replace(cur.appsIndex.delimiter,"|")+")","gi"),val:"<span>$1</span>"}}else cur.curList=i,cur.selection=!1;this.ttHideAll(),this.searchProgress(!0),this.scrollToSearch(),hide(cur.lShowMoreButton),this.isSection("catalog","list")&&this.searchWriteToAddressBar(),cur.loadMore=1,cur.shownApps=cur.searchOffset=0,this.showRows()}delete cur.ignoreEqual}},showRows:function(){if(!this.isDelayedOnSilentLoad("showRows",this.showRows.bind(this))){if(cur.searchStr||cur.searchTagsStr)this.isSection("list","catalog")&&this.searchLoadContent();else{if(this.isSection("list"))return this.restoreListContent()||(extend(cur,{searchOffset:0,sectionCount:0,shownApps:0,loadMore:0}),this.searchCatalog(cur.searchStr,cur.searchOffset)),window[cur.loadMore?"show":"hide"](cur.lShowMoreButton),!1;if(this.isSection("catalog"))return extend(cur,{searchOffset:0,sectionCount:0,shownApps:0,loadMore:0}),val(cur.lContent,""),val(cur.lPreload,""),this.switchLayout("catalog"),this.searchProgress(!1),this.sliderStart(),window[cur.loadMore?"show":"hide"](cur.lShowMoreButton),!1}if(this.isSection("settings","manage","admin_requests","apps","reports","ads")){if(cur.defaultCount&&cur.shownApps<cur.sectionCount){var e=clean(cur.searchStr),t=this.isSection("manage","admin_requests"),i="",o=cur.appsList[cur.curList]||[],n=o.length;if((o=this.filter(o.slice(cur.shownApps)).slice(0,cur.defaultCount)).length&&cur.appTpl){var a=[];each(o,function(e,i){i=clone(i),cur.selection&&(i[3]=i[3].replace(cur.selection.re,cur.selection.val)),a.push(cur.appTpl(i,e==o.length-1,t))}),i=a.join("")}cur.shownApps?i&&cur.lContent.appendChild(cf(i)):i?(val(cur.lContent,i),val(cur.aSummaryCounter,n)):(val(cur.lContent,cur.aSummary.innerHTML.replace("{query}","<b>"+e+"</b>")),val(cur.aSummaryCounter,"")),cur.shownApps+=cur.defaultCount,cur.shownApps>=cur.sectionCount?hide(cur.lShowMoreButton):(show(cur.lShowMoreButton),this.scrollCheck()),cur.searchStr&&!cur.searchOffset&&this.isSection("apps","manage")&&Object(_lib_stats__WEBPACK_IMPORTED_MODULE_3__.a)(this.isSection("apps")?"apps_list":"manage",0,o.length),this.searchProgress(!1)}return!1}return!0}},searchLoadContent:function(){if(this.isSection("catalog","list")){if(cur.searchStr||(cur.searchStr=""),cur.lPreload.innerHTML){for(var e=document.createDocumentFragment();cur.lPreload.firstChild;)e.appendChild(cur.lPreload.firstChild);cur.lContent.appendChild(e)}return cur.loadMore?this.searchCatalog(cur.searchStr,cur.searchOffset):(cur.loadMore=!0,hide(cur.lShowMoreButton)),!1}return!this.isSection("apps","manage","admin_requests","settings","reports","ads")||this.showRows()},searchCatalog:function(e,t){e=e||"";var i=cur.searchTagsStr,o=+new Date;ajax.post(this.address,{act:e||i||!this.isSection("list")?"search":cur.list,q:e,offset:t,oid:cur.oid,from:cur.section,catalog_search:1,id:cur.listId||void 0,tags:i},{cache:e||cur.searchTagsStr?0:1,onDone:this.withFastBackCheck(function(n,a,s){e==cur.searchStr&&i==cur.searchTagsStr&&(this.isSection("catalog","list")&&((cur.searchStr||i)&&this.sliderStop(),this.switchLayout(cur.searchStr||i?"list":cur.section),this.searchWriteToAddressBar()),this.backupListContent(!0),n&&val(cur.lContent,n),val(cur.lPreload,a||""),cur.loadMore=!!a,extend(cur,s),cur.loadMore&&show(cur.lShowMoreButton),this.scrollCheck(),e&&!t&&Object(_lib_stats__WEBPACK_IMPORTED_MODULE_3__.a)(this.isSection("catalog","list")?"apps":"manage"===cur.section?"apps_manage":"apps_list",o,s.count))}.bind(this)),showProgress:function(){cur.isAppsLoading=!0,lockButton(cur.lShowMoreButton)},hideProgress:this.withFastBackCheck(function(){cur.isAppsLoading=!1,this.searchProgress(!1),unlockButton(cur.lShowMoreButton)}.bind(this))})},filter:function(e){for(var t=e.length,i=[],o=0;o<t;o++){var n=e[o];cur.apps&&cur.apps[n[0]]&&!cur.apps[n[0]].deleted&&i.push(n)}return i},searchLoadFromAddressBar:function(){setTimeout(function(){cur.searchStr=nav.objLoc.q||"",cur.searchStr&&Object(_lib_stats__WEBPACK_IMPORTED_MODULE_3__.a)("apps",0,cur.shownApps)},0)},searchWriteToAddressBar:function(e){nav.setLoc(extend(nav.objLoc,{q:cur.searchStr||null,tags:cur.searchTagsStr||null}))},searchProgress:function(e){cur.aSearch&&uiSearch[e?"showProgress":"hideProgress"](cur.aSearch)},searchFocused:function(){cur.aWrap&&addClass(cur.aWrap,this.searchFocusedClass)},searchBlured:function(){cur.aWrap&&removeClass(cur.aWrap,this.searchFocusedClass)},searchReset:function(){cur.aSearch&&uiSearch.reset(cur.aSearch),cur.searchStr=""},switchLayout:function(e){cur.aWrap&&(removeClass(cur.aWrap,"apps_catalog_layout"),removeClass(cur.aWrap,"apps_list_layout"),removeClass(cur.aWrap,"apps_manage_layout"),removeClass(cur.aWrap,"apps_admin_requests_layout"),removeClass(cur.aWrap,"apps_settings_layout"),removeClass(cur.aWrap,"apps_apps_layout"),removeClass(cur.aWrap,"apps_page_layout"),addClass(cur.aWrap,"apps_"+e+"_layout"))},geTabBySection:function(e,t){var i=ge("apps_tab_"+e+(t?"_"+t:""));return!(!i||!(i=geByTag1("a",i)))&&i},setHistoryBackRules:function(){this.isSection("manage","admin_requests")||(cur._back={show:[function(){if(cur._back.swap&&each(cur._back.swap,function(e,t){t.dummy.parentNode.replaceChild(t.content,t.dummy)}),cur.fScrollbar&&cur.fScrollbar.scrollTop(cur.fScrollbar.data.scrollTop),cur.rNotScrollbar&&cur.rNotScrollbar.scrollTop(cur.rNotScrollbar.data.scrollTop),delete cur._back.swap,setTimeout(function(){var e=nav.objLoc&&ge("notifications"==nav.objLoc.tab?"apps-recent-notifications-tab":"apps-recent-apps-tab");e&&this.switchTabPrepared(e.getElementsByTagName("a")[0]),cur.aSearch&&(uiSearch["list"===cur.section?"setFixed":"setStatic"](cur.aSearch),uiSearch.startEvents(cur.aSearch),cur.aSearch.value=cur.searchStr||"",uiSearch.scrollResize(cur.aSearch)),this.searchWriteToAddressBar(cur.searchStr)}.bind(this),0),this.ttHideAll(),this.recentTabsUpdate(),this.startEvents(),cur.aTabs){var e=this.geTabBySection(this.isSection("list")?cur.list+(cur.listId||""):cur.section);e&&uiTabs.switchTab(e),uiTabs.hideProgress(cur.aTabs)}if(cur.aSubTabs){var t=this.geTabBySection(cur.section,cur.subsection);t&&uiTabs.switchTab(t),uiTabs.hideProgress(cur.aSubTabs)}}.bind(this)],hide:[this.stopEvents.bind(this),this.ttHideAll.bind(this)],text:cur.backLang})},switchTabPrepared:function switchTabPrepared(tabAnchor,event){if(event&&checkEvent(event))return!0;var tabWrap=document.querySelectorAll('div[data-tab="'+domPN(tabAnchor).id+'"]')[0];if(!tabWrap)return!0;var tabGroup=tabWrap.getAttribute("data-tab-group"),tabCallback=tabWrap.getAttribute("data-tab-callback"),tabWraps=document.querySelectorAll('div[data-tab-group="'+tabGroup+'"]');return each(tabWraps,function(e,t){t!==tabWrap&&addClass(t,this.optionHiddenClass)}.bind(this)),uiTabs.switchTab(tabAnchor),removeClass(tabWrap,this.optionHiddenClass),tabCallback&&eval("(function(){"+tabCallback+";})()"),!1},switchTab:function switchTab(section,event,noSearchReset,target){if(event&&checkEvent(event))return!0;if((this.isSection("list")?cur.list+cur.listId:section)==cur.section)return cur.searchStr&&this.searchReset(),!1;uiSearch.removeAllFilters();var noscroll=!1,scrollToHeader=!1,scrollToTop=!1,newSection=~"/apps/catalog/settings/reports/manage/admin_requests/".indexOf(section)?section:"list",newLayout="reports"==newSection?"apps":newSection;"catalog"==cur.section&&"list"==newSection||"list"==cur.section&&"catalog"==newSection||"list"==cur.section&&"list"==newSection?scrollToHeader=noscroll=!0:cur.section!==newSection&&(scrollToTop=noscroll=!0);var preload=cur.preload&&cur.preload[section],oldBefore="",oldHeader="";if(!cur.preventFastBack&&preload&&(null!==preload.header||cur.leavePreloadedHeader||cur.preload.header)&&(null!==preload.before||cur.leavePreloadedBefore||cur.preload.before)){this.ttDestroyAll();var oldWrapper=ge("wrap3"),title=ge("title");if(cur._back){window.revertLastInlineVideo&&revertLastInlineVideo(),each(cur._back.hide,function(e,t){t&&t()}),globalHistoryDestroy(cur._back.loc||nav.strLoc),globalHistory.length>2&&globalHistoryDestroy(globalHistory[0].loc),oldBefore=ge("apps_before"),oldHeader=ge("apps_header"),oldWrapper.parentNode.replaceChild(oldWrapper.cloneNode(!0),oldWrapper);var hist={content:oldWrapper,title:title.innerHTML,loc:cur._back.loc||nav.strLoc,cur:cur,radioBtns:radioBtns,ajaxCache:ajaxCache,pid:PageID,scrollTop:scrollGetY(),htitle:document.title.toString(),width:vk.width,width_dec:vk.width_dec,width_dec_footer:vk.width_dec_footer,noleftmenu:vk.noleftmenu,notopmenu:vk.notopmenu,nobottommenu:vk.nobottommenu,hideHeader:!(!title.parentNode||isVisible(title.parentNode))||void 0};hist.back=!(!_tbLink||!_tbLink.loc)&&[_tbLink.loc,val(_tbLink),_tbLink.fast],showBackLink(hist.loc,cur._back.text,1),globalHistory.push(hist)}else _tbLink&&(_tbLink.fast=0),processDestroy(cur);PageID=NextPageID,radioBtns={},ajaxCache={},boxQueue.hideAll(),layerQueue.clear(),layers.fullhide&&layers.fullhide(!0);var oldCur=cur;cur={aWrap:ge("apps_wrap"),scrollToHeader:scrollToHeader,scrollToTop:scrollToTop,destroy:[],nav:[],preload:oldCur.preload,_back:oldCur._back};var newJs=[],tmp=null;null!==preload.before?val("apps_before",preload.before):oldCur.leavePreloadedBefore?(oldCur._back&&(tmp={dummy:ce("div"),content:oldBefore},oldCur._back.swap||(oldCur._back.swap=[]),oldCur._back.swap.push(tmp),oldBefore.parentNode.replaceChild(tmp.dummy,oldBefore),tmp=ge("apps_before"),tmp.parentNode.replaceChild(oldBefore,tmp),oldCur.fScrollbar&&oldCur.fScrollbar.scrollTop(oldCur.fScrollbar.data.scrollTop),oldCur.rNotScrollbar&&oldCur.rNotScrollbar.scrollTop(oldCur.rNotScrollbar.data.scrollTop)),extend(cur,{updatesKey:oldCur.updatesKey,updatesVersion:oldCur.updatesVersion,fScrollbar:oldCur.fScrollbar,feedOffset:oldCur.feedOffset,feedHash:oldCur.feedHash,rNotScrollbar:oldCur.rNotScrollbar,notificationsOffset:oldCur.notificationsOffset,notificationsNewest:oldCur.notificationsNewest,notificationsHash:oldCur.notificationsHash,recentOffset:oldCur.recentOffset,recentUpdateHash:oldCur.recentUpdateHash,searchTagsIndexer:oldCur.searchTagsIndexer,searchTags:oldCur.searchTags})):(val("apps_before",oldCur.preload.before[0]),newJs.push(oldCur.preload.before[1])),null!==preload.header?val("apps_header",preload.header):oldCur.leavePreloadedHeader?oldCur._back&&(tmp={dummy:ce("div"),content:oldHeader},oldCur._back.swap||(oldCur._back.swap=[]),oldCur._back.swap.push(tmp),oldHeader.parentNode.replaceChild(tmp.dummy,oldHeader),tmp=ge("apps_header"),tmp.parentNode.replaceChild(oldHeader,tmp)):(val("apps_header",oldCur.preload.header[0]),newJs.push(oldCur.preload.header[1])),val("apps_after",preload.after||""),val("apps_content",preload.content||""),val("apps_list_content",preload.list_content||""),val("apps_list_preload",preload.list_preload||""),this.switchLayout(newLayout),each(newJs,function(i,js){js&&eval("(function(){"+js+";})()")}),preload.js&&eval("(function(){"+preload.js+";})()"),window.__adsUpdate("force"),nav.objLoc={0:this.address,act:"catalog"===section?void 0:section,tab:"catalog"===newSection||"list"===newSection?nav.objLoc.tab:void 0,mid:nav.objLoc.mid,gid:nav.objLoc.gid,add:nav.objLoc.add},nav.setLoc(nav.objLoc),this.searchReset();var tab=this.geTabBySection(section);return tab&&setTimeout(uiTabs.switchTab.pbind(tab),0),window[cur.loadMore?"show":"hide"](cur.lShowMoreButton),!1}target&&(hasClass(target,"app_cat_link")?lockLink(target):addClass(target,"apps_header_progress"));var _tab2=this.geTabBySection(section);return _tab2&&(uiTabs.switchTab(_tab2),uiTabs.showProgress(_tab2)),nav.go({0:this.address,act:"catalog"===section?void 0:section,tab:"catalog"===newSection||"list"===newSection?nav.objLoc.tab:void 0,mid:nav.objLoc.mid,gid:nav.objLoc.gid,add:nav.objLoc.add},!1,{onDone:function(e){target&&(hasClass(target,"app_cat_link")?unlockLink(target):removeClass(target,"apps_header_progress")),extend(cur,{scrollToHeader:scrollToHeader,scrollToTop:scrollToTop})}.pbind(cur),noscroll:noscroll})},sliderInit:function(){"catalog"!=cur.section||cur.featuredSlider||(cur.featuredSlider=new AppsSlider({inner:"apps_featured_slides",outer:"apps_featured_slider",next:"apps_featured_next",prev:"apps_featured_prev",onSlide:function(){window.AdsLight&&AdsLight.applyAds()}}))},sliderStart:function(){cur.featuredSlider&&(cur.featuredSlider.slideshowStart(),cur.featuredSlider.addHandler())},sliderStop:function(){cur.featuredSlider&&(cur.featuredSlider.removeHandler(),cur.featuredSlider.slideshowStop())},collectionsLoadContent:function(e){if(isVisible(e)&&!buttonLocked(e))return cur.collectionsOffset&&cur.collectionsHasMore?void ajax.post("al_apps.php",{act:"a_collections_more",offset:cur.collectionsOffset,seed:cur.collectionsSeed},{onDone:function(t,i,o){geByClass1("_apps_collections").appendChild(cf(t)),cur.collectionsHasMore=o,o||hide(e),cur.collectionsOffset=i},showProgress:lockButton.pbind(e),hideProgress:unlockButton.pbind(e)}):hide(e)},addToMineGroups:function(e,t,i,o){var n={act:"add_to_mine_group_box",aid:e,hash:t,height:lastWindowHeight,from_gid:o};i&&(n.source=i),showBox("apps",n,{params:{dark:1,width:450,bodyStyle:"padding: 22px 0 0"}})},makeAppSlider:function(e){return new AppsSlider(e)},closeExternalApp:function(){cur.app.clientRpc&&cur.app.clientRpc.callMethod("closeExternalApp")},adminRequestRow:function(e){var t="",i=_slicedToArray(e,6),o=i[0],n=i[1],a=i[2],s=i[3],r=i[4],c=i[5];if(r=intval(r),n='<img src="'+n+'"/>',a)if("away.php"==a.substr(0,8)){var l=a.replace(/&/g,"&amp;");s='<a href="'+a+'" target="_blank" rel="noopener" onclick="return goAway(\''+l+"')\">"+s+"</a>",n='<a href="'+a+'" target="_blank" rel="noopener" onclick="return goAway(\''+l+"')\">"+n+"</a>"}else s='<a href="'+a+'">'+s+"</a>",n='<a href="'+a+'">'+n+"</a>";return cur.adminRequest&&void 0!==cur.adminRequest[o]?null!==cur.adminRequest&&(t=cur.adminRequest[o]?getLang("apps_admin_request_accepted"):getLang("apps_admin_request_declined")):t="<a onclick='Apps.adminRequestAccept(this, "+o+', "'+c+"\")'>"+getLang("apps_admin_request_accept")+"</a> | <a onclick='Apps.adminRequestDecline(this, "+o+', "'+c+"\")'>"+getLang("apps_admin_request_decline")+"</a>",rs(cur.rowTpl,{id:o,name:s,img:n,info:'<div class="apps_settings_size">'+(r?getLang("apps_X_participants",r,!0):getLang("apps_noparticipants"))+"</div>",actions:t})},adminRequestAccept:function(e,t,i){var o=gpeByClass("_app_settings_actions",e);o&&!cur.adminRequestProcess&&(cur.adminRequestProcess=!0,ajax.post("al_apps_edit.php",{act:"a_accept_admin_request",aid:t,hash:i},{onDone:function(e,i,n){cur.adminRequest||(cur.adminRequest={}),cur.adminRequest[t]=n,val(o,e),i&&showDoneBox(i)},hideProgress:function(){cur.adminRequestProcess=!1}}))},adminRequestDecline:function(e,t,i){var o=gpeByClass("_app_settings_actions",e);o&&!cur.adminRequestProcess&&(cur.adminRequestProcess=!0,ajax.post("al_apps_edit.php",{act:"a_decline_admin_request",aid:t,hash:i},{onDone:function(e,i,n){cur.adminRequest||(cur.adminRequest={}),cur.adminRequest[t]=n,val(o,e),i&&showDoneBox(i)},hideProgress:function(){cur.adminRequestProcess=!1}}))},share:function(e,t){showBox("like.php",{act:"publish_box",object:"app"+e+"_"+t})},qrCodeModal:function(){cur.qrModal||(cur.qrModal=new _shared_apps_connect_libs_QRCodeModal__WEBPACK_IMPORTED_MODULE_4__.a),cur.qrModal.init(),cur.qrModal.toggle()},unverifiedGoBack:function(){return window.history.back(),!1},showUnverifiedBackBtn:function(){if(window.globalHistory&&window.globalHistory.length){var e=geByClass1("apps_unverifiedAppWarning__btn_back");e&&addClass(e,"apps_unverifiedAppWarning__btn_active")}},runUnverified:function(e,t){lockButton(e),nav.setLoc(extend(nav.objLoc,{run_hash:t})),nav.reload()},addAppQrCode:function(e){var t=new Image,i=geByClass1("apps_install_header__qr"),o=location.origin+"/app"+e+location.hash;t.onload=function(){return i&&i.appendChild(t)},t.src="https://chart.googleapis.com/chart?chs=120x120&cht=qr&chl="+encodeURIComponent(o)+"&choe=UTF-8&chld=L|0"},showHint:function(e,t,i){return Object(_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.c)(t),i=i||{},i=extend({dir:"bottom",shift:[12,8],appendEl:document.body,width:200},i),Object(_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_2__.a)(e,i)},hideVkPayPromoBanner:function(e){window.tooltips&&window.tooltips.hideAll(),re(document.querySelector(".apps_vkPayPromo")),ajax.post("/apps",{act:"hide_vkpay_banner",hash:e})}};try{stManager.done("apps.js")}catch(e){}}});