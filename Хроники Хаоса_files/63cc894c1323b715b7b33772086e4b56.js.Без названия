(window.webpackJsonp=window.webpackJsonp||[]).push([["63cc894c1323b715b7b33772086e4b56"],{lMzL:function(t,e,n){"use strict";var o=function(t){var e=t.match(/:\/\/(www[0-9]?\.)?(.[^/:]+)/i);return null!=e&&e.length>2&&"string"==typeof e[2]&&e[2].length>0?e[2].toLowerCase():null};var r=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.stack=[]}return t.prototype.push=function(t){t.init(),0===this.stack.length&&t.show(),this.stack.push(t)},t.prototype.pop=function(t){var e=this.stack.indexOf(t);~e&&(this.stack.splice(e,1),this.checkForNext())},t.prototype.checkForNext=function(){this.stack.length>0&&this.stack[0].show()},t}()),a="web",s="mobile-web",i=1,p=2,c=3,l=4,u=5,h=6,d={VKWebAppAddToCommunity:"add_to_community",VKWebAppAddToCommunityPreload:"get_groups_list",VKWebAppGetCommunityAuthToken:"get_community_token",VKWebAppGetCommunityAuthTokenPreload:"get_community_scope",VKWebAppGetAuthToken:"get_auth_token",VKWebAppGetAuthTokenPreload:"get_auth_token_info",VKWebAppGetPhoneNumber:"get_phone_number",VKWebAppGetEmail:"get_email",VKWebAppAllowNotificationsPreload:"are_notifications_allowed",VKWebAppAllowNotifications:"allow_notifications",VKWebAppDenyNotifications:"deny_notifications",VKWebAppAllowMessagesFromGroup:"allow_messages_from_group",VKWebAppAllowMessagesFromGroupPreload:"can_send_messages_from_group",VKWebAppJoinGroupPreload:"is_group_member",VKWebAppJoinGroup:"join_group",VKWebAppOpenApp:"open_app",VKWebAppGetUserInfo:"get_user_info"},f=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t};var m=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.data=n||{},this.method=e}return t.prototype._errorStrucuture=function(t,e){return{type:this.method,data:f({error_type:"client_error",error_data:{error_code:t,error_reason:e}},this.data)}},t.prototype.selectErrorType=function(){if(!this.data.hasOwnProperty("code"))return this._errorStrucuture(i,this.data.reason||this.data.error_msg||"Unknown error");switch(this.data.code){case p:return this._errorStrucuture(p,this.data.reason||"Missing required params or wrong type of param");case c:return this._errorStrucuture(c,this.data.reason||"Connection lost");case l:return this._errorStrucuture(l,this.data.reason||"User denied");case u:return this._errorStrucuture(u,this.data.reason||"Invalid params");case h:return this._errorStrucuture(h,this.data.reason||this.data.error_msg);default:return this._errorStrucuture(this.data.code?this.data.code:i,this.data.reason||this.data.error_msg||"Unknown error")}},t}(),y=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t};var _=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.props=y({},e),n&&(this.callback=n),this.app_node=ge(this.props.containerId),this.modal=null,this.onAction=this.onAction.bind(this),this.renderModal()}return t.prototype.init=function(){this.app_node.appendChild(this.modal)},t.prototype.show=function(){var t=this;setTimeout(function(){return t.modal.classList.add("show")},300)},t.prototype.destroy=function(){this.modal.parentNode.removeChild(this.modal),this.callback&&this.callback()},t.prototype.onAction=function(t){t(),this.destroy()},t.prototype._renderBtn=function(t){var e=this,n=document.createElement("button");return n.setAttribute("type","button"),n.classList.add("vk_app_modal_btn"),n.classList.add("vk_app_modal_btn--"+t.type),n.innerText=t.title,n.addEventListener("click",function(){return e.onAction(t.action)}),n},t.prototype._renderBtns=function(t){var e=this,n=t.getElementsByClassName("vk_app_modal_btns")[0];n&&(this.props.buttons.map(function(t){n.appendChild(e._renderBtn(t))}),1===this.props.buttons.length&&n.classList.add("vk_app_modal_btns--single-btn"))},t.prototype._renderCloseBtn=function(t){var e=this,n=document.createElement("button");n.setAttribute("type","button"),n.classList.add("vk_app_modal_close_btn"),n.innerHTML='<svg class="vk_app_modal_close_btn__icon" viewBox="0 0 24 24" id="cancel_24" width="24" height="24">\n        <g fill="none" fill-rule="evenodd">\n          <path d="M0 0h24v24H0z"></path>\n          <path\n              d="M18.3 5.7a.99.99 0 0 0-1.4 0L12 10.6 7.1 5.7a.99.99 0 0 0-1.4 1.4l4.9 4.9-4.9 4.9a.99.99 0 0 0 1.4 1.4l4.9-4.9 4.9 4.9a.99.99 0 0 0 1.4-1.4L13.4 12l4.9-4.9a.99.99 0 0 0 0-1.4z"\n              fill="currentColor"></path>\n        </g>\n      </svg>',n.addEventListener("click",function(){return e.onAction(e.props.cancelAction)}),t.children[0].appendChild(n)},t.prototype._renderOuter=function(){var t=document.createElement("div");return t.classList.add("vk_app_modal_outer"),t},t.prototype._enhanceBtnsWithActions=function(){var t=this;this.props.buttons&&this.props.buttons.forEach(function(e,n){"deny"===e.type?t.props.buttons[n].action=t.props.cancelAction:t.props.buttons[n].action=t.props.allowAction})},t.prototype._renderScopes=function(t){return t.map(function(t){return getLang("apps_scope_"+t)}).join(", ")},t.prototype.prepareScopes=function(t){return 0===t.length?["general"]:t},t.prototype.prepareExtraBtn=function(){var t=document.createElement("button");return t.setAttribute("type","button"),t.classList.add("vk_app_modal_btn","vk_app_modal_btn--transparent"),t.innerHTML=getLang("apps_connect_modal_messages_scopes_edit"),t.addEventListener("click",this.props.extraAction),t},t.prototype.renderModal=function(){var t='\n    <div class="vk_app_modal_container vk_app_modal_container--flex">\n      <div class="vk_app_modal_content">\n        <img src="'+this.props.pic+'" class="vk_app_modal_container__pic">\n        <h2 class="vk_app_modal_container__heading">'+this.props.title+"</h2>\n        "+(this.props.text?'<p class="vk_app_modal_container__text">'+this.props.text+"</p>":"")+"\n      ";this.props.scopes&&(t+='\n          <p class="vk_app_modal_container__text">'+getLang("apps_connect_modal_messages_scopes_text")+'</p>\n          <p class="vk_app_modal_container__list">'+this._renderScopes(this.prepareScopes(this.props.scopes))+"</p>"),t+='\n          </div>\n          <div class="vk_app_modal_btns"></div>\n      </div>',this._enhanceBtnsWithActions(),this.modal=this._renderOuter(),this.modal.innerHTML=t,this.props.showCloseBtn&&this._renderCloseBtn(this.modal),this.props.scopes&&this.props.scopes.length&&this.props.extraAction&&this.modal.getElementsByClassName("vk_app_modal_content")[0].appendChild(this.prepareExtraBtn()),this._renderBtns(this.modal)},t}(),b=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},v=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}();var w=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.params=b({handlerName:"handler",method:"method"},e),this.callApi=!0,this.useUI=!1,this.callback=null,this.modal=null,this.actionHandler=this.actionHandler.bind(this),this.errorHandler=this.errorHandler.bind(this),this.successHandler=this.successHandler.bind(this),this.denyUIAction=this.denyUIAction.bind(this),this.allowUIAction=this.allowUIAction.bind(this),cur.vkAppSuccessHandler=this.successHandler,cur.vkAppErrorHandler=this.errorHandler,this.checkResponse=this.checkResponse.bind(this)}return t.prototype.getEventHash=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return cur.app.options[d[this.params.handlerName+(t?"Preload":"")]+"_hash"]},t.prototype.getEventName=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return d[this.params.handlerName+(t?"Preload":"")]},t.prototype.actionHandler=function(t){var e=this;return this.callApi?ajax.post("apps.php",b({act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId},t),{onDone:function(n){n.hasOwnProperty("error")?e.errorHandler(n.error):e.handleResponse(n,t,e.checkResponse)},onFail:function(t){e.errorHandler(t)}}):{}},t.prototype.checkResponse=function(t){1===t||0===t?this.successHandler(Boolean(t)):this.successHandler(t)},t.prototype.scopeStringToArray=function(t){return t?t.replace(/ /g,"").split(","):[]},t.prototype.denyUIAction=function(){this.errorHandler({error_type:"client_error",code:l}),r.pop(this.modal)},t.prototype.allowUIAction=function(t){this.actionHandler(t),r.pop(this.modal)},t.prototype.createDenyUIAction=function(t){var e=this;this.params.modal.cancelAction=void 0!==t?function(){return e.denyUIAction(t)}:this.denyUIAction},t.prototype.createAllowUIAction=function(t){var e=this;this.params.modal.allowAction=void 0!==t?function(){return e.allowUIAction(t)}:this.allowUIAction},t.prototype.launchUI=function(t){this.createDenyUIAction(),this.createAllowUIAction(),this.modal=new _(b({},this.params.modal,t)),r.push(this.modal)},t.prototype._enhanceBtnsWithActions=function(){var t=this;this.params.modal.buttons&&this.params.modal.buttons.forEach(function(e,n){"deny"===e.type?t.params.modal.buttons[n].action=t.params.modal.cancelAction:t.params.modal.buttons[n].action=t.params.modal.allowAction})},t.prototype.setData=function(t,e){t.request_id&&(this.params.request_id=t.request_id),this.params.modal||(this.params.modal={}),t.containerId&&(this.params.modal.containerId=t.containerId),t.pic&&(this.params.modal.pic=t.pic),this.app=e},t.prototype.handleResponse=function(t,e,n,o){if(t.hasOwnProperty("error"))this.errorHandler(t.error);else try{n(JSON.parse(t),e)}catch(t){o?o(t):this.errorHandler(t)}},t.prototype.handler=function(t,e,n){this.setData(t,e),this.callback=n,this.useUI?this.launchUI(t):this.useUI||this.actionHandler(t)},t.prototype.successHandler=function(t,e){e&&e(),this.params.request_id&&(t.request_id=this.params.request_id),this.callback({type:this.successDescriptor,data:t},this.params.handlerName)},t.prototype.errorHandler=function(t,e){this.params.request_id&&(t.request_id=this.params.request_id);var n=new m(this.errorDescriptor,t);e&&e(),this.callback(n.selectErrorType())},v(t,[{key:"successDescriptor",get:function(){return this.params.handlerName+"Result"}},{key:"errorDescriptor",get:function(){return this.params.handlerName+"Failed"}}]),t}();var g=function(t){function e(n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n));return o.params.handlerName="VKWebAppInit",o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.actionHandler=function(t){this.successHandler({},this.callback)},e}(w),A=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t};var k=function(t){function e(n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n));return o.params.handlerName="VKWebAppGetCommunityAuthToken",o.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:getLang("apps_connect_modal_messages_community_request_token")},o.callApi=!0,o.useUI=!0,o.allowUIAction=o.allowUIAction.bind(o),o.checkToken=o.checkToken.bind(o),o.checkIntroData=o.checkIntroData.bind(o),o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.takeAction=function(){var t=this;ajax.post("apps.php",A({act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName()},this.request),{onDone:function(e){t.handleResponse(e,null,t.checkToken)},onFail:function(e){t.errorHandler(e)}})},e.prototype.checkToken=function(t){t.access_token?this.successHandler({access_token:t.access_token}):this.errorHandler({reason:"Invalid params"})},e.prototype.loadIntroData=function(t){var e=this;this.request=A({},t),ajax.post("apps.php",A({act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId},this.request),{onDone:function(n){n.hasOwnProperty("error")?e.errorHandler(n.error):e.handleResponse(n,t,e.checkIntroData)},onFail:function(t){e.errorHandler(t)}})},e.prototype.allowUIAction=function(t){this.takeAction(t),r.pop(this.modal)},e.prototype.checkIntroData=function(t,e){if(t.hasOwnProperty("status")){if(!t.hasOwnProperty("group"))return this.errorHandler();t.group.photo_100&&(e.pic=t.group.photo_100),t.group.name&&(e.title=this.params.modal.title+" "+t.group.name),this.launchUI(A({},e,{scopes:this.scopeStringToArray(e.scope)}))}},e.prototype.handler=function(t,e,n){if(this.setData(t,e),this.callback=n,t.scope||""===t.scope)if("string"==typeof t.scope)if(t.app_id)if("number"!=typeof t.app_id||t.app_id<0)this.errorHandler({code:2,reason:'Param "app_id" should be a positive number'},n);else if(t.app_id===this.app.appId)if(t.group_id)if("number"!=typeof t.group_id||t.group_id<0)this.errorHandler({code:2,reason:'Param "group_id" should be a positive number'},n);else{var o=this.scopeStringToArray(t.scope).join(",");this.loadIntroData(A({},t,{scope:o}))}else this.errorHandler({code:2,reason:'Missing required param "group_id"'},n);else this.errorHandler({code:2,reason:'Wrong param "app_id"'},n);else this.errorHandler({code:2,reason:'Missing required param "app_id"'},n);else this.errorHandler({code:2,reason:'Param "scope" should be a string'},n);else this.errorHandler({code:2,reason:'Missing required param "scope"'},n)},e.prototype.actionHandler=function(t){this.loadIntroData(t)},e}(w),O=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t};var H=function(t){function e(n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n));return o.params.handlerName="VKWebAppAddToCommunity",o.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:getLang("apps_connect_modal_messages_request_add_to_community"),text:getLang("apps_connect_modal_messages_request_add_to_community_text")},o.callApi=!0,o.useUI=!0,o.allowUIAction=o.allowUIAction.bind(o),o.addToCommunitySuccessHandler=o.addToCommunitySuccessHandler.bind(o),o.addToCommunityErrorHandler=o.addToCommunityErrorHandler.bind(o),o.unsetCurHandlers=o.unsetCurHandlers.bind(o),o.checkIntroData=o.checkIntroData.bind(o),o.checkAppAdd=o.checkAppAdd.bind(o),o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.takeAction=function(){var t=this;ajax.post("apps.php",O({act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId},this.request),{onDone:function(e){t.handleResponse(e,data,t.checkAppAdd)},onFail:function(e){t.errorHandler(e)}})},e.prototype.checkAppAdd=function(t){parseInt(t,10)&&this.successHandler({result:!0})},e.prototype.loadIntroData=function(t){var e=this;this.request=O({},t),ajax.post("apps.php",O({act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId},this.request),{onDone:function(n){e.handleResponse(n,t,e.checkIntroData)},onFail:function(t){e.errorHandler(t)}})},e.prototype.allowUIAction=function(t){this.loadIntroData(t),r.pop(this.modal)},e.prototype.checkIntroData=function(t,e){var n=this;t.items.length>0?showBox("apps",{act:"add_vk_app_to_groups_box",app_id:this.app.appId},{params:{dark:1,width:450,bodyStyle:"padding: 22px 0 0"},onFail:function(t){return showFastBox(getLang("global_error"),t),!0}}):0===t.items.length&&(this.errorHandler({code:1}),this.noCommunitiesBox=new MessageBox({title:getLang("global_error"),dark:1}).content(getLang("vkapps_no_admin_communities_warning")).addButton(getLang("global_close"),function(){n.noCommunitiesBox.hide()}).show())},e.prototype.unsetCurHandlers=function(){cur.vkAppAddToCommunitySuccessHandler=null,cur.vkAppAddToCommunityErrorHandler=null},e.prototype.addToCommunitySuccessHandler=function(t){this.successHandler(t),this.unsetCurHandlers()},e.prototype.addToCommunityErrorHandler=function(t){this.errorHandler(t||{code:4}),this.unsetCurHandlers()},e.prototype.handler=function(t,e,n){this.setData(t,e),this.callback=n,cur.vkAppAddToCommunitySuccessHandler=this.addToCommunitySuccessHandler,cur.vkAppAddToCommunityErrorHandler=this.addToCommunityErrorHandler,this.launchUI(t)},e.prototype.actionHandler=function(t){this.loadIntroData(t)},e}(w);var E=function(t){function e(n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n));return o.params.handlerName="VKWebAppGetUserInfo",o.callApi=!0,o.useUI=!1,o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(w);var P=function(t){function e(n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n));return o.params.handlerName="VKWebAppSetLocation",o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.actionHandler=function(t){t.hasOwnProperty("location")?"string"==typeof t.location?(window.isMVK?nav.set({replace:!0,nav:{push:location.pathname+location.search+"#"+t.location,path:location.pathname,hash:"#"+t.location}}):cur.app.funcs.setLocation(t.location),this.successHandler({})):this.errorHandler({code:u,reason:'Param "location" should be a string'}):this.errorHandler({code:p,reason:'Missing required param "location"'})},e}(w);var j=function(t){function e(n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n));return o.params.handlerName="VKWebAppGetClientVersion",o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.actionHandler=function(t){var e=a;window.isMVK&&(e=s),this.successHandler({platform:e,version:"0.0"},this.callback)},e}(w);var I=function(t){function e(n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n));return o.params.handlerName="VKWebAppGetPhoneNumber",o.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:getLang("apps_connect_modal_messages_request_phone"),text:getLang("apps_connect_modal_messages_request_phone_text")},o.callApi=!0,o.useUI=!0,o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(w);var x=function(t){function e(n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n));return o.params.handlerName="VKWebAppGetEmail",o.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:getLang("apps_connect_modal_messages_request_email"),text:getLang("apps_connect_modal_messages_request_email_text")},o.callApi=!0,o.useUI=!0,o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(w),T=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}();var S=function(t){function e(n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n));return o.params.handlerName="VKWebAppGetGeodata",o.callApi=!0,o.useUI=!1,o.timeoutFails=0,o.geodataSuccess=o.geodataSuccess.bind(o),o.geodataFail=o.geodataFail.bind(o),o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.geodataSuccess=function(t){var e=t.coords.longitude,n=t.coords.latitude;this.successHandler({available:!0,lat:n,long:e},this.callback)},e.prototype.geodataFail=function(t){switch(t.code){case 3:this.timeoutFails++,this.timeoutFails<2?navigator.geolocation.getCurrentPosition(this.geodataSuccess,this.geodataFail):this.errorHandler({code:h,reason:"Geolocation timeout error"},this.callback);break;case 2:this.errorHandler({code:h,reason:"Device can't get geodata"},this.callback);break;case 1:this.errorHandler({code:l,reason:"User didn't allowed"},this.callback)}},e.prototype.actionHandler=function(t){var e=this;if(!this.callApi)return{};navigator.geolocation.getCurrentPosition(function(t){return e.geodataSuccess(t)},function(t){return e.geodataFail(t)},{maximumAge:15e5,timeout:2e3})},T(e,[{key:"successDescriptor",get:function(){return"VKWebAppGeodataResult"}},{key:"errorDescriptor",get:function(){return"VKWebAppGeodataFailed"}}]),e}(w);var C=function(t){function e(n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n));return o.params.handlerName="VKWebAppOpenQR",o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.actionHandler=function(t){this.errorHandler({code:h,reason:"Unsupported platform"},this.callback)},e}(w);var W=function(t){function e(n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n));return o.params.handlerName="VKWebAppSetViewSettings",o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.actionHandler=function(t){this.errorHandler({code:h,reason:"Unsupported platform"},this.callback)},e}(w);var V=function(t){function e(n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n));return o.params.handlerName="VKWebAppSetTitle",o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.handler=function(t,e){this.errorHandler({code:h,reason:"Unsupported platform"},e)},e}(w),K=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t};var D=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.props=K({},e),n&&(this.callback=n),this.app_node=ge(this.props.containerId),this.modal=null,this.onAction=this.onAction.bind(this),this.onCancelAction=this.onCancelAction.bind(this),this.onAllow=this.onAllow.bind(this)}return t.prototype.show=function(){var t=this;setTimeout(function(){return t.modal.classList.add("show")},300)},t.prototype.destroy=function(){this.modal.parentNode.removeChild(this.modal),this.callback&&this.callback()},t.prototype.onAction=function(t){this.props.allowUIAction({scope:t,app_id:this.props.app_id}),this.destroy()},t.prototype.onCancelAction=function(t){t&&t(),this.destroy()},t.prototype.onAllow=function(){var t=this,e=[];Array.from(this.modal.querySelectorAll(".blind_label:checked")).map(function(n){var o=parseInt(n.id.replace("scope_",""),10);if(!t.props.scopes[o])throw new Error("There is no such scope");e.push(t.props.scopes[o])}),this.onAction(e.join(","))},t.prototype._renderBtn=function(t){var e=this,n=document.createElement("button");return n.setAttribute("type","button"),n.classList.add("vk_app_modal_btn"),n.classList.add("vk_app_modal_btn--"+t.type),n.innerText=t.title,"success"===t.type?n.addEventListener("click",function(){return e.onAllow()}):n.addEventListener("click",function(){return e.onCancelAction(t.action)}),n},t.prototype._renderBtns=function(t){var e=this;this.props.buttons.reverse().map(function(n){t.getElementsByClassName("vk_app_modal_btns")[0].appendChild(e._renderBtn(n))})},t.prototype._renderCloseBtn=function(t){var e=this,n=document.createElement("div");n.setAttribute("aria-label","Close"),n.setAttribute("tabindex","0"),n.setAttribute("role","button"),n.classList.add("box_x_button"),n.addEventListener("click",function(){return e.onCancelAction(e.props.cancelAction)}),t.querySelector(".box_title_wrap").appendChild(n)},t.prototype._renderOuter=function(){return document.querySelector(".vk_app_modal_outer")},t.prototype._enhanceBtnsWithActions=function(){var t=this;this.props.buttons&&this.props.buttons.forEach(function(e,n){"deny"===e.type?t.props.buttons[n].action=t.props.cancelAction:t.props.buttons[n].action=t.props.allowAction})},t.prototype._renderScopes=function(t){return t.map(function(t,e){return'\n    <div class="scope_row">\n      <input class="blind_label" type="checkbox" id="scope_'+e+'" checked="">\n      <label for="scope_'+e+'">'+getLang("apps_scope_"+t)+"</label>\n    </div>\n    "}).join("\n")},t.prototype.renderModal=function(){this._enhanceBtnsWithActions(),this.modal=this._renderOuter(),this.modal.innerHTML='\n  <div class="box_layout vk_app_modal_container">\n    <div class="box_title_wrap">\n       <div class="box_title">'+this.props.title+'</div>\n    </div>\n    <div class="box_body" style="display: block;">\n      '+(this.props.text?"<p>"+this.props.text+"</p>":"")+"\n      "+(this.props.scopes&&'<div class="vk_app_modal_scopes">'+this._renderScopes(this.props.scopes)+"</div>")+'\n    </div>\n    <div class="box_controls_wrap" style="display: block;">\n      <div class="box_controls vk_app_modal_btns"></div>\n    </div>\n  </div>\n',this.props.showCloseBtn&&this._renderCloseBtn(this.modal),this._renderBtns(this.modal)},t}(),N=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},U=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}();var L=function(t){function e(n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n));return o.params.handlerName="VKWebAppGetAuthToken",o.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:getLang("apps_connect_modal_messages_request_token")},o.callApi=!0,o.useUI=!0,o.onEditClick=o.onEditClick.bind(o),o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.scopeList=function(t){var e=this,n=this.app.params.whitelist_scopes?t.filter(function(t){return~e.app.params.whitelist_scopes.indexOf(t)}):t;return n=n.filter(function(t,e,n){return e===n.indexOf(t)})},e.prototype.checkScopes=function(t){var e=this;return 0===t.filter(function(t){return!e.app.params.whitelist_scopes.includes(t)}).length},e.prototype.onEditClick=function(t){this.editScopesModal.renderModal()},e.prototype.launchUI=function(t){this.createDenyUIAction(),this.createAllowUIAction(t),this.modal=new _(N({},this.params.modal,t,{scopes:this.params.scope,showCloseBtn:!0,extraAction:this.onEditClick})),this.editScopesModal=new D(N({},this.params.modal,t,{text:getLang("apps_connect_modal_messages_scopes_available"),scopes:this.params.scope,showCloseBtn:!0,allowUIAction:this.allowUIAction})),r.push(this.modal)},e.prototype.actionHandler=function(t){var e=this;return this.callApi?ajax.post("apps.php",N({act:"handle_vk_connect_event",hash:cur.app.options[d[this.params.handlerName]+"_hash"],event:d[this.params.handlerName],app_id:this.app.appId},t),{onDone:function(n){if(n.hasOwnProperty("error"))e.errorHandler(n.error);else try{var o=JSON.parse(n);o.status?e.successHandler(N({},o,{scope:t.scope})):e.errorHandler({reason:"Invalid params"})}catch(t){e.errorHandler(t)}},onFail:function(t){e.errorHandler(t)}}):{}},e.prototype.loadIntroData=function(t){var e=this;this.request=N({},t),this.app.appId==t.app_id?ajax.post("apps.php",{act:"handle_vk_connect_event",hash:cur.app.options[d[this.params.handlerName+"Preload"]+"_hash"],event:d[this.params.handlerName+"Preload"],app_id:this.app.appId,scope:t.scope},{onDone:function(n){if(n.hasOwnProperty("error"))e.errorHandler(n.error);else try{var o=JSON.parse(n);e.checkIntroData(o,t)}catch(t){console.log(t),e.errorHandler(t)}},onFail:function(t){e.errorHandler(t)}}):this.errorHandler({code:h,reason:"Wrong app id"})},e.prototype.checkIntroData=function(t,e){if(t.status){var n={};t.access_token&&(n.access_token=t.access_token),n.scope=this.params.scope.join(","),this.successHandler(n)}else this.launchUI(e)},e.prototype.handler=function(t,e,n){if(this.setData(t,e),this.callback=n,t.scope||""===t.scope)if("string"==typeof t.scope)if(t.app_id)if("number"==typeof t.app_id){var o=this.scopeStringToArray(t.scope);o&&this.checkScopes(o)?(this.params.scope=this.scopeList(o),this.loadIntroData(t)):this.errorHandler({code:i,reason:"Unknown error"},n)}else this.errorHandler({code:p,reason:'Param "app_id" should be a number'},n);else this.errorHandler({code:p,reason:'Missing required param "app_id"'},n);else this.errorHandler({code:p,reason:'Param "scope" should be a string'},n);else this.errorHandler({code:p,reason:'Missing required param "scope"'},n)},U(e,[{key:"successDescriptor",get:function(){return"VKWebAppAccessTokenReceived"}},{key:"errorDescriptor",get:function(){return"VKWebAppAccessTokenFailed"}}]),e}(w),q=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t};var M=function(t){function e(n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n));return o.params.handlerName="VKWebAppCallAPIMethod",o.params.v="5.85",o.params.method=null,o.resolveResponse=o.resolveResponse.bind(o),o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.actionHandler=function(t){var e=q({},t.params);t.request_id&&(e.request_id=t.request_id),function(t,e,n,o){if(e||(e={}),delete e.callback,t)if(e.hasOwnProperty("access_token")){var r={api_id:cur.app.params.api_id,method:t,format:"json",v:"5.80"};if(e)for(var a in e)e.hasOwnProperty(a)&&(a=trim(a),/^(rnd|format|api[\s.\[_]id|callback)(\s*\[|$)/.test(a)||(r[a]=e[a]));cur.app.api(t,r,function(t){e.request_id&&(t.request_id=e.request_id),n(t)},o)}else o({code:p,reason:"Missing required param access_token"});else o({code:p,reason:"Missing required param method"})}(t.method,e,this.resolveResponse)},e.prototype.resolveResponse=function(t){t&&(t.hasOwnProperty("error")?this.errorHandler(t.error):this.successHandler(t))},e.prototype.handler=function(t,e,n){this.callback=n,this.setData(t,e),t.params?t.params.v||t.params.version?isNaN(parseInt(t.params.v,10))&&isNaN(parseInt(t.params.version,10))?this.errorHandler({code:u,reason:'Param "v" should be a number'},n):(t.params.hasOwnProperty("v")?this.params.v=t.params.v:t.params.hasOwnProperty("version")&&(this.params.v=t.params.version),this.actionHandler(t)):this.errorHandler({code:p,reason:'Missing required param "v"'},n):this.errorHandler({code:p,reason:"Missing required params"},n)},e}(w),R=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t};var B=function(t){function e(n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n));return o.params.handlerName="VKWebAppJoinGroup",o.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_subscribe"),type:"success"}],text:getLang("apps_connect_modal_messages_join_group_text"),showCloseBtn:!0},o.callApi=!0,o.useUI=!0,o.allowUIAction=o.allowUIAction.bind(o),o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.takeAction=function(){var t=this;ajax.post("apps.php",R({act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId},this.request),{onDone:function(e){e.hasOwnProperty("error")?t.errorHandler(e.error):parseInt(e,10)?t.successHandler({result:!0}):t.errorHandler()},onFail:function(e){t.errorHandler(e)}})},e.prototype.loadIntroData=function(t){var e=this;this.request=R({},t),ajax.post("apps.php",R({act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId},this.request),{onDone:function(n){if(n.hasOwnProperty("error"))e.errorHandler(n.error);else try{var o=JSON.parse(n);e.checkIntroData(R({isGroupMember:o.is_group_member,canJoin:o.group.can_join},o.group),t)}catch(t){e.errorHandler(t)}},onFail:function(t){e.errorHandler(t)}})},e.prototype.allowUIAction=function(t){this.takeAction(t),r.pop(this.modal)},e.prototype.checkIntroData=function(t,e){t.canJoin?t.isGroupMember?this.successHandler({result:!0}):(this.params.modal.pic=t.photo_100,this.params.modal.app_name=t.name,this.params.modal.subscribers=t.members_count>1e3?Math.ceil(t.members_count/1e3):t.members_count,this.params.modal.title=t.name,this.createDenyUIAction(),this.createAllowUIAction(e),this._enhanceBtnsWithActions(),this.modal=new _(R({},this.params.modal)),r.push(this.modal)):this.errorHandler({code:h,reason:"User can not join this group"})},e.prototype.handler=function(t,e,n){this.setData(t,e),this.callback=n,t.group_id?"number"==typeof t.group_id?this.loadIntroData(t):this.errorHandler({code:p,reason:'Param "group_id" should be a number'},this.callback):this.errorHandler({code:p,reason:'Param "group_id" is missing'},this.callback)},e.prototype.actionHandler=function(t){this.loadIntroData(t)},e}(w),F=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t};var G=function(t){function e(n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n));return o.params.handlerName="VKWebAppAllowMessagesFromGroup",o.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],text:getLang("apps_connect_modal_messages_allow_messages_text"),title:getLang("apps_connect_modal_messages_allow_messages_title")},o.callApi=!0,o.useUI=!0,o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.takeAction=function(){var t=this,e={group_id:this.request.group_id};this.request.hasOwnProperty("key")&&(e.key=this.request.key),ajax.post("apps.php",F({act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId},e),{onDone:function(e){e.hasOwnProperty("error")?t.errorHandler(e.error):parseInt(e,10)?t.successHandler({result:!0}):t.errorHandler()},onFail:function(e){t.errorHandler(e)}})},e.prototype.loadIntroData=function(t){var e=this;this.request=F({},t),ajax.post("apps.php",{act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId,group_id:this.request.group_id},{onDone:function(n){if(n.hasOwnProperty("error"))e.errorHandler(n.error);else try{var o=JSON.parse(n);e.checkIntroData(F({can_send_messages:o.can_send_messages},o.group),t)}catch(t){e.errorHandler(t)}},onFail:function(t){e.errorHandler(t)}})},e.prototype.allowUIAction=function(t){this.takeAction(t),r.pop(this.modal)},e.prototype.checkIntroData=function(t,e){t.can_send_messages?this.successHandler({result:!0}):(this.params.modal.pic=t.photo_100,this.params.modal.app_name=t.name,this.params.modal.subscribers=t.members_count>1e3?Math.ceil(t.members_count/1e3):t.members_count,this.params.modal.text=this.params.modal.text.replace("{group_name}",t.name),this.createDenyUIAction(),this.createAllowUIAction(e),this._enhanceBtnsWithActions(),this.modal=new _(F({},this.params.modal)),r.push(this.modal))},e.prototype.handler=function(t,e,n){this.setData(t,e),this.callback=n,t.group_id?"number"==typeof t.group_id?this.loadIntroData(t):this.errorHandler({code:p,reason:'Param "group_id" should be a number'},this.callback):this.errorHandler({code:p,reason:'Param "group_id" is missing'},this.callback)},e.prototype.actionHandler=function(t){this.loadIntroData(t)},e}(w);var J=function(t){function e(n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n));return o.params.handlerName="VKWebAppDenyNotifications",o.callApi=!0,o.useUI=!1,o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(w),Q=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t};var z=function(t){function e(n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n));return o.params.handlerName="VKWebAppOpenPayForm",o.checkTransaction=o.checkTransaction.bind(o),o.destroyVkPayContainer=o.destroyVkPayContainer.bind(o),o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.actionHandler=function(t){t.action?"string"==typeof t.action?t.params?t.hasOwnProperty("app_id")&&"number"!=typeof t.app_id?this.errorHandler({code:p,reason:'"app_id" param should be an integer number'}):this.launchVkPayContainer(t):this.errorHandler({code:p,reason:'Missing required param "params"'}):this.errorHandler({code:p,reason:'Param "action" should be a string'}):this.errorHandler({code:p,reason:'Missing required param "action"'})},e.prototype.openPayApp=function(t){var e=Q({},t.params);e.action=t.action,cur.app.funcs.openExternalApp("vkpay",e)},e.prototype.checkTransaction=function(t){var e=!isMVK||t.origin===location.origin;t.data&&"vk-connect"===t.data.type?"VKWebAppActionDone"===t.data.handler&&e&&(t.data.params.status?this.successHandler(Q({},t.data.params),this.callback):this.errorHandler({code:i,reason:Q({},t.data.params,{error_msg:"VK Pay payment failed"})}),window.isMVK||this.destroyVkPayContainer()):t.data&&t.data.externalAppClosed&&this.errorHandler({code:l,reason:"User denied"})},e.prototype.destroyVkPayContainer=function(){window.removeEventListener("message",this.checkTransaction)},e.prototype.launchVkPayContainer=function(t){this.openPayApp(t),window.addEventListener("message",this.checkTransaction)},e}(w),X=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t};var Y=function(t){function e(n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n));return o.params.handlerName="VKWebAppAllowNotifications",o.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:getLang("apps_connect_modal_messages_allow_notifications_title"),text:getLang("apps_connect_modal_messages_allow_notifications_text")},o.callApi=!0,o.useUI=!0,o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.takeAction=function(){var t=this,e={group_id:this.request.group_id};this.request.hasOwnProperty("key")&&(e.key=this.request.key),ajax.post("apps.php",X({act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId},e),{onDone:function(e){e.hasOwnProperty("error")?t.errorHandler(e.error):parseInt(e,10)?t.successHandler({result:!0}):t.errorHandler()},onFail:function(e){t.errorHandler(e)}})},e.prototype.loadIntroData=function(t){var e=this;this.request=X({},t),ajax.post("apps.php",{act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId},{onDone:function(n){if(n.hasOwnProperty("error"))e.errorHandler(n.error);else try{var o=JSON.parse(n);e.checkIntroData(X({can_send_messages:o.can_send_messages},o.group),t)}catch(t){e.errorHandler(t)}},onFail:function(t){e.errorHandler(t)}})},e.prototype.allowUIAction=function(t){this.takeAction(t),r.pop(this.modal)},e.prototype.checkIntroData=function(t,e){t.can_send_messages?this.successHandler({result:!0}):(this.params.modal.pic="/images/vk-app-notification.png",this.params.modal.app_name=t.name,this.createDenyUIAction(),this.createAllowUIAction(e),this._enhanceBtnsWithActions(),this.modal=new _(X({},this.params.modal)),r.push(this.modal))},e.prototype.handler=function(t,e,n){this.setData(t,e),this.callback=n,this.loadIntroData(t)},e}(w),$=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t};var Z=function(t){function e(n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n));return o.params.handlerName="VKWebAppOpenApp",o.destroy=o.destroy.bind(o),o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.actionHandler=function(t){var e=this,n={open_app_id:t.app_id};this.openAppId=t.app_id,t.location&&(n.location=t.location),this.openApp=$({},n),ajax.post("apps.php",$({act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId},n),{onDone:function(t){try{var n=JSON.parse(t);n.hasOwnProperty("original_url")?(e.successHandler({result:!0}),window.isMVK?cur.app.openAppInLayer(n.original_url):cur.app.openAppInLayer(n.original_url,e.destroy)):n.hasOwnProperty("error")&&e.errorHandler({code:u,reason:"Invalid params"})}catch(t){e.errorHandler(t)}},onFail:function(t){e.errorHandler(t)}})},e.prototype.destroy=function(){var t=this;if(cur.vkAppQueue){var e=Object.keys(cur.vkAppQueue).filter(function(e){return~e.indexOf(t.openAppId)});e.length>0&&(cur.vkAppQueue[e[0]].destroyView(),delete cur.vkAppQueue[e[0]])}},e.prototype.handler=function(t,e,n){this.setData(t,e),this.callback=n,t.app_id?"number"==typeof t.app_id?t.hasOwnProperty("location")&&"string"!=typeof t.location?this.errorHandler({code:u,reason:'"location" param should be a string'},n):this.actionHandler(t):this.errorHandler({code:u,reason:'Param "app_id" should be a number'},n):this.errorHandler({code:u,reason:'Missing required param "app_id"'},n)},e.prototype.createUrl=function(t){return"app"+t.app_id+(t.hasOwnProperty("location")?"#"+t.location:"")},e}(w),tt=Object.assign(et,{kind:function(){var t={};return function(e){return t[e]||(t[e]=et())}}});function et(){var t=[],e=function(){var t=this,e=arguments;if("function"!=typeof e[0]){for(var n=t.length,o=!1,r=0;r<n;r++)!0===t[r].apply(null,e)&&(o=!0);return o}Array.prototype.slice.call(e).forEach(function(e){return t.push(e)})}.bind(t);return e.off=function(t){t?function(t,e){for(;;){var n=t.indexOf(e);if(!(n>=0))break;t.splice(n,1)}}(this,t):this.length=0}.bind(t),e._fns=t,e}window.befall=et;var nt=function(t){function e(n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n));return o.params.handlerName="VKWebAppShare",o.appId=cur.app.params.api_id,o.userId=cur.app.params.viewer_id,o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.actionHandler=function(t){t.link&&"string"!=typeof t.link?this.errorHandler({code:u,reason:'Param "link" should be a string'},this.callback):window.isMVK?(this.shareMvkEmitters(),cur.app.funcs.shareBox(t.link?t.link:location.href,"","","",this.successHandler,this.errorHandler)):t.link?cur.app.funcs.showWallPostBox({message:t.link},this.successHandler,this.errorHandler):this.share(this.appId,this.userId)},e.prototype.share=function(t,e){var n=this;showBox("like.php",{act:"publish_box",object:"app"+t+"_"+e},{onDone:function(){n.successHandler({success:!0},n.callback)},onFail:function(){n.errorHandler({code:h,reason:"Unknown error"},n.callback)}})},e.prototype.shareMvkEmitters=function(){var t=this;cur.app.mvkShareSuccess=tt(),cur.app.mvkShareSuccess(function(e){parseInt(e,10)&&t.successHandler({post_id:e})}),cur.app.mvkShareFail=tt(),cur.app.mvkShareFail(function(e){e?t.errorHandler(e):t.errorHandler({error_type:"client_error",code:4})})},e}(w);var ot=function(t){function e(n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n));return o.params.handlerName="VKWebAppShowWallPostBox",o.externalSuccessHandler=o.externalSuccessHandler.bind(o),o.externalErrorHandler=o.externalErrorHandler.bind(o),o.setExternalHandlers(),o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.setExternalHandlers=function(){cur.VKWebAppShowWallPostBoxErrorHandler=this.externalErrorHandler,cur.VKWebAppShowWallPostBoxSuccessHandler=this.externalSuccessHandler},e.prototype.removeExternalHandlers=function(){cur.VKWebAppShowWallPostBoxErrorHandler=null,cur.VKWebAppShowWallPostBoxSuccessHandler=null},e.prototype.externalSuccessHandler=function(t){t&&t[1]?this.successHandler({post_id:t[1]}):this.errorHandler(),this.removeExternalHandlers()},e.prototype.externalErrorHandler=function(){this.errorHandler({code:l,reason:"User denied"}),this.removeExternalHandlers()},e.prototype.actionHandler=function(t){cur.app.funcs.showWallPostBox(t,this.successHandler,this.errorHandler)},e}(w),rt=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}();var at=function(){function t(e,n,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.desiredOffset=e,this.speed=n,this.onComplete=o,this.initialScrollPosition=null,this.diff=0,this.startingTime=Date.now(),this.requestId=null,this.init(),this.step=this.step.bind(this)}return t.prototype.init=function(){this.initialPosition()},t.prototype.initialPosition=function(){var t=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight)-window.innerHeight;this.initialScrollPosition=window.scrollY||document.documentElement.scrollTop,this.initialAxisScrollPosition=window.scrollX||document.documentElement.scrollLeft,this.desiredOffset>t&&(this.desiredOffset=t),this.diff=this.desiredOffset-this.initialScrollPosition,this.diff},t.prototype.scroll=function(t){window.scrollTo(this.initialAxisScrollPosition,t)},t.prototype.step=function(){var t=Date.now()-this.startingTime,e=t/this.duration-1,n=e*e*e+1,o=Math.round(this.initialScrollPosition+this.diff*n);t<this.duration&&this.scrollPosition!==this.desiredOffset?(this.scroll(o),this.requestID=requestAnimationFrame(this.step)):(this.scroll(this.desiredOffset),cancelAnimationFrame(this.requestID),this.onComplete&&"function"==typeof this.onComplete&&this.onComplete())},rt(t,[{key:"duration",get:function(){return Math.abs(Math.round(this.diff/1e3*this.speed))}}]),t}();var st=function(t){function e(n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n));return o.params.handlerName="VKWebAppScroll",o.useUI=!1,o.onScrollEnd=o.onScrollEnd.bind(o),o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.onScrollEnd=function(){this.successHandler({result:{top:this.params.data.top,height:document.documentElement.offsetHeight}})},e.prototype.actionHandler=function(t){t.hasOwnProperty("top")?"number"==typeof t.top?t.hasOwnProperty("speed")&&"number"!=typeof t.speed?this.errorHandler({code:u,reason:'"speed" param should be a number'}):(this.params.data={top:t.top},t.hasOwnProperty("speed")?this.scroll=new at(t.top,t.speed,this.onScrollEnd):this.scroll=new at(t.top,0,this.onScrollEnd),this.scroll.step()):this.errorHandler({code:u,reason:'Param "top" should be a number'}):this.errorHandler({code:p,reason:'Missing required param "top"'})},e}(w),it=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t};var pt={VKWebAppInit:g,VKWebAppGetCommunityAuthToken:k,VKWebAppAddToCommunity:H,VKWebAppGetUserInfo:E,VKWebAppSetLocation:P,VKWebAppGetClientVersion:j,VKWebAppGetPhoneNumber:I,VKWebAppGetEmail:x,VKWebAppGetGeodata:S,VKWebAppOpenQR:C,VKWebAppSetViewSettings:W,VKWebAppSetTitle:V,VKWebAppGetAuthToken:L,VKWebAppCallAPIMethod:M,VKWebAppJoinGroup:B,VKWebAppAllowMessagesFromGroup:G,VKWebAppDenyNotifications:J,VKWebAppAllowNotifications:Y,VKWebAppOpenPayForm:z,VKWebAppOpenApp:Z,VKWebAppShare:nt,VKWebAppShowWallPostBox:ot,VKWebAppScroll:st,VKWebAppResizeWindow:function(t){function e(n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n));return o.params.handlerName="VKWebAppResizeWindow",o.useUI=!1,o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.setWidth=function(t){var e=166;t&&this.app.vkApp&&(t=Math.min(Math.max(t,607),1e3),this.app.vkApp.options.layout_width&&(e=this.app.vkApp.options.layout_width-t),this.app.vkApp.options.layer?WkView.onResize():window.handlePageView&&handlePageView({noleftmenu:vk.noleftmenu,nobottommenu:vk.nobottommenu,notopmenu:vk.notopmenu,body_class:vk.body_class,staticheader:vk.staticheader,no_ads:vk.no_ads,ad_preview:vk.ad_preview,top_home_link_class:vk.top_home_link_class,width:Math.max(t,607)+e}),this.app.vkApp.frame.style.width=this.app.vkApp.cont.style.width=t+"px",this.result.width=t)},e.prototype.setHeight=function(t){if(t){t=Math.min(Math.max(t,500),4050),this.app.vkApp.inlineApp&&t>this.app.vkApp.options.heightMax&&!this.app.vkApp.params.is_vkpay_service&&(t=this.app.vkApp.options.heightMax);var e=t+"px";this.app.vkApp.frame.style.height=e,this.app.vkApp.options.boxed||(this.app.vkApp.cont.style.height=e),this.app.vkApp.options.layer&&WkView.onResize(),this.app.vkApp.options.onResize&&this.app.vkApp.options.onResize(),this.result.height=t}},e.prototype.actionHandler=function(t){window.isMVK?this.errorHandler({code:h,reason:"Unsupported platform"},this.callback):t.hasOwnProperty("width")&&"number"!=typeof t.width?this.errorHandler({code:u,reason:'Param "width" should be a number'}):t.hasOwnProperty("height")&&"number"!=typeof t.height?this.errorHandler({code:u,reason:'Param "height" should be a number'}):t.hasOwnProperty("height")||t.hasOwnProperty("width")?(this.result={},t.hasOwnProperty("width")&&this.setWidth(t.width),t.hasOwnProperty("height")&&this.setHeight(t.height),this.successHandler({result:it({},this.result)})):this.errorHandler({code:p,reason:"At least one parameter is required"})},e}(w)},ct=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},lt=function(t,e){if(pt[t.handler]){(new pt[t.handler]).handler(ct({},t.params,{containerId:e.containerId,pic:t.pic}),e,function(t){var n;ge(e.containerId)&&(n=t,ge(e.containerId).querySelector("iframe").contentWindow.postMessage(ct({},n),"*"))})}},ut=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t};var ht=function(){function t(e,n,o,r,a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.appId=n.aid,this.src=n.src,this.pic=r,this.params=ut({},o),this.containerId=e,this.vkApp=a,this.handler=this.handler.bind(this)}return t.prototype.init=function(){window.addEventListener("message",this.handler)},t.prototype.destroyView=function(){window.removeEventListener("message",this.handler)},t.prototype.handler=function(t){if(t.data&&"vk-connect"===t.data.type&&o(t.origin)===o(this.src)){var e=this;if(cur.vkAppQueue&&Object.keys(cur.vkAppQueue).length>1){var n=Object.keys(cur.vkAppQueue)[1];n===this.containerId&&(e=cur.vkAppQueue[n],lt(ut({},t.data,{pic:this.pic}),e))}else lt(ut({},t.data,{pic:this.pic}),e)}},t}();Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(t,e){if(null==this)throw new TypeError('"this" is null or not defined');var n=Object(this),o=n.length>>>0;if(0===o)return!1;var r,a,s=0|e,i=Math.max(s>=0?s:o-Math.abs(s),0);for(;i<o;){if((r=n[i])===(a=t)||"number"==typeof r&&"number"==typeof a&&isNaN(r)&&isNaN(a))return!0;i++}return!1}});e.a=function(t,e,n,o,r){if(cur.vkAppQueue||(cur.vkAppQueue={}),!cur.vkAppQueue[t]){var a=new ht(t,e,n,o,r);a.init(),cur.vkAppQueue[t]=a}}}}]);try{stManager.done("cmodules/bundles/63cc894c1323b715b7b33772086e4b56.js")}catch(t){}