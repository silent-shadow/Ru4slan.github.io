define(["util/promise","base/collection","base/model"],function(a,b,c){"use strict";return b.extend({props:{func:"app.notify",model:c},public:{getFetchParams:function(){return{apps:this.options.appId}},adapter:function(a){var b=Object.keys(a.data)[0],c=a.data[b];return{items:c.notifications.map(function(a){var b={};return b.fresh=a.fresh,b.notifyText=a.notify_text,0===a.type.indexOf("invite")?b.ref="i":0===a.type.indexOf("request")?b.ref="req":b.ref="ntf",a.author?(b.authorName=a.author.first_name||a.author.last_name?a.author.first_name+" "+a.author.last_name:a.author.nick,b.authorAvatar=a.author.avatars[45],b.authorLink=a.author.dir,b.ref+=a.author.auid):b.pic=c.app.Pictures.Pic5,a.hash&&(b.ref+="#hash="+a.hash),b})}},getNotifies:function(){return new a(function(a,b){var c=this.getItems();c.length?a(c):this.fetch().then(a,b)}.bind(this))}}})});