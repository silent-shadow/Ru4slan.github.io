if(define(["jquery","client-server","counters","app/history","util/schedule","apps/disable-autoinit"],function(a,b,c,d,e){"use strict";return{create:function(){return{onLoad:function(f){var g,h=JSON.parse(f.html()),i={};i.app_id=h.ID,i.session_key=h.session_key,i.vid=h.vid,h.APINotCounted&&(window.mailru.apiStat=function(){b.func("connect.set_app_using_api",[h.ID]),window.mailru.apiStat=function(){return!1}}),mailru.app_id=h.ID,mailru.domain=h.domain,mailru.private_key=h.private_key,mailru.server.inited=!0,h.EnvHost&&(mailru.server.def.HOST=h.EnvHost),g=mailru.utils.parseGet(location.search.substr(1)).anchor,g&&d.hash(g,d.SetHashModes.SUPPRESS_EVENT),mailru.server.init(h.RecieverUrl,h.FCID,i),mailru.server.appStat=new e(function(){var b,c,d,e,f=document.getElementById(h.ID)||!1,g=!1;return f&&(g=!0,mailru.server.appStat.stop(),f.src.indexOf("&")===-1&&((new window.Image).src="//gstat.imgsmail.ru/gstat?api.param2=1&rnd="+Math.random(),b=function(a,b){var c=(1<<b).toString(2).substr(1)+a;return c.substr(a.length-b,b)},c=(new window.Date).toUTCString().split(/\s|:/),e=["empty_src",c[3],c[2],b(c[1],2),b(c[4],2),b(c[5],2),b(c[6],2)].join("_"),d=a("<iframe>",{position:"absolute",left:"-1000px",src:h.loggerURL+e+"&statdata="+window.escape(f.src)}),a("#boosterCanvas").append(d))),g},100,!0),mailru.events.listen(mailru.plugin.events.liked,function(){mailru.server.intercom.wrp.send({event:"app.like",result:{data:"liked"}}),c.myrb("d754956")}),mailru.events.listen(mailru.plugin.events.unliked,function(){mailru.server.intercom.wrp.send({event:"app.like",result:{data:"unliked"}})}),mailru.plugin.init()}}}}}),"object"!=typeof mailru&&(mailru={}),function(a,b){function c(){var b=a.navigator.userAgent,c=b.match(/(OPR|Edge|Amigo)\/(\d+)/),d=b.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(d[1])?(c=/\brv[ :]+(\d+)/g.exec(b)||[],d=["MSIE",c[1]]):"Chrome"===d[1]&&null!==c?d="OPR"===c[1]?["Opera",c[2]]:[c[1],c[2]]:(d=d[2]?[d[1],d[2]]:[navigator.appName,navigator.appVersion],c=b.match(/version\/(\d+)/i),null!==c&&d.splice(1,1,c[1])),{name:d[0].toLowerCase(),version:d[1].toLowerCase()}}function d(a,b){var c;for(c in b)b.hasOwnProperty(c)&&0!=c&&(a.hasOwnProperty(c)?d(a[c],b[c]):a[c]=b[c])}var e,f,g,h=a.document,i=[],j=[];f="https:"===a.location.protocol?"https://":"http://",g={appsmail:f+"www.appsmail.ru/",connect:f+"connect.mail.ru/",imgsmail:f+"my2.imgsmail.ru/",mymail:f+"my.mail.ru/"},mailru.browser=c(),"opera"===mailru.browser.name&&mailru.browser.version<15?mailru.isOpera=!0:"msie"===mailru.browser.name&&(mailru.isIE=!0),(new Image).src=f+"my.mail.ru/grstat?name=my.api.browsers.total:my.api.browsers."+mailru.browser.name+"."+mailru.browser.version+"&r="+Math.random(),e={modules:{receiver:2,proxy:1,api:16,xdm:1},require:function(a,c,d){var e,f,g,k=this.getHost("imgsmail")+"mail/ru/images/js/connect/";a.name?(e=a.name,f=a.version?a.version:"latest"):e=a,i[e]?c():(k+=e+"/",f&&(k+=f+"/"),k+=e,a.dev||(k+="_min"),j[e]?j[e].push(c):(j[e]===b&&(j[e]=[]),j[e].push(c),g=h.createElement("script"),g.type="text/javascript",g.src=k+".js?"+this.modules[e],d&&(g.defer="defer"),h.getElementsByTagName("head")[0].appendChild(g)))},onready:function(a){var b,c=j[a],d=location.href.match(/throwing=1/i),e=d&&d.length>0;if(c&&(i[a]=!0,c.length))for(b=0;b<c.length;b+=1)if(e)c[b]();else try{c[b]()}catch(a){}},getHost:function(a){return g[a]},getEnv:function(){var b="https:"===a.location.protocol,c=null!==a.location.href.match(/__prerelease/i),d=a.location.href.match(/__branch=([a-z0-9\-]*)/i),e=d&&d.length>0?d[1]:"";return{branch:e,isHttps:b,prerelease:c}},getMode:function(a){var b="http-live";return""!==a.branch&&a.isHttps?b="https-alpha":""!==a.branch?b="http-alpha":a.prerelease?b="http-prerelease":a.isHttps&&(b="https-live"),b}},mailru.loader?mailru.loader.onready||d(mailru.loader,e):mailru.loader=e,mailru.isApp=a.name.indexOf("mailruapp")!==-1,a.postMessage?mailru.intercomType="event":mailru.intercomType="hash",mailru.init=function(b,c,d){mailru.loader.require("api",function(){var e;try{mailru.app.init(c)}catch(a){}d&&(e=h.getElementById(d))&&(a.setTimeout(b,1),mailru.events.listen("event",function(a,b){h.getElementById(d).mailruEvent(a,b)}))})},mailru.autoInit=function(){if(!mailru.disableAutoInit){var a,b=h.getElementsByTagName("a"),c=b.length;for(a=0;a<c;a+=1)if("undefined"!=typeof b[a]&&b[a].className.indexOf("mrc__plugin")!=-1){mailru.loader.require("api",function(){mailru.plugin.init()});break}}}()}(window),void 0===window.mailru)throw new Error("use loader.js to init the api");void 0===window.mailru.inited&&!function(){function a(a){return mailru.loader.getHost("mymail")+"cgi-bin/connect/api/"+a+"?"}function b(a){var b=mailru.loader.getEnv();return""!==b.branch?a.__branch=b.branch:b.prerelease&&(a.__prerelease=b.prerelease),a}function c(a){a=a||!1,mailru.intercom.init(a),mailru.isIE?mailru.utils.addHandler(window,"load",function(){mailru.connect.initButton()}):mailru.connect.initButton(),mailru.inited=!0;var b='.mrc__translayer {background: rgba(255,255,255,0.7); position: fixed; left: 0; top: 0; width: 100%; height: 100%; z-index: 999999; display: none}\n.mrc__translayer:before {background: url(//my1.imgsmail.ru/mail/ru/images/my/compass/static/progress/preloader_grayonwhite.gif) no-repeat center center; bottom: 0; content: ""; display: block; left: 0; margin: auto; position: absolute; right: 0; top: 0; height: 12px; width: 64px;}\n.mrc__translayer_on iframe {box-shadow: 0 2px 5px rgba(0,0,0,0.35); visibility: hidden;}.mrc__translayer_on {background-image:none;}';(mailru.isIE||mailru.isOpera)&&(b+=".mrc__translayer_on object {visibility: hidden}\n");var c=document.getElementsByTagName("head")[0],d=document.createElement("style"),e=document.createTextNode(b);d.type="text/css",d.styleSheet?d.styleSheet.cssText=e.nodeValue:d.appendChild(e),c.appendChild(d)}function d(){return Math.round(1e7*Math.random(+new Date+Math.random()))}function e(a,b){var c,e=[],f=b||{},g=a.toString();for(c in f)f.hasOwnProperty(c)&&e.push(c+"="+f[c]);(new Image).src="https://my.mail.ru/grstat?name="+g+"&"+e.join("&")+"&r="+d(),(new Image).src="//csp.my.mail.ru/jserr/?name="+g+"&"+e.join("&")+"&r="+d()}mailru.isApp=!1,mailru.app_id=-1,mailru.session=!1,mailru.inited=!1,mailru.def={DOMAIN:function(){try{return document.URL.match(/(?:https?:\/\/)?([^\/\?#]+)/i)[1]}catch(a){(new Image).src="//gstat.imgsmail.ru/gstat?api.param4=1&rnd="+Math.random();try{return document.domain}catch(a){return""}}}(),API_URL:mailru.loader.getHost("appsmail")+"platform/japi?",PROXY_URL:mailru.loader.getHost("connect")+"proxy?",CONNECT_LOGOUT_URL:"https://auth.mail.ru/cgi-bin/logout?app=1",CONNECT_OAUTH:mailru.loader.getHost("connect")+"oauth/authorize?",PLUGIN_URL:function(){var a,b,c,d="//connect.mail.ru/";try{a=document.location.search,b=a.match(/__branch=([a-z0-9\-]*)/i),c=null!==a.match(/__prerelease/i),b&&b.length>1?d="//"+b[1]+".connect.myalpha15.i.mail.ru/":c&&(d="//connect.myalpha6.i.mail.ru/")}catch(a){}return d}(),LIKE:{BUTTON_URL:mailru.loader.getHost("connect")+"share_button?",CAPTCHA_URL:mailru.loader.getHost("connect")+"share?layout=captcha&",COMMENT_URL:mailru.loader.getHost("connect")+"share_comment?"},CONNECT_COOKIE:"mrc",PARTNER_ID_COOKIE:"partner_id",CONNECT_BUTTON_BG_URL:mailru.loader.getHost("imgsmail")+"/r/my/app/connect/connect-button.png",SESSION_REFRESH_EVERY:864e5};var f,g=[];f={unsupported:"Method %s out-of-date and no longer supported."},mailru.batcher={isBatching:!1,start:function(){this.isBatching=!0},reqest:function(a,b,c){c=c||function(){};var d=mailru.callbacks.add(c);b=b||{},b.method=a,b.app_id=mailru.app_id,b.cb="mailru.callbacks["+d+"]",b.session_key=mailru.session.session_key||"",b=mailru.utils.sign(b),this.isBatching?g.push(b):mailru.utils.apiOverJSONP(b)},exec:function(){var a,b,c={};if(this.isBatching){if(this.isBatching=!1,b=g.length,a=b-1,b>0)for(;a>=0;)c["request"+a]=mailru.utils.makeGet(g[a]),a-=1;c.method="batcher",c.app_id=mailru.app_id,c.session_key=mailru.session.session_key||"",c=mailru.utils.sign(c),mailru.utils.apiOverJSONP(mailru.utils.sign(c)),g={}}}},mailru.utils={uniqid:function(){return Math.round(1e7*Math.random(+new Date+Math.random()))},apiOverJSONP:function(a,b){var c,d=document.getElementsByTagName("head")[0].appendChild(document.createElement("script"));d.type="text/javascript",b=b||mailru.def.API_URL,c=b+(b.indexOf("?")===-1?"?":"&")+mailru.utils.makeGet(a),d.src=c},utcDate:function(){return parseInt((new Date).getTime()/1e3,10)},requestOverProxy:function(a,b){var c,d,f;return b=b||mailru.def.PROXY_URL,a.host=location.protocol+"//"+mailru.def.DOMAIN,c=b+mailru.utils.makeGet(a),mailru.isApp&&"xdm"===mailru.intercomType?d=new mrcXDM.Socket({windowName:!0,isHost:!0,remote:c+"&appProxy=1",onMessage:function(a){mailru.intercom.receiver(a),e("my.api.intercomType-xdm",{app_id:mailru.app_id,isIE:mailru.isIE})}}):(f=document.createElement("iframe"),f.src=c,f.style.border="0",f.style.position="absolute",f.style.left="-10000px",f.style.top="-10000px",f.style.height="0",document.body.insertBefore(f,document.body.getElementsByTagName("*")[0])),d},requestOverReceiver:function(a){var b=document.createElement("iframe");b.src=mailru.def.APP_RECEIVER+mailru.utils.makeGet(a),b.style.border="0",b.style.position="absolute",b.style.left="-10000px",b.style.top="-10000px",document.body.appendChild(b)},makeGet:function(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&(c[c.length]=b+"="+encodeURIComponent(a[b]));return c.join("&")},parseGet:function(a){var b,c=a.split("&"),d=c.length-1,e={};if(c.length>0)for(;d>=0;){b=c[d].indexOf("=");try{e[c[d].substr(0,b)]=decodeURIComponent(c[d].substr(b+1))}catch(a){}d-=1}return e},toArray:function(a){var b=[],c=a.length,d=c-1;if(c>0)for(;d>=0;)b[d]=a[d],d-=1;return b},fromJSON:function(a){try{return JSON.parse(a)}catch(a){return null}},foreach:function(a,b){var c,d;if(void 0!==a.length)for(c=0;c<a.length;c+=1)b(a[c],c);else for(d in a)a.hasOwnProperty(d)&&b(a[d],d)},setCookie:function(a){return!(!a||!a.name)&&(a.domain=a.domain||mailru.def.DOMAIN,a.path=a.path||"/",void(document.cookie=a.name+"="+window.escape(a.value)+(a.expires?"; expires="+new Date(a.expires).toUTCString():"")+(a.path?"; path="+a.path:"")+(a.domain?"; domain=."+a.domain:"")+(a.secure?"; secure":"")))},getCookie:function(a){var b=document.cookie.match(new RegExp("(^|;\\s*)"+a+"=([^;]+)(;|$)"));if(b)return window.unescape(b[2])},addHandler:function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)},mixin:function(a,b,c){var d;for(d in b)!b.hasOwnProperty(d)||c&&a[d]||(a[d]=b[d])},extend:function(a,b){var c,d={};for(c in b)b.hasOwnProperty(c)&&void 0===d[c]&&0!=c&&(a.hasOwnProperty(c)?mailru.utils.extend(a[c],b[c]):a[c]=b[c])},sign:function(a){var b,c,d=[],e=[],f="";for(b in a)a.hasOwnProperty(b)&&(d[d.length]=b);for(d=d.sort(),c=0;c<d.length;c+=1)e+=d[c]+"="+a[d[c]];return a.sig=mailru.utils.md5(f+mailru.session.vid+e+mailru.private_key),a},css:{getStyle:function(a,b){var c="string"==typeof a?document.getElementById(a):a,d=null;return c.currentStyle?d=c.currentStyle[b]:window.getComputedStyle&&(d=document.defaultView.getComputedStyle(c,null).getPropertyValue(b)),d}},md5:function(a){return mailru.utils.CryptoJS.MD5(a).toString()},modal:{open:function(a,b,c){var d,e,f,g,h,i=this,j=["px","em","%"];if(b=b||{},b.wid?d=b.wid:(d=mailru.utils.uniqid(),b.wid=d),void 0===b.id&&(b.id=d),void 0===b.name&&(b.name=d),void 0===b.url&&(b.url={}),b.url.host=location.protocol+"//"+mailru.def.DOMAIN,b.url.wid=d,b.url.type=b.type,b.url.app_id=mailru.app_id,b.url.appid=mailru.app_id,mailru.session.session_key&&(b.url.session_key=mailru.session.session_key),a+=c?mailru.utils.makeGet(mailru.utils.sign(b.url)):mailru.utils.makeGet(b.url),"modal"===b.type&&i.windows.length>0)return i.queue.add(a,b),b.wid;i.windows[d]=document.createElement("iframe"),e=i.windows[d],e.frameBorder=0,e.allowtransparency=!0,e.id=b.id,e.name=b.name,e.type=b.type,e.scrolling="no",e.src=a,b.type?e.modalType=b.type:e.modalType="modal";for(f in i.styles[e.modalType])i.styles[e.modalType].hasOwnProperty(f)&&(e.style[f]=i.styles[e.modalType][f]);if(b.style)for(f in b.style)b.style.hasOwnProperty(f)&&(e.style[f]=b.style[f]);else b.style={};if(i.translayer||(i.translayer=document.createElement("div")),"modal"===b.type)i.windows.length+=1,i.translayer.style.display="block",i.translayer.className="mrc__translayer",i.translayer.appended=!0,document.body.appendChild(i.translayer),"ok"===b.url.tp&&"insertable"===b.url.type&&(e.url="http://connect.ok.ru/dk?st.cmd=WidgetShare&st.shareUrl="+b.url.url+"&st.fid="+b.id+'&st.settings={width:125,height:25,st:"oval",sz:'+b.url.sz+",ck:1}"),document.body.appendChild(e);else if("insertable"===b.type){if(e.setAttribute("allowTransparency",!0),b.insertOptions){if(b.insertOptions.insertAfter&&(b.place=b.place.nextSibling),b.insertOptions.position&&(i.windows[d].style.position="absolute",i.windows[d].style.left=b.insertOptions.position.left+"px",i.windows[d].style.top=b.insertOptions.position.top+"px"),b.insertOptions.body)document.body.appendChild(e);else if(b.insertOptions.wrap){var k=document.createElement("span");k.setAttribute("style","position: relative; left: 0; top: 0; margin: 0; padding: 0; visibility: visible;"),k.appendChild(e),b.place.parentNode.insertBefore(k,b.place)}else b.place.parentNode.insertBefore(e,b.place);b.insertOptions.noreplace||(b.place.style.display="none")}b.url.width&&(b.url.width=b.url.width.toString(),g=b.url.width.replace(/\d*/gim,""),h=b.url.width.replace(/\D*/gim,""),j.indexOf(g)===-1&&(g="px"),e.style.width=h+g),e.style.height=b.url.height+"px"||""}return mailru.events.listen(mailru.common.events.modalWindow,function(a){mailru.utils.modal.resize(a.wid,a.modalWindowWidth,a.modalWindowHeight)}),d},close:function(a){var b,c=this;void 0!==c.windows[a]&&(c.translayer&&(c.translayer.style.display="none"),document.body.className=document.body.className.replace(" mrc__translayer_on",""),void 0!==a&&void 0!==c.windows[a]&&null!==c.windows[a].parentNode&&(c.windows[a].parentNode.removeChild(c.windows[a]),c.windows[a].modalType&&"modal"===c.windows[a].modalType&&(c.windows.length-=1),delete c.windows[a],b=c.queue.get(),void 0!==b&&c.open(b.url,b.params)))},resize:function(a,b,c){var d;return void 0!==a&&void 0!==mailru.utils.modal.windows[a]&&("modal"===mailru.utils.modal.windows[a].type&&(d=document.body.getAttribute("class"),d&&d.indexOf("mrc__translayer_on")===-1&&document.body.setAttribute("class",d+" mrc__translayer_on"),mailru.utils.modal.translayer.style.display="block"),setTimeout(function(){mailru.utils.modal.windows[a]&&(mailru.utils.modal.windows[a].frameborder="0",b&&"false"!==b&&(mailru.utils.modal.windows[a].style.width=parseInt(b,10)+"px",mailru.utils.modal.windows[a].modalType&&"modal"===mailru.utils.modal.windows[a].modalType&&(mailru.utils.modal.windows[a].style.marginLeft="-"+parseInt(b,10)/2+"px")),c&&(mailru.utils.modal.windows[a].style.height=parseInt(c,10)+"px"),mailru.utils.modal.windows[a].style.borderStyle="none",mailru.isApp||(mailru.utils.modal.windows[a].style.display="block"),"modal"===mailru.utils.modal.windows[a].type&&(mailru.utils.modal.windows[a].style.top=mailru.utils.modal.getScrollTop()+mailru.utils.modal.getWindowSize()/2-c/2+"px",mailru.utils.modal.windows[a].style.visibility="visible"))},5)),!0},getScrollTop:function(){return window.self.pageYOffset||document.documentElement&&document.documentElement.scrollTop||document.body&&document.body.scrollTop},getWindowSize:function(){return"number"==typeof window.innerHeight?window.innerHeight:document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight?document.documentElement.clientHeight:document.body&&(document.body.clientWidth||document.body.clientHeight?document.body.clientHeight:null))},translayer:null,styles:{modal:{height:0,left:"50%",marginLeft:"-10000px",position:"absolute",top:"50%",width:"515px",zIndex:"999999999"}},windows:{length:0},queue:{elements:null,add:function(a,b){this.elements||(this.elements=[]),this.elements.push({url:a,params:b}),this.length=this.elements.length},get:function(){var a;if(this.length)return this.length-=1,a=this.elements[0]||!1,this.elements=this.elements.slice(1),a},length:0}},window:{getBody:function(a){return a||(a=window),a.document.body},getDocumentWidth:function(a){return a||(a=window),mailru.isIE?mailru.utils.window.getBody(a).scrollWidth:mailru.isOpera?a.document.body.style.pixelWidth:a.document.width},getDocumentHeight:function(a){return a||(a=window),mailru.isIE?mailru.utils.window.getBody(a).scrollHeight:mailru.isOpera?a.document.body.style.pixelHeight:a.document.height},getClientWidth:function(){return"CSS1Compat"!==document.compatMode||window.opera?document.body.clientWidth:document.documentElement.clientWidth},getClientHeight:function(){return"CSS1Compat"!==document.compatMode||window.opera?document.body.clientHeight:document.documentElement.clientHeight},getPosition:function(a){function b(a){var b=a.getBoundingClientRect(),c=document.body,d=document.documentElement,e=window.pageYOffset||d.scrollTop||c.scrollTop,f=window.pageXOffset||d.scrollLeft||c.scrollLeft,g=d.clientTop||c.clientTop||0,h=d.clientLeft||c.clientLeft||0,i=b.top+e-g,j=b.left+f-h;return{top:Math.round(i),left:Math.round(j)}}function c(a){for(var b=0,c=0;a;)b+=parseInt(a.offsetTop,10),c+=parseInt(a.offsetLeft,10),a=a.offsetParent;return{top:b,left:c}}return a.getBoundingClientRect?b(a):c(a)}},warn:function(a,b,c){void 0===c&&(c=""),window.console&&(window.console.warn?window.console.warn(f[a],b,c):window.console.log(f[a],b,c))},getFromStorage:function(a){var b=localStorage.getItem("mmapi");return b=b?JSON.parse(b):{},b[a]},setToStorage:function(a,b){var c=localStorage.getItem("mmapi");c=c?JSON.parse(c):{},c[a]=b,localStorage.setItem("mmapi",JSON.stringify(c))},isTrustedHost:function(a){var b,c,d;return"string"==typeof a&&(b=/\.mail\.ru$|\.appsmail\.ru$/gi.test(a),!b&&mailru.domain&&(c=document.createElement("a"),d=document.createElement("a"),c.href=a,d.href=mailru.domain,c.hostname===d.hostname&&(b=!0))),b}},mailru.utils.CryptoJS=function(a){var b,c,d,e,f,g,h,i,j,k={};return k.lib={},c=k.lib,c.Base=function(){function a(){return this}return{extend:function(b){a.prototype=this;var c=new a;return b&&c.mixIn(b),c.hasOwnProperty("init")||(c.init=function(){c.$super.init.apply(this,arguments)}),c.init.prototype=c,c.$super=this,c},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){var b;for(b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),d=c.Base,c.WordArray=d.extend({init:function(a,b){a=this.words=a||[],void 0!==b?this.sigBytes=b:this.sigBytes=4*a.length},toString:function(a){return(a||b).stringify(this)},concat:function(a){var b,c,d=this.words,e=a.words,f=this.sigBytes,g=a.sigBytes;if(this.clamp(),f%4)for(b=0;b<g;b+=1)c=e[b>>>2]>>>24-b%4*8&255,d[f+b>>>2]|=c<<24-(f+b)%4*8;else if(e.length>65535)for(b=0;b<g;b+=4)d[f+b>>>2]=e[b>>>2];else d.push.apply(d,e);return this.sigBytes+=g,this},clamp:function(){var b=this.words,c=this.sigBytes;b[c>>>2]&=4294967295<<32-c%4*8,b.length=a.ceil(c/4)},clone:function(){var a=d.clone.call(this);return a.words=this.words.slice(0),a},random:function(b){var c,d=[];for(c=0;c<b;c+=4)d.push(4294967296*a.random()|0);return new e.init(d,b)}}),e=c.WordArray,k.enc={},f=k.enc,f.Hex={stringify:function(a){var b,c,d=a.words,e=a.sigBytes,f=[];for(b=0;b<e;b+=1)c=d[b>>>2]>>>24-b%4*8&255,f.push((c>>>4).toString(16)),f.push((15&c).toString(16));return f.join("")},parse:function(a){var b,c=a.length,d=[];for(b=0;b<c;b+=2)d[b>>>3]|=parseInt(a.substr(b,2),16)<<24-b%8*4;return new e.init(d,c/2)}},b=f.Hex,f.Latin1={stringify:function(a){var b,c,d=a.words,e=a.sigBytes,f=[];for(b=0;b<e;b+=1)c=d[b>>>2]>>>24-b%4*8&255,f.push(String.fromCharCode(c));return f.join("")},parse:function(a){var b,c=a.length,d=[];for(b=0;b<c;b+=1)d[b>>>2]|=(255&a.charCodeAt(b))<<24-b%4*8;return new e.init(d,c)}},g=f.Latin1,f.Utf8={stringify:function(a){try{return decodeURIComponent(window.escape(g.stringify(a)))}catch(a){throw new Error("Malformed UTF-8 data")}},parse:function(a){return g.parse(window.unescape(encodeURIComponent(a)))}},h=f.Utf8,c.BufferedBlockAlgorithm=d.extend({reset:function(){this._data=new e.init,this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=h.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(b){var c=this._data,d=c.words,f=c.sigBytes,g=this.blockSize,h=4*g,i=f/h;i=b?a.ceil(i):a.max((0|i)-this._minBufferSize,0);var j,k,l=i*g,m=a.min(4*l,f);if(l){for(j=0;j<l;j+=g)this._doProcessBlock(d,j);k=d.splice(0,l),c.sigBytes-=m}return new e.init(k,m)},clone:function(){var a=d.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0}),i=c.BufferedBlockAlgorithm,c.Hasher=i.extend({cfg:d.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){i.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){a&&this._append(a);var b=this._doFinalize();return b},blockSize:16,_createHelper:function(a){return function(b,c){return new a.init(c).finalize(b)}},_createHmacHelper:function(a){return function(b,c){return new j.HMAC.init(a,c).finalize(b)}}}),k.algo={},j=k.algo,k}(Math),function(a){function b(a,b,c,d,e,f,g){var h=a+(b&c|~b&d)+e+g;return(h<<f|h>>>32-f)+b}function c(a,b,c,d,e,f,g){var h=a+(b&d|c&~d)+e+g;return(h<<f|h>>>32-f)+b}function d(a,b,c,d,e,f,g){var h=a+(b^c^d)+e+g;return(h<<f|h>>>32-f)+b}function e(a,b,c,d,e,f,g){var h=a+(c^(b|~d))+e+g;return(h<<f|h>>>32-f)+b}var f=mailru.utils.CryptoJS,g=f.lib,h=g.WordArray,i=g.Hasher,j=f.algo,k=[];!function(){var b;for(b=0;b<64;b+=1)k[b]=4294967296*a.abs(a.sin(b+1))|0}(),j.MD5=i.extend({_doReset:function(){this._hash=new h.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(a,f){var g,h,i,j,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E;for(g=0;g<16;g+=1)h=f+g,i=a[h],a[h]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8);j=this._hash.words,l=a[f],m=a[f+1],n=a[f+2],o=a[f+3],p=a[f+4],q=a[f+5],r=a[f+6],s=a[f+7],t=a[f+8],u=a[f+9],v=a[f+10],w=a[f+11],x=a[f+12],y=a[f+13],z=a[f+14],A=a[f+15],B=j[0],C=j[1],D=j[2],E=j[3],B=b(B,C,D,E,l,7,k[0]),E=b(E,B,C,D,m,12,k[1]),D=b(D,E,B,C,n,17,k[2]),C=b(C,D,E,B,o,22,k[3]),B=b(B,C,D,E,p,7,k[4]),E=b(E,B,C,D,q,12,k[5]),D=b(D,E,B,C,r,17,k[6]),C=b(C,D,E,B,s,22,k[7]),B=b(B,C,D,E,t,7,k[8]),E=b(E,B,C,D,u,12,k[9]),D=b(D,E,B,C,v,17,k[10]),C=b(C,D,E,B,w,22,k[11]),B=b(B,C,D,E,x,7,k[12]),E=b(E,B,C,D,y,12,k[13]),D=b(D,E,B,C,z,17,k[14]),C=b(C,D,E,B,A,22,k[15]),B=c(B,C,D,E,m,5,k[16]),E=c(E,B,C,D,r,9,k[17]),D=c(D,E,B,C,w,14,k[18]),C=c(C,D,E,B,l,20,k[19]),B=c(B,C,D,E,q,5,k[20]),E=c(E,B,C,D,v,9,k[21]),D=c(D,E,B,C,A,14,k[22]),C=c(C,D,E,B,p,20,k[23]),B=c(B,C,D,E,u,5,k[24]),E=c(E,B,C,D,z,9,k[25]),D=c(D,E,B,C,o,14,k[26]),C=c(C,D,E,B,t,20,k[27]),B=c(B,C,D,E,y,5,k[28]),E=c(E,B,C,D,n,9,k[29]),D=c(D,E,B,C,s,14,k[30]),C=c(C,D,E,B,x,20,k[31]),B=d(B,C,D,E,q,4,k[32]),E=d(E,B,C,D,t,11,k[33]),D=d(D,E,B,C,w,16,k[34]),C=d(C,D,E,B,z,23,k[35]),B=d(B,C,D,E,m,4,k[36]),E=d(E,B,C,D,p,11,k[37]),D=d(D,E,B,C,s,16,k[38]),C=d(C,D,E,B,v,23,k[39]),B=d(B,C,D,E,y,4,k[40]),E=d(E,B,C,D,l,11,k[41]),D=d(D,E,B,C,o,16,k[42]),C=d(C,D,E,B,r,23,k[43]),B=d(B,C,D,E,u,4,k[44]),E=d(E,B,C,D,x,11,k[45]),D=d(D,E,B,C,A,16,k[46]),C=d(C,D,E,B,n,23,k[47]),B=e(B,C,D,E,l,6,k[48]),E=e(E,B,C,D,s,10,k[49]),D=e(D,E,B,C,z,15,k[50]),C=e(C,D,E,B,q,21,k[51]),B=e(B,C,D,E,x,6,k[52]),E=e(E,B,C,D,o,10,k[53]),D=e(D,E,B,C,v,15,k[54]),C=e(C,D,E,B,m,21,k[55]),B=e(B,C,D,E,t,6,k[56]),E=e(E,B,C,D,A,10,k[57]),D=e(D,E,B,C,r,15,k[58]),C=e(C,D,E,B,y,21,k[59]),B=e(B,C,D,E,p,6,k[60]),E=e(E,B,C,D,w,10,k[61]),D=e(D,E,B,C,n,15,k[62]),C=e(C,D,E,B,u,21,k[63]),j[0]=j[0]+B|0,j[1]=j[1]+C|0,j[2]=j[2]+D|0,j[3]=j[3]+E|0},_doFinalize:function(){var b=this._data,c=b.words,d=8*this._nDataBytes,e=8*b.sigBytes;c[e>>>5]|=128<<24-e%32;var f,g,h,i,j=a.floor(d/4294967296),k=d;for(c[(e+64>>>9<<4)+15]=16711935&(j<<8|j>>>24)|4278255360&(j<<24|j>>>8),c[(e+64>>>9<<4)+14]=16711935&(k<<8|k>>>24)|4278255360&(k<<24|k>>>8),b.sigBytes=4*(c.length+1),this._process(),f=this._hash,g=f.words,h=0;h<4;h+=1)i=g[h],g[h]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8);return f},clone:function(){var a=i.clone.call(this);return a._hash=this._hash.clone(),a}});var l=j.MD5;f.MD5=i._createHelper(l),f.HmacMD5=i._createHmacHelper(l)}(Math),mailru.intercom={chunkBuff:[],chunkLen:0,chunkTimeout:null,chunkFinished:function(){},init:function(a){this.wrp=this[mailru.intercomType],this.wrp.init(a)},receiver:function(a){a=mailru.utils.parseGet(a),a.result&&(+a.rt?a.res_hash=mailru.utils.parseGet(a.result):a.res_hash=mailru.utils.fromJSON(a.result)),a.res_hash=a.res_hash||{},a.res_hash.error&&"102"===a.res_hash.error.error_code.toString()&&mailru.session&&mailru.events.notify(mailru.connect.events.logout),a.event?mailru.events.notify(a.event,a.res_hash,a.result):a.cbid&&mailru.callbacks[a.cbid]&&(a.chunk?(this.chunkBuff.length||(this.chunkLen=a.len,this.chunkFinished=function(a){return function(){mailru.callbacks.hasOwnProperty(a)&&mailru.callbacks[a]({result:mailru.intercom.chunkBuff.join("")}),mailru.intercom.chunkBuff=[],mailru.intercom.chunkLen=0,mailru.intercom.chunkFinished=function(){}}}(a.cbid)),window.clearTimeout(this.chunkTimeout),this.chunkTimeout=window.setTimeout(this.chunkFinished,3e3),this.chunkBuff[+a.index]=a.res_hash.result,this.chunkLen-=1,this.chunkLen||(window.clearTimeout(this.chunkTimeout),this.chunkFinished())):mailru.callbacks.hasOwnProperty(a.cbid)&&mailru.callbacks[a.cbid](a.res_hash,a.result))},makeRequest:function(a,b,c){return b=b||{},b.method=a,b.resource="app",c&&(b.cbid=mailru.callbacks.add(c)),b},wrp:{init:function(){},request:function(a,b,c){}},hash:{init:function(){mailru.utils.addHandler(window,"message",function(a){mailru.intercom.receiver(a.data)})},request:function(a,b,c){b=mailru.intercom.makeRequest(a,b,c),mailru.utils.requestOverProxy(b,mailru.def.PROXY_URL)}},event:{init:function(){mailru.utils.addHandler(window,"message",function(a){mailru.utils.isTrustedHost(a.origin)&&mailru.intercom.receiver(a.data)})},request:function(a,b,c){b=mailru.intercom.makeRequest(a,b,c),mailru.isIE&&"showStreamPublish"===b.method&&mailru.utils.makeGet(b).length>2500&&(b.posttitle.length>80&&(b.posttitle=b.posttitle.substring(0,80)+"..."),b.apptext.length>200&&(b.apptext=b.apptext.substring(0,200)+"...")),parent.postMessage(mailru.utils.makeGet(b),"*")}}},mailru.callbacks={add:function(a){var b=mailru.utils.uniqid();return mailru.callbacks[b]=function(){delete mailru.callbacks[b],a&&a.apply(window,arguments)},b}},mailru.events={listeners:{},hidHash:{},listen:function(a,b){var c,d;return a=mailru.events.alias[a]||a,this.listeners[a]=this.listeners[a]||{index:-1,list:{}},this.listeners[a].index+=1,c=this.listeners[a].index,this.listeners[a].list[c]=b,d=mailru.utils.uniqid(),this.hidHash[d]=[a,c],d},remove:function(a){this.hidHash[a]&&delete this.listeners[this.hidHash[a][0]].list[this.hidHash[a][1]]},notify:function(a){var b;"event"!==a&&(b=mailru.utils.toArray(arguments),b.unshift("event"),this.notify.apply(this,b)),b=mailru.utils.toArray(arguments).splice(1,arguments.length),this.listeners[a]&&this.listeners[a].index!==-1&&mailru.utils.foreach(this.listeners[a].list,function(a){a.apply(window,b)})},alias:{"stream.post":"common.streamPublish","mailru.common.events.streamPublish":"common.streamPublish","message.post":"common.sendMessage","guestbook.post":"common.guestbookPublish","mailru.common.events.guestbookPublish":"common.guestbookPublish","common.upload":mailru.isApp?"common.upload":"common.uploadPhoto","mailru.common.events.upload":"common.upload","mailru.common.events.uploadAvatar":"common.uploadAvatar","mailru.app.events.friendsInvitation":"common.friendsInvitation","mailru.app.events.friendsRequest":"common.friendsRequest","mailru.common.events.createAlbum":"common.createAlbum","mailru.common.events.friends.add":"common.friends.add","mailru.common.events.gift.send":"common.gift.send","mailru.app.events.incomingPayment":"app.incomingPayment","mailru.app.events.paymentDialogStatus":"app.paymentDialogStatus","mailru.app.events.hash.read":"app.hash.read","mailru.app.events.scrollTo":"app.scrollY"}},mailru.common={email:{getUnreadCount:function(a){mailru.batcher.reqest("email.getUnreadCount",{uid:mailru.session.vid||""},a)}},messages:{getUnreadCount:function(a){mailru.batcher.reqest("messages.getUnreadCount",{},a)},getThreadsList:function(a,b){b=b||{},mailru.batcher.reqest("messages.getThreadsList",{offset:b.offset||0,limit:b.limit||10},a)},getThread:function(a,b,c){c=c||{},mailru.batcher.reqest("messages.getThread",{uid:b||mailru.session.vid||"",offset:c.offset||0,limit:c.limit||10},a)},send:function(a,b){if("function"==typeof a&&(a=b),!a.uid)throw new Error("No recipient UID");a.app_id=mailru.app_id,a.method="jsapi.popup",a.session_key=mailru.session.session_key,a.template="messages.send",a.vid=mailru.session.vid,mailru.isApp?mailru.intercom.wrp.request("showJSAPIDialog",mailru.utils.sign(a)):(a.id="messages-send",a.jsapi="external",mailru.utils.modal.open(mailru.def.API_URL,{id:a.id,type:"modal",url:a},!0))}},users:{requirePermissions:function(a,b){"function"==typeof a&&(a=b),mailru.common.users.requirePermission(a)},requirePermission:function(a,b){"function"==typeof a&&(a=b),mailru.events.notify(mailru.common.events.permissionsChange,{status:"closed"})},getInfo:function(a,b){"string"!=typeof b&&"number"!=typeof b||(b=arguments.length>2?arguments.splice(3,arguments.length):[b]),void 0!==b&&0!==b.length||(b=[mailru.session.vid]),mailru.batcher.reqest("users.getInfo",{uids:b.join(",")},a)},getPermissions:function(){},hasAppPermission:function(a,b,c){mailru.batcher.reqest("users.hasAppPermission",{uid:c||mailru.session.vid||"",ext_perm:b},a)},getBalance:function(a,b){mailru.batcher.reqest("users.getBalance",{uid:b||mailru.session.vid},a)}},stream:{publish:function(a,b){mailru.utils.warn("unsupported","stream.publish()","Use stream.post()"),this.post(a,b)},post:function(a,b){var c,d,e;if("function"==typeof a&&(a=b),c={app_id:mailru.app_id,img_url:a.img_url||a.imgURL||"",method:"jsapi.popup",template:"stream.post",title:a.title||"",text:a.text||"",session_key:mailru.session.session_key,vid:mailru.session.vid},d=a.action_links||a.actionLinks||!1)for(e=1;e<=d.length;e+=1)c["link"+e+"_text"]=d[e-1].text,c["link"+e+"_href"]=d[e-1].href;mailru.isApp?mailru.intercom.wrp.request("showJSAPIDialog",mailru.utils.sign(c)):(c.id="stream-publish",c.jsapi="external",mailru.utils.modal.open(mailru.def.API_URL,{id:c.id,type:"modal",url:c},!0))},get:function(a,b){b=b||{},mailru.batcher.reqest("stream.get",{offset:b.offset||0,limit:b.limit||10,filter_app:b.filter_app||""},a)},getByAuthor:function(a,b,c){c=c||{},mailru.batcher.reqest("stream.getByAuthor",{uid:b||mailru.session.vid,offset:c.offset||0,limit:c.limit||10,filter_app:c.filter_app||""},a)}},guestbook:{publish:function(a,b){mailru.utils.warn("unsupported","guestbook.publish()","Use guestbook.post()"),this.post(a,b)},post:function(a,b){var c,d,e;if("function"==typeof a&&(a=b),c={app_id:mailru.app_id,img_url:a.img_url||a.imgURL||"",method:"jsapi.popup",template:"guestbook.post",title:a.title||"",text:a.text||a.description||!1,session_key:mailru.session.session_key,vid:mailru.session.vid},a.uid?c.uid=a.uid:c.uid=mailru.session.vid,!c.text)throw new Error("Missing required params: text");if(d=a.action_links||a.actionLinks||!1)for(e=1;e<=d.length;e+=1)c["link"+e+"_text"]=d[e-1].text,c["link"+e+"_href"]=d[e-1].href;mailru.isApp?mailru.intercom.wrp.request("showJSAPIDialog",mailru.utils.sign(c)):(c.id="guestbook-publish",c.jsapi="external",mailru.utils.modal.open(mailru.def.API_URL,{id:c.id,type:"modal",url:c},!0))},get:function(a,b,c){c=c||{},mailru.batcher.reqest("guestbook.get",{uid:b||mailru.session.vid||"",
offset:c.offset||0,limit:c.limit||10},a)}},photos:{getAlbums:function(a,b){mailru.batcher.reqest("photos.getAlbums",{uid:b||mailru.session.vid||""},a)},get:function(a,b,c,d,e){mailru.batcher.reqest("photos.get",{pids:c||"",aid:b,offset:d||0,limit:e||0},a)},createAlbum:function(a,b){var c;"function"==typeof a&&(a=b),a||(a={}),c={app_id:mailru.app_id,method:"jsapi.popup",jp_name:a.name||"Без названия",session_key:mailru.session.session_key,template:"photos.createAlbum",vid:mailru.session.vid},a.description&&(c.jp_description=a.description),mailru.isApp?mailru.intercom.wrp.request("showJSAPIDialog",mailru.utils.sign(c)):(c.id="create-album",c.jsapi="external",mailru.utils.modal.open(mailru.def.API_URL,{id:c.id,type:"modal",url:c},!0))},upload:function(a,b){var c;"function"==typeof a&&(a=b),c={jp_aid:a.aid||"_myphoto",app_id:mailru.app_id,img_url:a.img||a.url,jp_cover:a.set_as_cover||0,jp_description:a.description||"",jp_name:a.name||"",jp_theme:a.theme||"",method:"jsapi.popup",session_key:mailru.session.session_key,template:"photos.upload",vid:mailru.session.vid},mailru.isApp?mailru.intercom.wrp.request("showJSAPIDialog",mailru.utils.sign(c)):(c.id="upload-photo",c.jsapi="external",mailru.utils.modal.open(mailru.def.API_URL,{id:c.id,type:"modal",url:c},!0))},uploadAvatar:function(a,b){var c;if("function"==typeof a&&(a=b),c={app_id:mailru.app_id,method:"jsapi.popup",session_key:mailru.session.session_key,template:"photos.uploadAvatar",vid:mailru.session.vid},void 0!==a.url)c.img_url=a.url;else{if(void 0===a.pid)throw new Error('Missing required params: "url" or "pid"');c.jp_pid=a.pid}mailru.isApp?mailru.intercom.wrp.request("showJSAPIDialog",mailru.utils.sign(c)):(c.id="set-avatar",c.jsapi="external",mailru.utils.modal.open(mailru.def.API_URL,{id:c.id,type:"modal",url:c},!0))}},audio:{search:function(a,b,c,d){if(void 0===b)throw new Error("audio search failed:\nno QUERY");mailru.batcher.reqest("audio.search",{query:b,offset:c||0,limit:d||10},a)},link:function(a,b){if(void 0===b)throw new Error("get audio link failed:\nno MID");mailru.batcher.reqest("audio.link",{mid:b},a)},get:function(a,b,c){mailru.batcher.reqest("audio.get",{uid:b||mailru.session.vid||"",mid:c||""},a)}},friends:{add:function(a,c){var d;"function"==typeof a&&(a=c),d={uid:a,app_id:mailru.app_id,method:"jsapi.popup",vid:mailru.session.vid,session_key:mailru.session.session_key,template:"friends.add"},mailru.isApp?mailru.intercom.wrp.request("showJSAPIDialog",mailru.utils.sign(b(d))):(d.id="add-friend",d.jsapi="external",mailru.utils.modal.open(mailru.def.API_URL,{id:d.id,type:"modal",url:b(d)},!0))},getFiltered:function(a,b,c){mailru.batcher.reqest("friends.get",{uid:b||mailru.session.vid||"",offset:c||0},a)},getExtended:function(a,b,c){mailru.batcher.reqest("friends.get",{uid2:b||mailru.session.vid||"",ext:1,offset:c||0},a)},getAppUsers:function(a,b,c,d,e){mailru.batcher.reqest("friends.getAppUsers",{uid:c||mailru.session.vid||"",ext:b?1:0,offset:d||0,v:e?1:0},a)},getInvitationsCount:function(a){mailru.batcher.reqest("friends.getInvitationsCount",{uid:mailru.session.vid||""},a)}},payments:{showDialog:function(c,d){if("function"==typeof c&&(c=d),c.app_id=mailru.app_id,c.session_key=mailru.session.session_key,c.f=1,mailru.isApp)mailru.intercom.wrp.request("showPaymentDialog",b(c));else{if(c.window_id=mailru.window_id,c.mailiki_price*=100,c.url=c,c.type="modal",c.style={width:"605px"},!mailru.session)throw new Error("No user session");mailru.connect.activePaymentWindow=mailru.utils.modal.open(a("payment_dialog"),c)}}},gift:{send:function(c,d,e){if(void 0===c)throw new Error("No gift id");"[object Array]"!==Object.prototype.toString.call(e)&&(e=[e]);var f={};f.app_id=mailru.app_id,mailru.isApp?(f.gift_id=c,f.text=d||"",f.friend_id=e.join(","),mailru.intercom.wrp.request("showGiftSendDialog",b(f))):(f.url={interface:"gift.send",gift_id:c,text:d||"",friend_id:e.join(",")},f.type="modal",f.style={width:"675px"},mailru.utils.modal.open(a("friends_select"),f))}},events:{permissionChanged:"common.permissionChanged",permissionsChange:"common.permissionChanged",friendsInvitation:"common.friendsInvitation",friends:{add:"common.friends.add"},friendsAdd:"common.friends.add",message:{send:"common.sendMessage"},streamPublish:"common.streamPublish",modalWindow:"common.modalWindow",requireWidgetPermissions:"common.requireWidgetPermissions",createAlbum:"common.createAlbum",upload:"common.upload",uploadAvatar:"common.uploadAvatar",guestbookPublish:"common.guestbookPublish",transportReady:"common.transportReady",gift:{send:"common.gift.send"},paymentDialogStatus:"common.paymentDialogStatus"}},mailru.app={init:function(a){var b,d;if(mailru.isApp=!0,mailru.inited||c(),a&&(mailru.private_key=a),d=(document.URL.match(/\?(.*)/)||[0,""])[1],b=mailru.utils.parseGet(d),b.app_id&&b.session_key||(d=mailru.utils.getCookie(mailru.def.CONNECT_COOKIE)||"",""===d&&(d=mailru.utils.parseGet(window.name).cookie),b=mailru.utils.parseGet(d)),!b.app_id)throw new Error("API INIT FAILED:\nno APP ID");if(!b.session_key)throw new Error("API INIT FAILED:\nno No SESSION KEY");mailru.app_id=b.app_id,mailru.app.dispatchSession(b,d),mailru.utils.extend(mailru.app,mailru.common)},users:{requireInstallation:function(a){mailru.events.notify(mailru.app.events.applicationInstallation,{status:"success"})},isAppUser:function(a,b){mailru.batcher.reqest("users.isAppUser",{uid:b||mailru.session.vid||""},a)},review:function(){mailru.intercom.wrp.request("showReviewDialog",{app_id:mailru.app_id})},events:{getNewCount:function(a,b){mailru.batcher.reqest("events.getNewCount",{uid:b||mailru.session.vid||""},a)}}},widget:{set:function(){return mailru.events.notify(mailru.app.events.widget.set,{status:"closed"}),!1}},friends:{invite:function(a,b){var c={app_id:mailru.app_id,method:"jsapi.popup",session_key:mailru.session.session_key,target:"web",template:"friends.invite",vid:mailru.session.vid},d=mailru.loader.getEnv();"function"==typeof a?a=b||{}:void 0===a&&(a={}),a.target&&(c.target=a.target),""!==d.branch?c.__branch=d.branch:d.prerelease&&(c.__prerelease=d.prerelease),mailru.intercom.wrp.request("showJSAPIDialog",mailru.utils.sign(c))},request:function(a,b){var c,d,e=mailru.loader.getEnv(),f=/^[\da-z+\/=]+$/i;if("function"==typeof a&&(a=b||{}),""!==e.branch&&(a.__branch=e.branch),a.image_url&&(a.img_url||(a.img_url=a.image_url),delete a.image_url),!a.text||!a.img_url)throw new Error("Missing required params: "+(a.text?"":"text\n")+(a.img_url?"":"img_url\n"));a.text.length>100&&(a.text=a.text.slice(0,100)),a.img_url.length>200&&delete a.img_url,a.hash&&(a.hash.length>48||!f.test(a.hash))&&delete a.hash,a.friends&&(a.uids=a.friends,delete a.friends),c={app_id:mailru.app_id,method:"jsapi.popup",session_key:mailru.session.session_key,target:"web",template:"friends.request",vid:mailru.session.vid};for(d in a)a.hasOwnProperty(d)&&(c[d]=a[d]);mailru.intercom.wrp.request("showJSAPIDialog",mailru.utils.sign(c))}},payments:{showDialog:function(a,b){"function"==typeof a&&(a=b),mailru.common.payments.showDialog.call(mailru,a)},openDialog:function(a,b){"function"==typeof a&&(a=b),mailru.common.payments.showDialog.call(mailru,a)}},setLocation:function(){},getLocation:function(){},resizeWindow:function(){},scrollWindow:function(){},setTitle:function(a,b){"function"==typeof a&&(a=b),mailru.app.utils.setTitle(a)},utils:{getScrollY:function(a){"use strict";mailru.intercom.wrp.request("scrollTo")},setScrollY:function(a,b){"use strict";"function"==typeof a?a.scroll=b:void 0!==window.scroll&&(a.scroll=window.scroll),mailru.intercom.wrp.request("scrollTo",a)},setTitle:function(a,b){"function"==typeof a&&(a=b),null!==a&&"undefined"!==a&&mailru.intercom.wrp.request("setTitle",{app_id:mailru.app_id,title:a})},setHeight:function(a,b){"function"==typeof a&&(a=b),a&&mailru.intercom.wrp.request("setIframeHeight",{app_id:mailru.app_id,height:a})},hash:{write:function(a,b){var c;return"function"==typeof a&&(a=b),void 0!==a&&(c="string"==typeof a?a:mailru.utils.makeGet(a),void mailru.intercom.wrp.request("writeHash",{hash:c}))},read:function(){var a=mailru.utils.parseGet(window.name),b=decodeURIComponent(a.fast_hash);"undefined"!==b?(mailru.app.utils.hash.fastHash=b,delete a.fast_hash,window.name=mailru.utils.makeGet(a),mailru.app.utils.hash.initRead()):(mailru.app.utils.hash.initRead(),mailru.intercom.wrp.request("readHash"))},initRead:function(){function a(a){var b;b="string"==typeof a?a:a.hash?a.hash:"",b=mailru.utils.parseGet(b),mailru.events.notify("app.hash.read",b),mailru.events.notify("app.readHash",b)}return!(mailru.app.utils.hash.inited&&!mailru.app.utils.hash.fastHash)&&(mailru.app.utils.hash.fastHash&&(a(mailru.app.utils.hash.fastHash),mailru.app.utils.hash.fastHash=!1),mailru.events.listen(mailru.app.events.appReadHash,function(b){a(b)}),void(mailru.app.utils.hash.inited=!0))},inited:!1,fastHash:!1},scrollTo:function(a,b){var c={};"function"==typeof a?c.scroll=b:void 0!==a&&(c.scroll=a),mailru.intercom.wrp.request("scrollTo",c)}},events:{windowBlur:"app.windowBlur",windowFocus:"app.windowFocus",locationChange:"app.locationChange",windowResize:"app.windowResize",applicationInstallation:"app.applicationInstallation",friendsInvitation:"app.friendsInvitation",friendsRequest:"app.friendsRequest",applicationSettingsStatus:"app.settings",applicationReviewStatus:"app.review",incomingPayment:"app.incomingPayment",requireInstallation:"app.requireInstallation",appReadHash:"app.appReadHash",readHash:"app.readHash",scrollTo:"app.scrollTo",hash:{read:"app.hash.read"},like:"app.like",widget:{set:"app.widget.set"},paymentDialogStatus:"app.paymentDialogStatus"},getLoginStatus:function(a){mailru.utils.requestOverProxy({resource:"getLoginStatus",app_id:mailru.app_id,cbid:mailru.callbacks.add(function(b,c){mailru.app.dispatchSession(b,c),a&&a(b,c)})})},getRightSessionExp:function(a){return 1e3*parseInt(a,10)-Date.now()},dispatchSession:function(a,b){a.session_expire||(a.session_expire=a.exp||(mailru.def.SESSION_REFRESH_EVERY+Date.now())/1e3),mailru.session=a,mailru.app.prolongSession(mailru.app.getRightSessionExp(a.session_expire));var c=mailru.utils.parseGet(window.name);c.cookie=b,window.name=mailru.utils.makeGet(c),mailru.utils.setCookie({name:mailru.def.CONNECT_COOKIE,value:b})},clearSession:function(){mailru.session=!1,window.clearTimeout(mailru.app.prolongSessionTmr)},prolongSessionTmr:null,prolongSession:function(a){window.clearTimeout(mailru.app.prolongSessionTmr),mailru.app.prolongSessionTmr=window.setTimeout(function(){mailru.app.getLoginStatus()},a)}},mailru.connect={appAutoInstall:function(a,b,c,d){mailru.utils.requestOverProxy({resource:"app.auto_install",app_id:a,cbid:mailru.callbacks.add(function(a){a.length>1&&"string"!=typeof a[2]&&void 0!==a[2].success?(c={app_id:c.app_id,exp:a[2].exp,ext_perm:"notifications",is_app_user:1,oid:a[2].vid,session_key:a[2].session_key,ss:a[2].ss,state:"",vid:a[2].vid,sig:a[2].sig,window_id:c.window_id},d=mailru.utils.makeGet(c),mailru.connect.dispatchSession(c,d),"function"==typeof b&&b(c,d)):"function"==typeof b&&b(c,d)})})},init:function(a,b,d){function e(a){void 0!==a&&a.wid&&"undefined"!==a.wid&&"opened"!==a.wid&&mailru.utils.modal.close(a.wid)}function f(a){void 0!==a&&a.wid&&"undefined"!==a.wid&&"opened"!==a.status&&mailru.utils.modal.close(a.wid)}if(!a)throw new Error("API INIT FAILED:\nno APP ID");if(!b)throw new Error("API INIT FAILED:\nno PRIVATE KEY");mailru.isGame=d||!1,a&&(mailru.app_id=a),mailru.partner_id=mailru.utils.getCookie(mailru.def.PARTNER_ID_COOKIE),mailru.inited||c(1),mailru.utils.extend(mailru.connect,mailru.common),b&&(mailru.private_key=b),mailru.events.listen(mailru.connect.events.loginOAuth,mailru.connect.dispatchSession),mailru.events.listen(mailru.connect.events.logout,mailru.connect.clearSession),mailru.events.listen(mailru.connect.events.loginFail,mailru.connect.loginFail),mailru.connect.getLoginStatus(),mailru.events.listen(mailru.common.events.streamPublish,e),mailru.events.listen(mailru.common.events.guestbookPublish,e),mailru.events.listen(mailru.common.events.upload,e),mailru.events.listen(mailru.common.events.uploadAvatar,e),mailru.events.listen(mailru.common.events.permissionChanged,e),mailru.events.listen(mailru.common.events.createAlbum,e),mailru.events.listen(mailru.common.events.message.send,e),mailru.events.listen(mailru.common.events.paymentDialogStatus,f),mailru.events.listen(mailru.common.events.gift.send,f),mailru.events.listen(mailru.common.events.friends.add,e),mailru.events.listen(mailru.app.events.incomingPayment,function(){setTimeout(function(){mailru.utils.modal.close(mailru.connect.activePaymentWindow)},3e3)})},initButton:function(){function a(a){return mailru.connect.login(),!1}var b=document.getElementsByTagName("a"),c=b.length,d=0,e=null;for(0;d<c;d+=1)b[d].className.indexOf("mrc__connectButton")!==-1&&(e=b[d],e.innerHTML="",e.style.background="url("+mailru.def.CONNECT_BUTTON_BG_URL+") no-repeat",e.style.display="inline-block",e.style.width="115px",e.style.height="18px",e.href="#r",e.onclick=a)},login:function(a){var b,c,d;if(mailru.session&&mailru.session.is_app_user)mailru.events.notify(mailru.connect.events.login,mailru.session,mailru.utils.getCookie(mailru.def.CONNECT_COOKIE));else{b={app_id:mailru.app_id,host:"http://"+mailru.def.DOMAIN},a=a||"";try{a=a.join().match(/\w*/g).join(" ")}catch(b){a=a.match(/\w*/g).join(" ")}if(c=mailru.def.CONNECT_OAUTH+"client_id="+mailru.app_id+"&response_type=token&display=popup&redirect_uri="+encodeURIComponent(mailru.def.PROXY_URL+"app_id="+mailru.app_id+"&login=1"+(b.fcid?"&fcid="+b.fcid:"")+(b.host?"&host="+b.host:""))+"&"+mailru.utils.makeGet(b)+"&"+mailru.utils.makeGet({scope:a})+(mailru.partner_id?"&site_id="+encodeURIComponent(mailru.partner_id):"")+(mailru.isGame?"&game=1":""),d=window.open(c,"mrc_login","width=445, height=400, status=0, scrollbars=0, menubar=0, toolbar=0, resizable=1"),mailru.isOpera)window.onfocus=function(){mailru.session.login||(window.onfocus=null,mailru.events.notify(mailru.connect.events.loginFail))};else if(void 0!==d&&null!==d)var e=setInterval(function(){d.closed&&clearInterval(e)},500);else mailru.session.login||mailru.events.notify(mailru.connect.events.loginFail)}},logout:function(){mailru.utils.apiOverJSONP(mailru.utils.sign({cb:"mailru.callbacks["+mailru.callbacks.add(function(a){a.result&&mailru.events.notify(mailru.connect.events.logout)})+"]",app_id:mailru.app_id}),mailru.def.CONNECT_LOGOUT_URL)},loginFail:function(){},getLoginStatus:function(a){mailru.utils.requestOverProxy({resource:"getLoginStatus",app_id:mailru.app_id,cbid:mailru.callbacks.add(function(b,c){var d=mailru.utils.parseGet(c);void 0!==d.connectPartner&&d.connectPartner>0&&void 0!==a?mailru.connect.appAutoInstall(mailru.app_id,a,b,c):(mailru.connect.dispatchSession(b,c),"function"==typeof a&&a(b,c))})})},events:{login:"connect.login",loginOAuth:"connect.loginOAuth",logout:"connect.logout",loginFail:"connect.loginFail"},dispatchSession:function(a,b,c){return a.access_token?(mailru.connect.getLoginStatus(function(){mailru.events.notify(mailru.connect.events.login,mailru.session,mailru.utils.getCookie(mailru.def.CONNECT_COOKIE))}),!1):(mailru.session=a,"0"!==a.is_app_user.toString()||c?mailru.connect.prolongSession(a):mailru.connect.clearSession(),void mailru.utils.setCookie({name:mailru.def.CONNECT_COOKIE,value:b}))},clearSession:function(){mailru.session=!1,window.clearTimeout(mailru.connect.prolongSessionTmr),mailru.utils.setCookie({name:mailru.def.CONNECT_COOKIE,expires:-1,value:""})},prolongSessionTmr:null,prolongSession:function(a){window.clearTimeout(mailru.connect.prolongSessionTmr),mailru.connect.prolongSessionTmr=window.setTimeout(function(){mailru.connect.getLoginStatus()},mailru.def.SESSION_REFRESH_EVERY)}},mailru.plugin={inited:!1,elements:{},init:function(){return mailru.inited||c(1),mailru.plugin.inited||(mailru.events.listen(mailru.plugin.events.closeLikeComment,function(a){a.share?mailru.utils.modal.close(mailru.plugin.like.buttonsWithComment[a.wid]):mailru.utils.modal.close(a.wid)}),mailru.events.listen(mailru.plugin.events.unliked,function(a){mailru.plugin.like.closeAllComments()}),mailru.events.listen(mailru.plugin.events.liked,function(a){mailru.plugin.like.closeAllComments(function(){a.noComment||mailru.plugin.like.Comment(a)})}),mailru.events.listen(mailru.plugin.events.like.rlOK,function(a){mailru.plugin.like.closeAllComments(function(){mailru.plugin.like.Comment(a)})}),mailru.events.listen(mailru.plugin.events.like.rl,function(a){mailru.plugin.like.rl(a)}),mailru.events.listen(mailru.plugin.events.errorMessage,function(a){mailru.plugin.like.closeAllComments(function(){mailru.plugin.like.errorMessage(a.wid,a.errorType)})}),mailru.utils.addHandler(document.body,"click",function(a){var b,c;a=a||window.event,b=a.target||a.srcElement;for(c in mailru.plugin.like.buttonsWithComment)mailru.plugin.like.buttonsWithComment.hasOwnProperty(c)&&b.id!==mailru.plugin.like.buttonsWithComment[c]&&mailru.utils.modal.close(mailru.plugin.like.buttonsWithComment[c])}),mailru.events.listen(mailru.plugin.events.email.redirect,function(a){mailru.plugin.email.redirectTo(a.url)}),mailru.plugin.inited=!0),mailru.isIE&&mailru.isIE<11?(document.attachEvent&&!function(){try{document.documentElement.doScroll("left")}catch(a){return void setTimeout(mailru.plugin.init,0)}mailru.plugin.find()}(),!1):void mailru.plugin.find()},find:function(){var a,b=document.getElementsByTagName("a"),c=b.length,d=null;for(a=0;a<c;a+=1)if(void 0!==b[a]&&b[a].className.indexOf("mrc__plugin")!==-1&&!b[a].processed){if(d=b[a],d.type=d.className.match(/^[mrc__Plugin_]\w*/gim)[0],d.type=null!==d.type?d.type.replace("mrc__plugin_",""):null,d.params=!1,d.getAttribute("data-mrc-config"))try{d.params=0!==d.getAttribute("data-mrc-config").length&&JSON.parse(d.getAttribute("data-mrc-config").replace(new RegExp("\\n","g"),"").replace(/'/g,'"'))}catch(a){d.params=!1}if(!d.params)try{d.params=0!==d.rel.length?JSON.parse(d.rel.replace(new RegExp("\\n","g"),"").replace(/'/g,'"')):{}}catch(a){d.params={}}d.params.domain||(d.params.domain=document.domain),null!==d.type&&mailru.plugin.insert(d)}},insert:function(a){a.insertOptions={};var b=mailru.def.PLUGIN_URL+a.type+"?";switch(a.type){case"like_button":case"uber_like_button":mailru.plugin.like.Button(a),a.params.cp=1,b=mailru.def.LIKE.BUTTON_URL;break;case"recommendations":return a.style.display="none",!1;case"groups_widget":b=mailru.def.PLUGIN_URL+"groups_widget?"}var c=0;c=mailru.utils.modal.open(b,{type:"insertable",place:a,url:a.params,insertOptions:a.insertOptions,wid:mailru.utils.uniqid()}),a.processed=!0,mailru.plugin.elements[c]=a.params},events:{liked:"plugin.liked",unliked:"plugin.unliked",likeCommented:"plugin.likeCommented",closeLikeComment:"plugin.closeComment",errorMessage:"plugin.errorMessage",like:{liked:"plugin.like.liked",unliked:"plugin.like.unliked",commented:"plugin.like.Commented",closeComment:"plugin.like.closeComment",errorMessage:"plugin.like.errorMessage",rl:"plugin.like.rl",rlOK:"plugin.like.rlOK",comment:"plugin.like.comment"},email:{data:"plugin.email.data",redirect:"plugin.email.redirect"},group:{subscribed:"plugin.groups.subscribed"}},like:{buttonsWithComment:{},Button:function(a){var b=mailru.utils.uniqid(),c=mailru.utils.parseGet((a.getAttribute("href").match(/\?(.*)/)||[0,""])[1]);c.title&&(a.params.title=c.title),c.desc&&(a.params.desc=c.desc),c.description&&(a.params.desc=c.description),c.image_url&&(a.params.imageurl=c.image_url),c.imageurl&&(a.params.imageurl=c.imageurl),c.share_url&&(a.params.url=c.share_url),c.url&&(a.params.url=c.url),!a.params.url||!a.params.url.length||a.getAttribute("href").indexOf("share_url=")===-1&&a.getAttribute("href").indexOf("url=")===-1?a.params.url=document.location.href:(/^https?:\/\//.test(a.params.url)||(a.params.url="http://"+a.params.url),a.params.url=window.unescape(a.params.url)),c.swfurl&&(a.params.video=c.swfurl),c.width&&(a.params.vwidth=c.width),c.height&&(a.params.vheight=c.height),c.screenshot&&(a.params.imageurl=c.screenshot),a.params.buttonID=b,a.params.faces_count=10,a.params.sz=a.params.height=a.params.sz||a.params.size||21,a.params.st=a.params.st||a.params.style||"oval",(a.params.tp||a.params.type)&&(a.params.tp=a.params.tp||a.params.type),c.share_remote&&(a.params.su=c.share_remote),(a.params.sz>12&&a.params.sz<70&&a.params.vt||a.params.vertical&&!a.params.nc)&&(a.params.vt=1,a.params.height*=3),a.params.width=a.params.width||"100%",a.insertOptions.wrap=!0,a.params.caption=a.innerHTML,mailru.isIE&&(a.params.desc&&(a.params.desc=a.params.desc.substr(0,200)),a.params.title&&(a.params.title=a.params.title.substr(0,100)))},Comment:function(a){if(void 0===a)return!1;var b,c=a.wid,d=a.history_id,e=a.type,f=a.OK_uid,g=a.offset||0,h=a.crosspost||!1,i=a.checkCrosspost||!1,j=a.avatar||!1,k=document.getElementById(c);if(h)return!1;if(!c||!d&&(void 0===e||"ok"!==e)||"undefined"===c||"ok"===e&&void 0===f)return!1;e=e||"",j=j||"";var l={noreplace:!0,position:mailru.utils.window.getPosition(k),body:!0};g&&(l.position.left+=+g);var m={position:"absolute",display:"block",zIndex:"1000",overflow:"auto",margin:parseInt(k.style.height,10)+"px 0 0"},n=mailru.def.LIKE.COMMENT_URL+"buttonID="+c+"&";k.src.indexOf("&type=small")>=0&&(n+="small=1&"),k.src.indexOf("&nt=1")>=0&&(n+="super-small=1&"),b={insertOptions:l,place:k,style:m,type:"insertable",url:{history_id:d}},i&&(n+="checkCrosspost=1&"),mailru.plugin.like.buttonsWithComment[c]=mailru.utils.modal.open(n,b)},closeAllComments:function(a){var b;for(b in mailru.plugin.like.buttonsWithComment)mailru.plugin.like.buttonsWithComment.hasOwnProperty(b)&&mailru.utils.modal.close(mailru.plugin.like.buttonsWithComment[b]);"function"==typeof a&&a()},errorMessage:function(a,b){var c=document.getElementById(a),d={noreplace:!0,position:mailru.utils.window.getPosition(c),body:!0},e={position:"absolute",display:"block",zIndex:"1000",overflow:"auto",margin:parseInt(c.style.height,10)+"px 0 0"},f=mailru.def.LIKE.COMMENT_URL;mailru.plugin.like.buttonsWithComment[a]=mailru.utils.uniqid(),mailru.utils.modal.open(f,{wid:mailru.plugin.like.buttonsWithComment[a],type:"insertable",place:c,insertOptions:d,url:{error_type:b},style:e})},rl:function(a){var b,c,d,e,f,g=a.wid||!1;return!(!g||"undefined"===g)&&(b=document.getElementById(g),c={noreplace:!0,position:mailru.utils.window.getPosition(b),body:!0},d={position:"absolute",display:"block",zIndex:"1000",overflow:"auto",margin:parseInt(b.style.height,10)+"px 0 0"},e=mailru.plugin.elements[g]||{},delete e.height,delete e.app_id,delete e.wid,delete e.height,delete e.width,e.like_id=g,e.buttonID=g,e.rl=1,f=mailru.def.LIKE.CAPTCHA_URL,mailru.plugin.like.buttonsWithComment[g]=mailru.utils.uniqid(),void mailru.utils.modal.open(f,{wid:mailru.plugin.like.buttonsWithComment[g],type:"insertable",place:b,insertOptions:c,url:e,style:d}))}},email:{redirectTo:function(a){a&&(document.location=a)}}},mailru.loader.onready("api")}();var mailru=mailru||{};mailru.isApp=!0,mailru.server={init:function(a,b,c){"use strict";!mailru.session&&c&&(mailru.session=c),mailru.server.container={},mailru.server.def.FCID=b||!1,mailru.server.def.APP_RECEIVER=a+"?",mailru.server.def.APP_CONTAINER_ID=document.URL.match(/apps\/(\d+)/),mailru.server.def.APP_CONTAINER_ID?mailru.server.def.APP_CONTAINER_ID=mailru.server.def.APP_CONTAINER_ID[1]:mailru.server.def.APP_CONTAINER_ID=mailru.utils.parseGet(mailru.server.def.APP_CONTAINER_ID.replace(document.location.hash||"#","")).appid,mailru.server.intercom.init()},inited:!1},mailru.server.app_id=document.URL.match(/apps\/(\d+)/),mailru.server.app_id?mailru.server.app_id=mailru.server.app_id[1]:mailru.server.app_id=mailru.utils.parseGet(mailru.server.app_id.replace(document.location.hash||"#","")).appid,mailru.server.def={HOST:"http://my.mail.ru",DOMAIN:function(){"use strict";try{return document.URL.match(/(?:https?:\/\/)?([^\/\?#]+)/i)[1]}catch(a){(new Image).src="http://gstat.imgsmail.ru/gstat?api.param4=1&rnd="+Math.random();try{return document.domain}catch(a){return""}}}(),API_URL:mailru.loader.getHost("appsmail")+"/platform/japi",PROXY_URL:"https://connect.mail.ru/proxy?",CONNECT_LOGOUT_URL:"https://swa.mail.ru/cgi-bin/logout?app=1",PLUGIN_URL:"https://connect.mail.ru/",LIKE:{BUTTON_URL:"https://connect.mail.ru/share_button?",CAPTCHA_URL:"https://connect.mail.ru/share?layout=captcha&",COMMENT_URL:"https://connect.mail.ru/share_comment?"},CONNECT_COOKIE:"mrc",CONNECT_BUTTON_BG_URL:"http://my1.imgsmail.ru/r/my/app/connect/connect-button.png",SESSION_REFRESH_EVERY:18e5},mailru.server.intercom={init:function(){"use strict";this.wrp=this[mailru.intercomType],this.wrp.init()},receiver:function(a){"use strict";mailru.server.inited=!0,a=mailru.utils.parseGet(a),a.method&&mailru.server.actions[a.method]&&("undefined"!=typeof ApiStat&&ApiStat(),mailru.server.actions[a.method](a,function(b){a.cbid&&mailru.server.intercom.wrp.send({cbid:a.cbid,result:b})})),a.result&&(+a.rt?a.res_hash=mailru.utils.parseGet(a.result):a.res_hash=mailru.utils.fromJSON(a.result)),a.event&&mailru.server.events.notify(a.event,a.res_hash,a.result)},wrp:{init:function(){"use strict"},request:function(a,b,c){"use strict"}},hash:{init:function(){"use strict"},send:function(a){"use strict";"object"==typeof a.result&&(a.result=JSON.stringify(a.result)),a.relation="parent.frame",mailru.utils.requestOverReceiver(a)}},event:{init:function(){"use strict";mailru.utils.addHandler(window,"message",function(a){mailru.utils.isTrustedHost(a.origin)&&mailru.server.intercom.receiver(a.data)})},send:function(a){"use strict";var b=document.getElementById(mailru.server.app_id);"object"==typeof a.result&&(a.result=JSON.stringify(a.result)),b&&b.contentWindow&&b.contentWindow.postMessage(mailru.utils.makeGet(a),"*")}}},mailru.server.common={events:{permissionChanged:"common.permissionChanged",permissionsChange:"common.permissionChanged",friendsInvitation:"common.friendsInvitation",sendMessage:"common.sendMessage",streamPublish:"common.streamPublish",modalWindow:"common.modalWindow",requireWidgetPermissions:"common.requireWidgetPermissions",createAlbum:"common.createAlbum",upload:"common.uploadPhoto",uploadAvatar:"common.uploadAvatar",guestbookPublish:"common.guestbookPublish",transportReady:"common.transportReady",friends:{add:"common.friends.add"},gift:{send:"common.gift.send"}}},mailru.server.app={events:{windowBlur:"app.windowBlur",windowFocus:"app.windowFocus",locationChange:"app.locationChange",windowResize:"app.windowResize",applicationInstallation:"app.applicationInstallation",friendsInvitation:"app.friendsInvitation",applicationSettingsStatus:"app.settings",applicationReviewStatus:"app.review",incomingPayment:"app.incomingPayment",hash:{changed:"app.hash.changed"},paymentDialogStatus:"app.paymentDialogStatus",mail:{getForm:"app.mail.getForm",appendHTML:"app.mail.appendHTML",getField:"app.mail.getField"},widget:{set:"app.widget.set"}}},mailru.server.events={_listentrs:{},_hidHash:{},listen:function(a,b){"use strict";var c,d;return this._listentrs[a]=this._listentrs[a]||{index:-1,list:{}},c=++this._listentrs[a].index,this._listentrs[a].list[c]=b,d=mailru.utils.uniqid(),this._hidHash[d]=[a,c],d},remove:function(a){"use strict";this._hidHash[a]&&delete this._listentrs[this._hidHash[a][0]].list[this._hidHash[a][1]]},notify:function(a){"use strict";var b;"event"!==a&&(b=mailru.utils.toArray(arguments),b.unshift("event"),this.notify.apply(this,b)),this._listentrs[a]&&this._listentrs[a].index!==-1&&(b=mailru.utils.toArray(arguments).splice(1,arguments.length),mailru.utils.foreach(this._listentrs[a].list,function(a){a.apply(window,b)}))},reviewDialog:{onDialogShow:function(){"use strict";mailru.server.intercom.wrp.send({event:"app.review",result:{status:"opened"}})},onDialogClose:function(a){"use strict";"undefined"==typeof a&&(a=null),mailru.server.intercom.wrp.send({event:"app.review",result:{status:"closed",data:[a]}})}},dialogs:{"friends.add":{show:function(){"use strict";mailru.server.intercom.wrp.send({event:"common.friends.add",result:{status:"opened"}})},close:function(a){"use strict";mailru.server.intercom.wrp.send({event:"common.friends.add",result:{status:a.status}})}},"friends.invite":{show:function(){mailru.server.intercom.wrp.send({event:"app.friendsInvitation",result:{status:"opened"}}),mailru.server.intercom.wrp.send({event:"mailru.app.events.friendsInvitation",result:{status:"opened"}})},close:function(a){var b={status:a.status,data:[]};a&&(a.ids&&(b.data=a.ids.split(",")),a.all&&(b.all=1),a.error&&(b.error=a.error)),mailru.server.intercom.wrp.send({event:"app.friendsInvitation",result:b}),mailru.server.intercom.wrp.send({event:"mailru.app.events.friendsInvitation",result:b})}},"friends.request":{show:function(){mailru.server.intercom.wrp.send({event:"app.friendsRequest",result:{status:"opened"}}),mailru.server.intercom.wrp.send({event:"mailru.app.events.friendsRequest",result:{status:"opened"}})},close:function(a){var b={status:a.status,data:[]};a&&(a.ids&&(b.data=a.ids.split(",")),a.all&&(b.all=1),a.error&&(b.error=a.error)),mailru.server.intercom.wrp.send({event:"app.friendsRequest",result:b}),mailru.server.intercom.wrp.send({event:"mailru.app.events.friendsRequest",result:b})}},"messages.send":{show:function(){mailru.server.intercom.wrp.send({event:"common.sendMessage",result:{status:"opened"}})},close:function(a){mailru.server.intercom.wrp.send({event:"common.sendMessage",result:{status:"closed"}})}},"stream.post":{show:function(){mailru.server.intercom.wrp.send({event:"common.streamPublish",result:{status:"opened"}})},close:function(a){var b={status:a.status,data:[]};a&&(a.id?b.data.push(a.id):a.error&&(b.error=a.error)),mailru.server.intercom.wrp.send({event:"common.streamPublish",result:b})}},"guestbook.post":{show:function(){mailru.server.intercom.wrp.send({event:"common.guestbookPublish",result:{status:"opened"}})},close:function(a){mailru.server.intercom.wrp.send({event:"common.guestbookPublish",result:{status:a.status}})}},"photos.upload":{show:function(){mailru.server.intercom.wrp.send({event:"common.upload",result:{status:"opened"}})},close:function(a){mailru.server.intercom.wrp.send({event:"common.uploadPhoto",result:a})}},"photos.uploadAvatar":{show:function(){mailru.server.intercom.wrp.send({event:"common.uploadAvatar",result:{status:"opened"}})},close:function(a){mailru.server.intercom.wrp.send({event:"common.uploadAvatar",result:a})}},"photos.createAlbum":{show:function(){mailru.server.intercom.wrp.send({event:"common.createAlbum",result:{status:"opened"}})},close:function(a){mailru.server.intercom.wrp.send({event:"common.createAlbum",result:a})}}},paymentDialog:{onDialogShow:function(){"use strict";mailru.server.intercom.wrp.send({event:"app.paymentDialogStatus",result:{status:"opened"}})},onDialogClose:function(a){"use strict";"undefined"==typeof a&&(a=null),mailru.server.intercom.wrp.send({event:"app.paymentDialogStatus",result:{status:"closed",data:a}})},onDialogCancel:function(){"use strict";mailru.server.intercom.wrp.send({event:"app.paymentDialogStatus",result:{status:"closed"}})},onDialogError:function(a){"use strict";var b="";switch(a=a||0){case 1:b="wrong sms price";break;case 2:b="wrong other price";break;case 3:b="wrong mailiki price";break;default:b="unknown error"}mailru.server.intercom.wrp.send({event:"app.paymentDialogStatus",result:{status:"error",message:b}})},onPaymentSuccess:function(a){"use strict";mailru.server.intercom.wrp.send({event:"app.incomingPayment",result:{status:"success",data:a}}),mailru.server.intercom.wrp.send({event:"app.paymentDialogStatus",result:{status:"closed",data:null}})},onPaymentFail:function(a){"use strict";mailru.server.intercom.wrp.send({event:"app.paymentDialogStatus",result:{status:"closed",data:null}}),mailru.server.intercom.wrp.send({event:"app.incomingPayment",result:{status:"fail",data:a}})}},permissionDialog:{onDialogShow:function(){"use strict";mailru.server.intercom.wrp.send({event:"app.permissionDialogStatus",result:{status:"opened"}})},onDialogClose:function(){"use strict";mailru.server.intercom.wrp.send({
event:"app.permissionDialogStatus",result:{status:"closed"}})}},permissionChangedDialog:function(){"use strict"},permissionsChange:function(a){"use strict";mailru.server.intercom.wrp.send({event:"common.permissionsChange",result:{}})},createAlbumDialog:{onDialogShow:function(){"use strict";mailru.server.intercom.wrp.send({event:"common.createAlbum",result:{status:"opened"}})},onDialogClose:function(){"use strict";mailru.server.intercom.wrp.send({event:"common.createAlbum",result:{status:"closed"}})}},uploadPhotoDialog:{onDialogShow:function(){"use strict";mailru.server.intercom.wrp.send({event:"common.upload",result:{status:"opened"}})},onDialogClose:function(){"use strict";mailru.server.intercom.wrp.send({event:"common.upload",result:{status:"closed"}})}},uploadAvatarDialog:{onDialogShow:function(){"use strict";mailru.server.intercom.wrp.send({event:"common.uploadAvatar",result:{status:"opened"}})},onDialogClose:function(){"use strict";mailru.server.intercom.wrp.send({event:"common.uploadAvatar",result:{status:"closed"}})}},requireInstallation:{onDialogClose:function(a){"use strict";mailru.server.intercom.wrp.send({event:"app.applicationInstallation",result:{status:"closed"}})},onInstalled:function(){"use strict";mailru.server.intercom.wrp.send({event:"app.applicationInstallation",result:{status:"error"}})}},setWidgetDialog:{onDialogShow:function(){"use strict";mailru.server.intercom.wrp.send({event:"app.widget.set",result:{status:"opened"}})},onDialogClose:function(){"use strict";mailru.server.intercom.wrp.send({event:"app.widget.set",result:{status:"closed"}})}},giftSendDialog:{onDialogShow:function(){mailru.server.intercom.wrp.send({event:"common.gift.send",result:{status:"opened"}})},onDialogClose:function(){mailru.server.intercom.wrp.send({event:"common.gift.send",result:{status:"closed"}})}}},mailru.server.actions={showReviewDialog:function(a){"use strict";showReviewArea($("body"),a.app_id),mailru.server.events.reviewDialog.onDialogShow()},showPaymentDialog:function(a){"use strict";mailru.server.events.paymentDialog.onDialogShow();var b=!1,c={};a.sms_price&&1!=a.sms_price&&3!=a.sms_price&&5!=a.sms_price&&(b=1),a.other_price&&!a.inner_price&&(a.other_price<100||a.other_price>5e6)&&(b=2),a.mailiki_price&&a.mailiki_price<1&&(b=3),a.inner_price&&(c.inner_price=a.inner_price),b?mailru.server.events.paymentDialog.onDialogError(b):showPaymentDialog(a.app_id,a.service_id,a.service_name,a.sms_price,a.other_price,mailru.utils.parseGet($(mailru.server.app_id).src).window_id,c,a.mailiki_price,a.session_key,a.f)},showPermissionDialog:function(a){"use strict";mailru.server.events.permissionDialog.onDialogShow(),delete a.method,delete a.resource,a.wid="000000",a.url=mailru.server.def.HOST+"/cgi-bin/connect/permissions?"+mailru.utils.makeGet(a),openPermissionDialog(a)},showGiftSendDialog:function(a){"use strict";mailru.server.events.giftSendDialog.onDialogShow(),a.appid=a.app_id,a.url=mailru.server.def.HOST+"/cgi-bin/connect/api/friends_select?"+mailru.utils.makeGet(a),openGiftSend(a)},setTitle:function(a){"use strict";mailru.server.actions._defaultTitle||(mailru.server.actions._defaultTitle=document.title),"undefined"!==a.title&&(""===a.title?a.title=mailru.server.actions._defaultTitle:a.title+=" - "+mailru.server.actions._defaultTitle,document.title=a.title)},_defaultTitle:!1,showPermissionsDialog:function(a){"use strict"},setIframeHeight:function(a){"use strict";document.getElementById(mailru.server.app_id).style.height=a.height.toString().indexOf("px")===-1?a.height+"px":a.height},writeHash:function(a){"use strict";"undefined"!=typeof a?"object"==typeof a&&(a="undefined"!=typeof a.hash?"object"==typeof a.hash?mailru.utils.makeGet(a.hash):a.hash:mailru.utils.makeGet(a)):a="",document.location.hash=a},readHash:function(){"use strict";mailru.server.intercom.wrp.send({event:"app.appReadHash",result:{hash:document.location.hash.replace(/^#/,"")}})},scrollTo:function(a){"use strict";var b=void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;"undefined"==typeof a.scroll?mailru.server.intercom.wrp.send({event:"app.scrollTo",result:{scrollY:b}}):window.scroll(0,a.scroll)},showJSAPIDialog:function(a){"use strict";delete a.method,delete a.resource,this.lastTemplate=a.template,mailru.server.events.dialogs[a.template].show(),jsapiOpenDialog(a)},resizeJSAPIDialog:function(a){var b={height:parseInt(a.height)||570,width:parseInt(a.width)||615};winModal.get("jsapi_dialog").resize(b)},closeJSAPIDialog:function(a){var b;delete a.method,delete a.resource,a.template?(b=a.template,delete a.template):b=this.lastTemplate,b&&mailru.server.events.dialogs[b]&&mailru.server.events.dialogs[b].close(a),winModal.get("jsapi_dialog").down()}},mailru.server.events.listen(mailru.server.common.events.permissionChanged,function(a){"use strict";"appSettingsDialog"!==a.type&&winModal.get("app_permission").down(),delete a.type,mailru.server.intercom.wrp.send({event:"common.permissionChanged",result:a})}),mailru.server.events.listen(mailru.server.common.events.sendMessage,function(a){"use strict";mailru.server.intercom.wrp.send({event:"common.sendMessage",result:{status:a.status}}),winModal.get("app_sendMessage").down()}),mailru.server.events.listen(mailru.server.common.events.streamPublish,function(a){"use strict";mailru.server.intercom.wrp.send({event:"common.streamPublish",result:{status:a.status}}),winModal.get("app_streamPublish").down()}),mailru.server.events.listen(mailru.server.common.events.guestbookPublish,function(a){"use strict";mailru.server.intercom.wrp.send({event:"common.guestbookPublish",result:{status:a.status}}),winModal.get("app_guestbookPublish").down()}),mailru.server.events.listen(mailru.server.common.events.createAlbum,function(a){"use strict";mailru.server.intercom.wrp.send({event:"common.createAlbum",result:{status:a.status,aid:a.aid}}),winModal.get("app_createAlbum").down()}),mailru.server.events.listen(mailru.server.common.events.upload,function(a){"use strict";mailru.server.intercom.wrp.send({event:"common.upload",result:{status:a.status,pid:a.pid}}),winModal.get("app_uploadPhoto").down()}),mailru.server.events.listen(mailru.server.common.events.uploadAvatar,function(a){"use strict";mailru.server.intercom.wrp.send({event:"common.uploadAvatar",result:{status:a.status,pid:a.pid}}),winModal.get("app_uploadAvatar").down()}),mailru.server.events.listen(mailru.server.common.events.friends.add,function(a){"use strict";mailru.server.intercom.wrp.send({event:"common.friends.add",result:{status:a.status}}),winModal.get("app_addFriend").down()}),mailru.server.events.listen(mailru.server.app.events.hash.changed,function(a){"use strict";mailru.server.intercom.wrp.send({event:"app.appReadHash",result:{hash:document.location.hash.replace(/^#/,""),status:"changed"}})}),mailru.server.events.listen(mailru.server.app.events.widget.set,function(a){"use strict";mailru.server.intercom.wrp.send({event:"app.widget.set",result:{status:a.status}}),winModal.get("app_setWidget").down()}),mailru.server.events.listen(mailru.server.common.events.gift.send,function(a){"use strict";mailru.server.intercom.wrp.send({event:"common.gift.send",result:{status:a.status}}),winModal.get("app_giftSend").down()}),mailru.utils.addHandler(window,"hashchange",function(){mailru.server.events.notify("app.hash.changed")}),mailru.server.appInstalled=function(){"use strict";document.getElementById("appLinksLine")&&(document.getElementById("appLinksLine").style.display="block")},mailru.loader&&mailru.loader.onready("server");