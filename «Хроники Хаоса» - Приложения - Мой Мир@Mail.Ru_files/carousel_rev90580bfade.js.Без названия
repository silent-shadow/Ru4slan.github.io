define(["jquery","counters","app_catalog/view/catalog","jquery.jcarousel"],function(a,b,c){"use strict";var d=c.extend({props:{elements:{carousel:".apps-block__list-wrapper",controls:".apps-block__control",pages:".apps-block__pager",appList:".apps-list"},defaultOptions:{autoscroll:!1,perPage:5,pager:!0,title:"",wrap:"both",picSize:"143x113"},templates:{main:"app_catalog/tmpl/carousel"}},public:{destroy:function(){return this.$pages.off(),this.$carousel.off(),d.__super__.destroy.call(this),this}},protected:{prepareRenderData:function(a){var b=this.options.picSize;return a.map(function(a){var c;return c=a.toJSON(),c.link=a.getAppUrl(),c.pic=c.mainPic||c.pics[b]||c.pics["143x113"],c})},onRender:function(){this.$carousel.on("jcarousel:createend",this.onCarouselCreateend.bind(this))},onRenderList:function(a){var b=this.$carousel,c=window.location.hash,d=c?document.getElementById(c.substring(1)):null;if(b.html(a),this.options.showControls=this.collection.items.length>this.options.perPage,this.options.pager=this.options.showControls,d){var e=document.body.getBoundingClientRect(),f=d.getBoundingClientRect(),g=f.top-e.top;window.scrollTo({top:g-60,behavior:"smooth"})}this.options.showControls||(this.$pages.hide(),this.$controls.hide()),b.attr("data-jcarousel")?b.jcarousel("scroll",0,!1,function(){this.$carousel.jcarousel("reload"),this.options.pager&&(this.$pages.jcarouselPagination("reloadCarouselItems"),this.$pages.jcarouselPagination("reload",{perPage:this.options.perPage||5}))}.bind(this)):(b.jcarousel(b.data()),this.options.autoscroll&&(b.jcarouselAutoscroll({autostart:!0,interval:1e4,target:this.options.perPage?"+="+this.options.perPage:"+=5"}),this.on("mouseleave",function(){this.$carousel.jcarouselAutoscroll("start")}.bind(this)),this.on("mouseenter",function(){this.$carousel.jcarouselAutoscroll("stop")}.bind(this))))},onCarouselCreateend:function(c,d){var e=this.$carousel;this.$controls.add(this.$title).each(function(){var b=a(this);b.jcarouselControl({carousel:e,target:b.attr("data-target")})}),this.$pages.on("jcarouselpagination:create",function(){a(this).find(".dot:first").addClass("dot-active")}).on("jcarouselpagination:active",".dot",function(c,d){var e=a(c.target),f=this.options.uid;this.$carousel.jcarousel("visible").each(function(c,d){var e=a(d);b.dwh({version:1,category:{"app-catalog-new-ctr":{uid:f,app_id:window.parseInt(e.attr("data-appid"),10),event:"show"}}})}),e.addClass("dot-active")}.bind(this)).on("jcarouselpagination:inactive",".dot",function(){a(this).removeClass("dot-active")}),this.$pages.jcarouselPagination({carousel:e,perPage:this.options.perPage,item:function(a,b){return'<span class="dot" data-page="'+a+'"></span>'}})}}});return d});